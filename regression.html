
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Regression Modelle &#8212; California Housing Guide</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Classification Modelle" href="classification.html" />
    <link rel="prev" title="Variablen" href="Variablen.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">California Housing Guide</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   California Housing Guide
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="Modelle.html">
   Inhalt
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Variablen.html">
     Variablen
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Regression Modelle
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="classification.html">
     Classification Modelle
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Fazit.html">
   Fazit
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fregression.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Regression Modelle
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-module-libraries">
     Import Module &amp; Libraries
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#erstellen-einer-pipeline">
     Erstellen einer Pipeline
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-data">
   Import Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-split">
   Data Split
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-inspection">
   Data Inspection
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anomaly-detection">
     Anomaly Detection
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#schema-definition">
     Schema Definition
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deskriptive-statistik">
   Deskriptive Statistik
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#uberblick">
     Überblick
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#analyse-kategorialer-variablen">
       Analyse kategorialer Variablen
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#analyse-numerischer-variablen">
       Analyse numerischer Variablen
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-feature-engineering">
   Initial Feature Engineering
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#erstellen-eigener-variablen">
     Erstellen eigener Variablen
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#analyse-optimierung">
     Analyse &amp; Optimierung
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#auswahl-features">
     Auswahl Features
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#erganzung">
     Ergänzung
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modelling">
   Modelling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linear-ols-regression">
     1. Linear OLS Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#model-1-1-linear-ols-regression-mit-scikit-learn">
       Model 1.1 - Linear OLS Regression mit scikit learn
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#modellierung">
         Modellierung
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#evaluation-mit-trainingsdaten">
         Evaluation mit Trainingsdaten
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#validierung-mit-testdaten">
         Validierung mit Testdaten
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#model-1-2-linear-ols-regression-with-statsmodels">
       Model 1.2 - Linear OLS Regression with Statsmodels
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id1">
         Modellierung
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#regression-diagnostics">
       Regression Diagnostics
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lasso-regression-mit-scikit-learn">
     2. Lasso Regression mit scikit learn
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lasso-split-data">
       Lasso - Split Data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lasso-model">
       Lasso - Model
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lasso-model-evaluation">
       Lasso - Model Evaluation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lasso-k-fold-cross-validation">
       Lasso - k-fold cross validation
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lasso-lasso-best">
       Lasso - Lasso Best
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splines">
     3. Splines
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#splines-mit-scikit-learn">
       3.1 Splines mit scikit learn
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#test-mit-cook-s-distance-bereinigten-dataset">
         Test mit Cook’s Distance bereinigten Dataset
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#cubic-spline-with-patsy-statsmodels">
       3.2 Cubic Spline with Patsy &amp; Statsmodels
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#natural-spline-with-patsy-statsmodels">
       3.3 Natural Spline with Patsy &amp; Statsmodels
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#abschlieszende-evaluation-mit-testdaten">
   Abschließende Evaluation mit Testdaten
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#transformation-testdaten">
     Transformation Testdaten
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-data-split">
     Test Data Split
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#finale-evaluation">
     Finale Evaluation
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#evaluation-lineares-regressionsmodell-mit-statsmodels">
       Evaluation Lineares Regressionsmodell mit statsmodels
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#evaluation-lasso-regression-mit-scikit-learn">
       Evaluation Lasso Regression mit scikit learn
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#evaluation-splines-mit-scikit-learn">
       Evaluation Splines mit scikit learn
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="regression-modelle">
<h1>Regression Modelle<a class="headerlink" href="#regression-modelle" title="Permalink to this headline">¶</a></h1>
</section>
<section id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<section id="import-module-libraries">
<h2>Import Module &amp; Libraries<a class="headerlink" href="#import-module-libraries" title="Permalink to this headline">¶</a></h2>
<p>Zu Beginn werden die benötigten Komponenten aus den entsprechenden Libraries importiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Allgemein</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span> <span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>
<span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrix</span>

<span class="c1"># statsmodels</span>
<span class="kn">from</span> <span class="nn">statsmodels.compat</span> <span class="kn">import</span> <span class="n">lzip</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="c1">#from statsmodels.formula.api import ols</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>
<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.eval_measures</span> <span class="kn">import</span> <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.tools</span> <span class="kn">import</span> <span class="n">add_constant</span>

<span class="c1"># sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_selector</span> <span class="k">as</span> <span class="n">selector</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">SplineTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="erstellen-einer-pipeline">
<h2>Erstellen einer Pipeline<a class="headerlink" href="#erstellen-einer-pipeline" title="Permalink to this headline">¶</a></h2>
<p>Um die numerische und kategoriale Variablen automatisch in ein korrektes Format für die scikit learn Modelle zu transformieren, wird an dieser Stelle eine Pipeline definiert. Diese besteht aus verschiedenen Elementen, welche bspw. fehlende Werte ausfüllt (SimpleImputer) oder kategoriale Variablen in ein binäres Format umwandelt (OneHotEncoder).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># für numeric features</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># für categorical features  </span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;missing&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der Pipeline, zusammenführen von cat und numeric transformer</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">selector</span><span class="p">(</span><span class="n">dtype_exclude</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">))</span>
        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="import-data">
<h1>Import Data<a class="headerlink" href="#import-data" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>Als nächstes wird der Datensatz aus dem GitHub Repository importiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ROOT</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/jan-kirenz/project-OliScha/main/&quot;</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="s2">&quot;project_data.csv?token=GHSAT0AAAAAABPCEITIYHBIEPRTFMZJXUGKYPKREJQ&quot;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ROOT</span> <span class="o">+</span> <span class="n">DATA</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Wir werfen einen ersten Blick auf die Daten um zu prüfen, auch um zu prüfen ob der Import funktioniert hat. Hier fällt direkt auf, dass die erste Observation durch Text und ein Währungszeichen verunreigt ist.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-122.23</td>
      <td>37.88</td>
      <td>41.0years</td>
      <td>880</td>
      <td>129.0</td>
      <td>322</td>
      <td>126</td>
      <td>8.3252</td>
      <td>452600.0$</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-122.22</td>
      <td>37.86</td>
      <td>21.0</td>
      <td>7099</td>
      <td>1106.0</td>
      <td>2401</td>
      <td>1138</td>
      <td>8.3014</td>
      <td>358500.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-122.24</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1467</td>
      <td>190.0</td>
      <td>496</td>
      <td>177</td>
      <td>7.2574</td>
      <td>352100.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1274</td>
      <td>235.0</td>
      <td>558</td>
      <td>219</td>
      <td>5.6431</td>
      <td>341300.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1627</td>
      <td>280.0</td>
      <td>565</td>
      <td>259</td>
      <td>3.8462</td>
      <td>342200.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20635</th>
      <td>-121.09</td>
      <td>39.48</td>
      <td>25.0</td>
      <td>1665</td>
      <td>374.0</td>
      <td>845</td>
      <td>330</td>
      <td>1.5603</td>
      <td>78100.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20636</th>
      <td>-121.21</td>
      <td>39.49</td>
      <td>18.0</td>
      <td>697</td>
      <td>150.0</td>
      <td>356</td>
      <td>114</td>
      <td>2.5568</td>
      <td>77100.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20637</th>
      <td>-121.22</td>
      <td>39.43</td>
      <td>17.0</td>
      <td>2254</td>
      <td>485.0</td>
      <td>1007</td>
      <td>433</td>
      <td>1.7000</td>
      <td>92300.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20638</th>
      <td>-121.32</td>
      <td>39.43</td>
      <td>18.0</td>
      <td>1860</td>
      <td>409.0</td>
      <td>741</td>
      <td>349</td>
      <td>1.8672</td>
      <td>84700.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20639</th>
      <td>-121.24</td>
      <td>39.37</td>
      <td>16.0</td>
      <td>2785</td>
      <td>616.0</td>
      <td>1387</td>
      <td>530</td>
      <td>2.3886</td>
      <td>89400.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
  </tbody>
</table>
<p>20640 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="data-split">
<h1>Data Split<a class="headerlink" href="#data-split" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>Direkt nach dem Import und einem ersten Blick auf die Daten werden die Daten in Traings- und Testdaten aufgeteilt. Alle folgenden Schritt finden auf Basis der Trainingsdaten statt, um möglichst realistische Ergebnisse bei der späteren Evaluation mit Testdaten zu erzielen.</p>
<p>Dadurch soll ein möglichst realistischer generalization error (or out-of-sample error) erzielt werden.</p>
<p>Bestimmte Schritte der Datenaufbereitung (datatypes, selbst erstellte Variablen etc.) müssen dann späte rallerdings auch für die Testdaten durchgeführt werden, um diese zur Evaluation nutzen zu können.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data Split</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">train_dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14740</th>
      <td>-117.05</td>
      <td>32.58</td>
      <td>22.0</td>
      <td>2101</td>
      <td>399.0</td>
      <td>1551</td>
      <td>371</td>
      <td>4.1518</td>
      <td>136900.0</td>
      <td>NEAR OCEAN</td>
      <td>below</td>
    </tr>
    <tr>
      <th>10101</th>
      <td>-117.97</td>
      <td>33.92</td>
      <td>32.0</td>
      <td>2620</td>
      <td>398.0</td>
      <td>1296</td>
      <td>429</td>
      <td>5.7796</td>
      <td>241300.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20566</th>
      <td>-121.84</td>
      <td>38.65</td>
      <td>29.0</td>
      <td>3167</td>
      <td>548.0</td>
      <td>1554</td>
      <td>534</td>
      <td>4.3487</td>
      <td>200700.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>2670</th>
      <td>-115.60</td>
      <td>33.20</td>
      <td>37.0</td>
      <td>709</td>
      <td>187.0</td>
      <td>390</td>
      <td>142</td>
      <td>2.4511</td>
      <td>72500.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>15709</th>
      <td>-122.43</td>
      <td>37.79</td>
      <td>25.0</td>
      <td>1637</td>
      <td>394.0</td>
      <td>649</td>
      <td>379</td>
      <td>5.0049</td>
      <td>460000.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7616</th>
      <td>-118.22</td>
      <td>33.86</td>
      <td>16.0</td>
      <td>8732</td>
      <td>1489.0</td>
      <td>3944</td>
      <td>1493</td>
      <td>5.1948</td>
      <td>203500.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
    </tr>
    <tr>
      <th>8767</th>
      <td>-118.39</td>
      <td>33.81</td>
      <td>35.0</td>
      <td>1008</td>
      <td>165.0</td>
      <td>391</td>
      <td>167</td>
      <td>3.7778</td>
      <td>487500.0</td>
      <td>NEAR OCEAN</td>
      <td>above</td>
    </tr>
    <tr>
      <th>16388</th>
      <td>-121.30</td>
      <td>38.05</td>
      <td>52.0</td>
      <td>122</td>
      <td>26.0</td>
      <td>62</td>
      <td>25</td>
      <td>1.1500</td>
      <td>112500.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
    <tr>
      <th>19949</th>
      <td>-119.37</td>
      <td>36.21</td>
      <td>35.0</td>
      <td>2228</td>
      <td>476.0</td>
      <td>1567</td>
      <td>449</td>
      <td>1.4455</td>
      <td>54100.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>10078</th>
      <td>-120.27</td>
      <td>39.35</td>
      <td>11.0</td>
      <td>2520</td>
      <td>401.0</td>
      <td>397</td>
      <td>165</td>
      <td>4.6650</td>
      <td>145600.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
  </tbody>
</table>
<p>16512 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="data-inspection">
<h1>Data Inspection<a class="headerlink" href="#data-inspection" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<section id="anomaly-detection">
<h2>Anomaly Detection<a class="headerlink" href="#anomaly-detection" title="Permalink to this headline">¶</a></h2>
<p>In diesem Abschnitt werden die Daten genauer untersucht um Anomalien zu identifizieren und ggfs. zu bereinigen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14740</th>
      <td>-117.05</td>
      <td>32.58</td>
      <td>22.0</td>
      <td>2101</td>
      <td>399.0</td>
      <td>1551</td>
      <td>371</td>
      <td>4.1518</td>
      <td>136900.0</td>
      <td>NEAR OCEAN</td>
      <td>below</td>
    </tr>
    <tr>
      <th>10101</th>
      <td>-117.97</td>
      <td>33.92</td>
      <td>32.0</td>
      <td>2620</td>
      <td>398.0</td>
      <td>1296</td>
      <td>429</td>
      <td>5.7796</td>
      <td>241300.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20566</th>
      <td>-121.84</td>
      <td>38.65</td>
      <td>29.0</td>
      <td>3167</td>
      <td>548.0</td>
      <td>1554</td>
      <td>534</td>
      <td>4.3487</td>
      <td>200700.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>2670</th>
      <td>-115.60</td>
      <td>33.20</td>
      <td>37.0</td>
      <td>709</td>
      <td>187.0</td>
      <td>390</td>
      <td>142</td>
      <td>2.4511</td>
      <td>72500.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>15709</th>
      <td>-122.43</td>
      <td>37.79</td>
      <td>25.0</td>
      <td>1637</td>
      <td>394.0</td>
      <td>649</td>
      <td>379</td>
      <td>5.0049</td>
      <td>460000.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Bereits beim ersten Blick auf das df ist aufgefallen, dass in der Observation mit Index = 0 die Variablen <em>housing_median_age</em> und <em>median_house_value</em> nicht dem Format der übrigen Daten in der gleichen Spalte entsprechen. Die Observation ist noch in unserem Traingsdatenset enthalten und muss in den nächsten Schritten bereinigt werden</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:</span> <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>longitude               -122.23
latitude                  37.88
housing_median_age    41.0years
total_rooms                 880
total_bedrooms            129.0
population                  322
households                  126
median_income            8.3252
median_house_value    452600.0$
ocean_proximity        NEAR BAY
price_category            above
Name: 0, dtype: object
</pre></div>
</div>
</div>
</div>
<p>Diese Verunreinigung sorgt auch dafür, dass den Variablen <em>housing_median_age</em> und <em>median_house_value</em> automatisch der Datatype <em>object</em> zugewiesen wurde,
obwohl man eher einen numerischen Wert erwarten würde (float oder int). Dies muss auch nach der Bereinigung korrigiert werden.</p>
<p>In der Übresicht info() kann außerdem bereits erkannt werden, dass einige Observations in der Spalte <em>total_bedrooms</em> keinen Wert (NULL) vorliegen haben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 16512 entries, 14740 to 10078
Data columns (total 11 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   longitude           16512 non-null  float64
 1   latitude            16512 non-null  float64
 2   housing_median_age  16512 non-null  object 
 3   total_rooms         16512 non-null  int64  
 4   total_bedrooms      16352 non-null  float64
 5   population          16512 non-null  int64  
 6   households          16512 non-null  int64  
 7   median_income       16512 non-null  float64
 8   median_house_value  16512 non-null  object 
 9   ocean_proximity     16512 non-null  object 
 10  price_category      16512 non-null  object 
dtypes: float64(4), int64(3), object(4)
memory usage: 2.0+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identifizieren der NULL Werte via Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> 
            <span class="n">yticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_26_0.png" src="_images/regression_26_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identifizieren der NULL Werte via Liste</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>longitude               0
latitude                0
housing_median_age      0
total_rooms             0
total_bedrooms        160
population              0
households              0
median_income           0
median_house_value      0
ocean_proximity         0
price_category          0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Die 160 identifizierten Datensätze mit den NULL Values in der Variablen <em>total_bedrooms</em> werden im nächsten Schritt entfernt.<br />
Auf ein Ausfüllen der leeren Felder mit Mittelwert o.ä. wird hier verzichtet, da es sich hierbei lediglich um ca. 1% der Daten handelt und ein blindes Ausfüllen per mean auch Schaden anrichten könnte.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Droppen der NULL values</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Die Variable <em>price_category</em> wird direkt aus unserer vorherzusagenden Variable <em>median_house_value</em> abgeleitet und einigt sich daher nicht als Feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Droppen der nicht benötigten Variable</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;price_category&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Im nächsten Schritt wird der zuvor identifizierte verunreinigte Datensatz korrigiert. Da es sich nur um einen einzigen Datensatz handelt, könnte dieser ebenfalls gelöscht werden.<br />
Da allerdings die Daten vollständig vorhanden sind, sollen diese behalten und bereinigt werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># change datatype zu string um str.replace transformation durchzuführen</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bereinigung der fehlerhaften Werte</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">median_house_value</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">median_house_value</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">housing_median_age</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">housing_median_age</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;years&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="schema-definition">
<h2>Schema Definition<a class="headerlink" href="#schema-definition" title="Permalink to this headline">¶</a></h2>
<p>Da nun alle offensichtlichen Anomalien in den Trainingsdaten entfernt wurden, sollen als nächstes die Datentypen der Variablen angepasstwerden.<br />
Numerische Variablen werden je nach Variable als <em>float</em> oder <em>int</em> definiert, kategoriale Varaiblen als <em>cat</em>.<br />
Die Varaiblen <em>housing_median_age</em>, <em>median_house_value</em> und <em>ocean_proximity</em> passen noch nicht in das Schema und müssen angepasst werden.</p>
<ul class="simple">
<li><p><em>housing_median_age</em> –&gt; float, da das Alter theoretisch auch in nicht gerundeten Werten angegeben werden könnte (bspw. 10,5 Jahre - was in unseren Daten allerdings nicht der Fall ist)</p></li>
<li><p><em>median_house_value</em> –&gt; float, da Wert auch mit Nachkommastellen angegeben werden könnte</p></li>
<li><p><em>ocean_proximity</em> –&gt; cat, dem Abstand zum Meer könnte theoretisch eine Reihenfolge zugewiesen werden</p></li>
<li><p><em>total_bedrooms</em> –&gt; int, wie bei <em>total_rooms</em>, da es in der Regel keine halben Räume in Districts gibt.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 16352 entries, 14740 to 10078
Data columns (total 10 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   longitude           16352 non-null  float64
 1   latitude            16352 non-null  float64
 2   housing_median_age  16352 non-null  string 
 3   total_rooms         16352 non-null  int64  
 4   total_bedrooms      16352 non-null  float64
 5   population          16352 non-null  int64  
 6   households          16352 non-null  int64  
 7   median_income       16352 non-null  float64
 8   median_house_value  16352 non-null  string 
 9   ocean_proximity     16352 non-null  object 
dtypes: float64(4), int64(3), object(1), string(2)
memory usage: 1.4+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14740</th>
      <td>-117.05</td>
      <td>32.58</td>
      <td>22.0</td>
      <td>2101</td>
      <td>399.0</td>
      <td>1551</td>
      <td>371</td>
      <td>4.1518</td>
      <td>136900.0</td>
      <td>NEAR OCEAN</td>
    </tr>
    <tr>
      <th>10101</th>
      <td>-117.97</td>
      <td>33.92</td>
      <td>32.0</td>
      <td>2620</td>
      <td>398.0</td>
      <td>1296</td>
      <td>429</td>
      <td>5.7796</td>
      <td>241300.0</td>
      <td>&lt;1H OCEAN</td>
    </tr>
    <tr>
      <th>20566</th>
      <td>-121.84</td>
      <td>38.65</td>
      <td>29.0</td>
      <td>3167</td>
      <td>548.0</td>
      <td>1554</td>
      <td>534</td>
      <td>4.3487</td>
      <td>200700.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>2670</th>
      <td>-115.60</td>
      <td>33.20</td>
      <td>37.0</td>
      <td>709</td>
      <td>187.0</td>
      <td>390</td>
      <td>142</td>
      <td>2.4511</td>
      <td>72500.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>15709</th>
      <td>-122.43</td>
      <td>37.79</td>
      <td>25.0</td>
      <td>1637</td>
      <td>394.0</td>
      <td>649</td>
      <td>379</td>
      <td>5.0049</td>
      <td>460000.0</td>
      <td>NEAR BAY</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7616</th>
      <td>-118.22</td>
      <td>33.86</td>
      <td>16.0</td>
      <td>8732</td>
      <td>1489.0</td>
      <td>3944</td>
      <td>1493</td>
      <td>5.1948</td>
      <td>203500.0</td>
      <td>&lt;1H OCEAN</td>
    </tr>
    <tr>
      <th>8767</th>
      <td>-118.39</td>
      <td>33.81</td>
      <td>35.0</td>
      <td>1008</td>
      <td>165.0</td>
      <td>391</td>
      <td>167</td>
      <td>3.7778</td>
      <td>487500.0</td>
      <td>NEAR OCEAN</td>
    </tr>
    <tr>
      <th>16388</th>
      <td>-121.30</td>
      <td>38.05</td>
      <td>52.0</td>
      <td>122</td>
      <td>26.0</td>
      <td>62</td>
      <td>25</td>
      <td>1.1500</td>
      <td>112500.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>19949</th>
      <td>-119.37</td>
      <td>36.21</td>
      <td>35.0</td>
      <td>2228</td>
      <td>476.0</td>
      <td>1567</td>
      <td>449</td>
      <td>1.4455</td>
      <td>54100.0</td>
      <td>INLAND</td>
    </tr>
    <tr>
      <th>10078</th>
      <td>-120.27</td>
      <td>39.35</td>
      <td>11.0</td>
      <td>2520</td>
      <td>401.0</td>
      <td>397</td>
      <td>165</td>
      <td>4.6650</td>
      <td>145600.0</td>
      <td>INLAND</td>
    </tr>
  </tbody>
</table>
<p>16352 rows × 10 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Anpassung der datatypes</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;total_bedrooms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;total_bedrooms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="deskriptive-statistik">
<h1>Deskriptive Statistik<a class="headerlink" href="#deskriptive-statistik" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<p>In diesem Abschnitt sollen die Variablen genauer auf statistische Merkmale untersucht werden.<br />
Zuerst werden die numerischen Variablen betrachtet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zusammenfassung für alle numerischen Varaiblen</span>
<span class="nb">round</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>longitude</th>
      <td>16352.0</td>
      <td>-119.6</td>
      <td>2.0</td>
      <td>-124.4</td>
      <td>-121.8</td>
      <td>-118.5</td>
      <td>-118.0</td>
      <td>-114.3</td>
    </tr>
    <tr>
      <th>latitude</th>
      <td>16352.0</td>
      <td>35.6</td>
      <td>2.1</td>
      <td>32.5</td>
      <td>33.9</td>
      <td>34.3</td>
      <td>37.7</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>housing_median_age</th>
      <td>16352.0</td>
      <td>28.6</td>
      <td>12.6</td>
      <td>1.0</td>
      <td>18.0</td>
      <td>29.0</td>
      <td>37.0</td>
      <td>52.0</td>
    </tr>
    <tr>
      <th>total_rooms</th>
      <td>16352.0</td>
      <td>2625.3</td>
      <td>2151.9</td>
      <td>2.0</td>
      <td>1449.8</td>
      <td>2122.0</td>
      <td>3133.0</td>
      <td>39320.0</td>
    </tr>
    <tr>
      <th>total_bedrooms</th>
      <td>16352.0</td>
      <td>535.9</td>
      <td>416.5</td>
      <td>1.0</td>
      <td>295.0</td>
      <td>434.0</td>
      <td>644.0</td>
      <td>6445.0</td>
    </tr>
    <tr>
      <th>population</th>
      <td>16352.0</td>
      <td>1420.3</td>
      <td>1100.8</td>
      <td>3.0</td>
      <td>787.0</td>
      <td>1163.0</td>
      <td>1724.0</td>
      <td>28566.0</td>
    </tr>
    <tr>
      <th>households</th>
      <td>16352.0</td>
      <td>497.5</td>
      <td>377.2</td>
      <td>1.0</td>
      <td>280.0</td>
      <td>408.0</td>
      <td>602.0</td>
      <td>6082.0</td>
    </tr>
    <tr>
      <th>median_income</th>
      <td>16352.0</td>
      <td>3.9</td>
      <td>1.9</td>
      <td>0.5</td>
      <td>2.6</td>
      <td>3.5</td>
      <td>4.7</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>median_house_value</th>
      <td>16352.0</td>
      <td>206867.1</td>
      <td>115747.7</td>
      <td>14999.0</td>
      <td>119400.0</td>
      <td>179400.0</td>
      <td>265000.0</td>
      <td>500001.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Folgende Auffälligkeiten sind hier zu sehen:</p>
<ul class="simple">
<li><p>Bei den Variablen <em>total_rooms</em>,<em>total_bedrooms</em>, <em>population</em> und <em>households</em> liegt der höchste Wert über dem 10 fachen des Wertes des 3 Quartils. Das deutet darauf ein, dass es einen oder wenige Distrikte gibt, welche viel größer sind als die Mehrzahl der Distrikte. Dies könnte im Feature Engineering ausgeglichen werden, indem durch Durchschnitsswerte die größe des Distrikts relativiert wird (bspw. Räume pro Person anstatt Räume im gesamten Distrikt)</p></li>
<li><p>Bei der Variablen <em>median_income</em> fällt auf, dass der höchste Werte sehr hoch liegt im Vergleich zur Verteilung auf die Quartile (75% liegen unter 4.7, max bei 15.0)</p></li>
</ul>
<blockquote>
<div><p>MEHR BESCHREIBEN</p>
</div></blockquote>
<p>Als nächstes werden die kategorialen Variablen betrachtet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ocean_proximity</th>
      <td>16352</td>
      <td>5</td>
      <td>&lt;1H OCEAN</td>
      <td>7225</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;1H OCEAN     7225
INLAND        5228
NEAR OCEAN    2107
NEAR BAY      1788
ISLAND           4
Name: ocean_proximity, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;1H OCEAN     0.441842
INLAND        0.319716
NEAR OCEAN    0.128853
NEAR BAY      0.109344
ISLAND        0.000245
Name: ocean_proximity, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Da die kategoriale Variable <em>price_category</em> bereits entfernt wurde, existiert nur noch <em>ocean_proximity</em> als kategoriale Variable. Diese hat fünf Ausprägungen. Vor allem die Ausprägung <em>ISLAND</em> ist mit nur vier Observation sehr schwach vertreten. Diese könnte man ggfs. später mit anderen ähnlichen Ausprägungen zusammenführen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen von Histogrammen</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_50_0.png" src="_images/regression_50_0.png" />
</div>
</div>
<p>Bei einem Blick auf die Histogramme fällt auf, dass es bei unserer vorherzusagenden Variablen <em>median_house_value</em> eine große Anzahl an Observations gibt, die einen extrem hohen Wert besitzen (ca. 500.000$).<br />
Auch bei <em>housing_median_age</em> gibt es eine auffällig große Menge an Observations mit dem größten Wert (52 Jahre).</p>
<p>Evtl. wurden bei der Datenerhebung alle Werte größer den hier auffälligen Werten auf diesen Höchstwert gesetzt. Das könnte die Datenlage erklären, lässt sich in diesem Fall allerdings nicht klären.</p>
<p>Bei den Geokoordinaten fällt auf, dass sich Observations um bestimmte Koordinaten herum häufen. Das kann auf Bevölkerungsdichte Regionen mit vielen Distrikten hinweisen, wie bspw. bei großen Städten.</p>
</section>
<section id="exploratory-data-analysis">
<h1>Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<section id="uberblick">
<h2>Überblick<a class="headerlink" href="#uberblick" title="Permalink to this headline">¶</a></h2>
<p>Nachdem die statistischen Besonderheiten berachtet wurden, soll nun die Verteilung der Variablen sowie deren Abhängigkeiten untereinander sowie auf die vorherzusagende Variable untersucht werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pairplot für numerische Variablen mit Farbmarkierung für ocean_proximity</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_15996</span><span class="o">/</span><span class="mf">1502785857.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># Pairplot für numerische Variablen mit Farbmarkierung für ocean_proximity</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">);</span>

<span class="nn">~\Anaconda\lib\site-packages\seaborn\_decorators.py</span> in <span class="ni">inner_f</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span>             <span class="p">)</span>
<span class="nn">     45         kwargs.update({k: arg for k, arg</span> in <span class="ni">zip</span><span class="nt">(sig.parameters, args)})</span>
<span class="ne">---&gt; </span><span class="mi">46</span>         <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">47</span>     <span class="k">return</span> <span class="n">inner_f</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span> 

<span class="nn">~\Anaconda\lib\site-packages\seaborn\axisgrid.py</span> in <span class="ni">pairplot</span><span class="nt">(data, hue, hue_order, palette, vars, x_vars, y_vars, kind, diag_kind, markers, height, aspect, corner, dropna, plot_kws, diag_kws, grid_kws, size)</span>
<span class="g g-Whitespace">   </span><span class="mi">2152</span>     <span class="c1"># Add a legend</span>
<span class="g g-Whitespace">   </span><span class="mi">2153</span>     <span class="k">if</span> <span class="n">hue</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">-&gt; </span><span class="mi">2154</span>         <span class="n">grid</span><span class="o">.</span><span class="n">add_legend</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">2155</span> 
<span class="g g-Whitespace">   </span><span class="mi">2156</span>     <span class="n">grid</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="nn">~\Anaconda\lib\site-packages\seaborn\axisgrid.py</span> in <span class="ni">add_legend</span><span class="nt">(self, legend_data, title, label_order, adjust_subtitles, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">171</span> 
<span class="g g-Whitespace">    </span><span class="mi">172</span>             <span class="c1"># Draw the plot again to get the new transformations</span>
<span class="ne">--&gt; </span><span class="mi">173</span>             <span class="n">_draw_figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_figure</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> 
<span class="g g-Whitespace">    </span><span class="mi">175</span>             <span class="c1"># Now calculate how much space we need on the right side</span>

<span class="nn">~\Anaconda\lib\site-packages\seaborn\utils.py</span> in <span class="ni">_draw_figure</span><span class="nt">(fig)</span>
<span class="g g-Whitespace">     </span><span class="mi">93</span>     <span class="sd">&quot;&quot;&quot;Force draw of a matplotlib figure, accounting for back-compat.&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">94</span>     <span class="c1"># See https://github.com/matplotlib/matplotlib/issues/19197 for context</span>
<span class="ne">---&gt; </span><span class="mi">95</span>     <span class="n">fig</span><span class="o">.</span><span class="n">canvas</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span>     <span class="k">if</span> <span class="n">fig</span><span class="o">.</span><span class="n">stale</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span>         <span class="k">try</span><span class="p">:</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\backends\backend_agg.py</span> in <span class="ni">draw</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">434</span>              <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span><span class="o">.</span><span class="n">_wait_cursor_for_draw_cm</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolbar</span>
<span class="g g-Whitespace">    </span><span class="mi">435</span>               <span class="k">else</span> <span class="n">nullcontext</span><span class="p">()):</span>
<span class="ne">--&gt; </span><span class="mi">436</span>             <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">437</span>             <span class="c1"># A GUI class may be need to update a window using this draw, so</span>
<span class="g g-Whitespace">    </span><span class="mi">438</span>             <span class="c1"># don&#39;t forget to call the superclass.</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\artist.py</span> in <span class="ni">draw_wrapper</span><span class="nt">(artist, renderer, *args, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">71</span>     <span class="nd">@wraps</span><span class="p">(</span><span class="n">draw</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">72</span>     <span class="k">def</span> <span class="nf">draw_wrapper</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">73</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">74</span>         <span class="k">if</span> <span class="n">renderer</span><span class="o">.</span><span class="n">_rasterizing</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">75</span>             <span class="n">renderer</span><span class="o">.</span><span class="n">stop_rasterizing</span><span class="p">()</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\artist.py</span> in <span class="ni">draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>                 <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="ne">---&gt; </span><span class="mi">50</span>             <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>         <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>             <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\figure.py</span> in <span class="ni">draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">   </span><span class="mi">2801</span> 
<span class="g g-Whitespace">   </span><span class="mi">2802</span>             <span class="bp">self</span><span class="o">.</span><span class="n">patch</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">2803</span>             <span class="n">mimage</span><span class="o">.</span><span class="n">_draw_list_compositing_images</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">2804</span>                 <span class="n">renderer</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">suppressComposite</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2805</span> 

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\image.py</span> in <span class="ni">_draw_list_compositing_images</span><span class="nt">(renderer, parent, artists, suppress_composite)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="k">if</span> <span class="n">not_composite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_images</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span>         <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">132</span>             <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>         <span class="c1"># Composite any adjacent images together</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\artist.py</span> in <span class="ni">draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>                 <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="ne">---&gt; </span><span class="mi">50</span>             <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>         <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>             <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\axes\_base.py</span> in <span class="ni">draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">   </span><span class="mi">3080</span>             <span class="n">renderer</span><span class="o">.</span><span class="n">stop_rasterizing</span><span class="p">()</span>
<span class="g g-Whitespace">   </span><span class="mi">3081</span> 
<span class="ne">-&gt; </span><span class="mi">3082</span>         <span class="n">mimage</span><span class="o">.</span><span class="n">_draw_list_compositing_images</span><span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">3083</span>             <span class="n">renderer</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">artists</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">suppressComposite</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">3084</span> 

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\image.py</span> in <span class="ni">_draw_list_compositing_images</span><span class="nt">(renderer, parent, artists, suppress_composite)</span>
<span class="g g-Whitespace">    </span><span class="mi">130</span>     <span class="k">if</span> <span class="n">not_composite</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_images</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">131</span>         <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">artists</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">132</span>             <span class="n">a</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">133</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span>         <span class="c1"># Composite any adjacent images together</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\artist.py</span> in <span class="ni">draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>                 <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="ne">---&gt; </span><span class="mi">50</span>             <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>         <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>             <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\collections.py</span> in <span class="ni">draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">    </span><span class="mi">987</span>     <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">renderer</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">988</span>         <span class="bp">self</span><span class="o">.</span><span class="n">set_sizes</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sizes</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">dpi</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">989</span>         <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">990</span> 
<span class="g g-Whitespace">    </span><span class="mi">991</span> 

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\artist.py</span> in <span class="ni">draw_wrapper</span><span class="nt">(artist, renderer)</span>
<span class="g g-Whitespace">     </span><span class="mi">48</span>                 <span class="n">renderer</span><span class="o">.</span><span class="n">start_filter</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="ne">---&gt; </span><span class="mi">50</span>             <span class="k">return</span> <span class="n">draw</span><span class="p">(</span><span class="n">artist</span><span class="p">,</span> <span class="n">renderer</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">51</span>         <span class="k">finally</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>             <span class="k">if</span> <span class="n">artist</span><span class="o">.</span><span class="n">get_agg_filter</span><span class="p">()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\collections.py</span> in <span class="ni">draw</span><span class="nt">(self, renderer)</span>
<span class="g g-Whitespace">    </span><span class="mi">424</span>                 <span class="n">mpath</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">offsets</span><span class="p">),</span> <span class="n">transOffset</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">facecolors</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="g g-Whitespace">    </span><span class="mi">425</span>         <span class="k">else</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">426</span>             <span class="n">renderer</span><span class="o">.</span><span class="n">draw_path_collection</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">427</span>                 <span class="n">gc</span><span class="p">,</span> <span class="n">transform</span><span class="o">.</span><span class="n">frozen</span><span class="p">(),</span> <span class="n">paths</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">428</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">get_transforms</span><span class="p">(),</span> <span class="n">offsets</span><span class="p">,</span> <span class="n">transOffset</span><span class="p">,</span>

<span class="nn">~\Anaconda\lib\site-packages\matplotlib\path.py</span> in <span class="ni">vertices</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">198</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">199</span> 
<span class="ne">--&gt; </span><span class="mi">200</span>     <span class="nd">@property</span>
<span class="g g-Whitespace">    </span><span class="mi">201</span>     <span class="k">def</span> <span class="nf">vertices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">202</span>         <span class="s2">&quot;&quot;&quot;</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<p><strong>Erkenntnis:</strong></p>
<ul class="simple">
<li><p>Einfluss auf Y Variable: Ein Zusammenhang zwischen <em>median_income</em> und <em>median_house_value</em> ist zu erkennen, ansonsten gibt es erstmal keine weiteren offensichtlichen Zusammenhänge.</p></li>
<li><p>Variablen untereinander: Es gibt starke lineare Zusammenhänge zwischen <em>total_rooms</em>, <em>total_bedrooms</em>, <em>households</em> und <em>population</em>. Das ist soweit logisch und muss bei der Modellierung später beachtet werden (Collinearity).</p></li>
</ul>
<p>Auch an Hand der Korrelationswerte lässt sich erkennen, dass lediglich <em>median_income</em> einen starken Einfluss auf <em>median_house_value</em> hat.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median_house_value    1.000000
median_income         0.686220
total_rooms           0.131430
housing_median_age    0.107960
households            0.064087
total_bedrooms        0.048334
population           -0.028566
longitude            -0.044550
latitude             -0.146066
Name: median_house_value, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create correlation matrix for numerical variables</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr_matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>longitude</th>
      <td>1.000000</td>
      <td>-0.923717</td>
      <td>-0.107507</td>
      <td>0.043284</td>
      <td>0.068231</td>
      <td>0.098328</td>
      <td>0.054403</td>
      <td>-0.016315</td>
      <td>-0.044550</td>
    </tr>
    <tr>
      <th>latitude</th>
      <td>-0.923717</td>
      <td>1.000000</td>
      <td>0.007414</td>
      <td>-0.033678</td>
      <td>-0.065700</td>
      <td>-0.108429</td>
      <td>-0.070936</td>
      <td>-0.077886</td>
      <td>-0.146066</td>
    </tr>
    <tr>
      <th>housing_median_age</th>
      <td>-0.107507</td>
      <td>0.007414</td>
      <td>1.000000</td>
      <td>-0.357994</td>
      <td>-0.314841</td>
      <td>-0.293407</td>
      <td>-0.295959</td>
      <td>-0.116747</td>
      <td>0.107960</td>
    </tr>
    <tr>
      <th>total_rooms</th>
      <td>0.043284</td>
      <td>-0.033678</td>
      <td>-0.357994</td>
      <td>1.000000</td>
      <td>0.928974</td>
      <td>0.858447</td>
      <td>0.916588</td>
      <td>0.197242</td>
      <td>0.131430</td>
    </tr>
    <tr>
      <th>total_bedrooms</th>
      <td>0.068231</td>
      <td>-0.065700</td>
      <td>-0.314841</td>
      <td>0.928974</td>
      <td>1.000000</td>
      <td>0.879519</td>
      <td>0.978453</td>
      <td>-0.010107</td>
      <td>0.048334</td>
    </tr>
    <tr>
      <th>population</th>
      <td>0.098328</td>
      <td>-0.108429</td>
      <td>-0.293407</td>
      <td>0.858447</td>
      <td>0.879519</td>
      <td>1.000000</td>
      <td>0.910632</td>
      <td>0.002679</td>
      <td>-0.028566</td>
    </tr>
    <tr>
      <th>households</th>
      <td>0.054403</td>
      <td>-0.070936</td>
      <td>-0.295959</td>
      <td>0.916588</td>
      <td>0.978453</td>
      <td>0.910632</td>
      <td>1.000000</td>
      <td>0.010742</td>
      <td>0.064087</td>
    </tr>
    <tr>
      <th>median_income</th>
      <td>-0.016315</td>
      <td>-0.077886</td>
      <td>-0.116747</td>
      <td>0.197242</td>
      <td>-0.010107</td>
      <td>0.002679</td>
      <td>0.010742</td>
      <td>1.000000</td>
      <td>0.686220</td>
    </tr>
    <tr>
      <th>median_house_value</th>
      <td>-0.044550</td>
      <td>-0.146066</td>
      <td>0.107960</td>
      <td>0.131430</td>
      <td>0.048334</td>
      <td>-0.028566</td>
      <td>0.064087</td>
      <td>0.686220</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen einer Heatmap um Abhängigkeiten zwischen den verschiedenen Variablen zu visualisieren</span>

<span class="c1"># Use a mask to plot only part of a matrix</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span><span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Erstellen der Heatmap mit zusätzlichen Parametern</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> 
                      <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">,</span> 
                      <span class="n">square</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                      <span class="n">linewidths</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span>
                      <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span>
                      <span class="n">cbar_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shrink&#39;</span><span class="p">:</span> <span class="mf">.6</span><span class="p">,</span>
                                <span class="s1">&#39;ticks&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
                      <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">annot_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_60_0.png" src="_images/regression_60_0.png" />
</div>
</div>
<p>Die oben bereits erkannten Zusammenhänge lassen sich hier nochmal einen Blick bestätigen.</p>
<hr class="docutils" />
<section id="analyse-kategorialer-variablen">
<h3>Analyse kategorialer Variablen<a class="headerlink" href="#analyse-kategorialer-variablen" title="Permalink to this headline">¶</a></h3>
<p>Als nächstes wird die kategoriale Variable <em>ocean_proximity</em> näher untersucht.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;1H OCEAN     7225
INLAND        5228
NEAR OCEAN    2107
NEAR BAY      1788
ISLAND           4
Name: ocean_proximity, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verteilung von ocean_proximity auf Geokoordinaten visualisieren</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_66_0.png" src="_images/regression_66_0.png" />
</div>
</div>
<p>Auf Basis der Geokoordinaten und der Form lässt sich feststellen, dass es sich bei unserem Datensatz um Distrikte aus Kalifornien handelt.<br />
Auf dem Plot lässt sich erkennen, dass sich die Ausprägungen <em>ISLAND</em> und <em>NEAR BAY</em> sehr stark auf bestimmte Gebiete beschränken. Die anderen Ausprägungen sind einigermaßen gleichmäßig und nach einer Logik mit Abstand zum Meer verteilt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualisierung Dichte</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_68_0.png" src="_images/regression_68_0.png" />
</div>
</div>
<p>Durch eine kleine Änderung in den Parametern des Plots lassen sich besonders gut die Gebiete erkennen, aus welchen viele Observations vorliegen. Wie bereits vermutet handelt es sich vor allem um Ballungszentren bei San Francisco und Los Angeles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;jet&quot;</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1f7da63f1f0&gt;
</pre></div>
</div>
<img alt="_images/regression_70_2.png" src="_images/regression_70_2.png" />
</div>
</div>
<p>Mit Hilfe eines erweiterten Scatterplots können wir sogar visualisieren, wo die Distrikts mit den hohen <em>median_house_value</em> liegen. Wie zu erwarten war handelt es sich ebenfalls um die Gebiete rund um San Francisco und Los Angeles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Untersuchung der kategroialen Variable &quot;ocean_proximity&quot; mit einem erweiterten Boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxenplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_72_0.png" src="_images/regression_72_0.png" />
</div>
</div>
<p>Durch ein erweitertes Boxplot Diagramm können wir erkennen, dass die Verteilung von <em>median_house_value</em> in den Ausprägungen <em>&lt;1H OCEAN, NEAR BAY</em> und <em>NEAR OCEAN</em> sehr ähnlich ist. <em>INLAND</em> und <em>ISLAND</em> unterscheiden sich davon stark. Ggfs. könnte es Sinn machen, die ähnlichen Ausprägungen zusammenzufassen, das soll jedoch zuerst in den Modellen getestet werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ergänzung zum Boxplot um Menge und Dichte der Observations zu visualisieren</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span> <span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_74_0.png" src="_images/regression_74_0.png" />
</div>
</div>
<p>Durch eine andere Form der Darstellung lässt sich nochmal gut die Menge und Dicht der Observations erkennen - und dass für <em>ISLAND</em> nur sehr wenige Observations vorliegen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyse von &quot;ocean_proximity&quot; mit displot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x1f7d8d36760&gt;
</pre></div>
</div>
<img alt="_images/regression_76_1.png" src="_images/regression_76_1.png" />
</div>
</div>
<blockquote>
<div><p><strong>Fazit:</strong> Die kategoriale Variable <em>ocean_proximity</em> hat definitiv Einfluss auf unsere vorherzusagende Variable. <em>INLAND</em> ist bspw. tenedneziell günstiger als die Distrikte, die näher am Meer liegen.<br />
Auffällig ist, das es für die Ausprägung <em>ISLAND</em> nur sehr wenige Observations gibt und <em>ISLAND</em> und <em>NEAR BAY</em> stark auf bestimmte Gebiete beschränkt sind.</p>
</div></blockquote>
</section>
<section id="analyse-numerischer-variablen">
<h3>Analyse numerischer Variablen<a class="headerlink" href="#analyse-numerischer-variablen" title="Permalink to this headline">¶</a></h3>
<p>Vor allem die numerische Variable <em>median_income</em> sieht auf Basis des zu Beginn erstellen pairplots vielversprechend aus und wird daher nun näher untersucht. Aber auch andere numerische Varaiblen sollen noch genauer betrachtet werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyse der Variablen &quot;median_income&quot;</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_80_0.png" src="_images/regression_80_0.png" />
</div>
</div>
<p>Wie bereits im Parplot lässt sich hier nochmal gut erkennen, dass tendenziell mit steigendem <em>median_income</em> auch der <em>median_house_value</em> steigt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">},</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_82_0.png" src="_images/regression_82_0.png" />
</div>
</div>
<p>Analyse “total_rooms”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;total_rooms&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;total_rooms&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_84_1.png" src="_images/regression_84_1.png" />
</div>
</div>
<p>Auch bei <em>total_rooms</em> lääst sich ein leichter Trend erkennen. Da es sich allerdings hier um die Gesamtzahl der Räume in einem Distrikt handelt, welche natürlich direkt abhängig von dessen Größe ist, ist diese Variable möglicherweise nicht besonders gut geeignet. Viel besser wäre eine Variable, die die Anzahl der Räume in Relation setzt zur Anzahl an Haushalten oder Menschen. So eine Variable kann später im Feature Engineering erstellt werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;total_rooms&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">},</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_86_0.png" src="_images/regression_86_0.png" />
</div>
</div>
<p>Analyse “housing_median_age”</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;housing_median_age&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_88_1.png" src="_images/regression_88_1.png" />
</div>
</div>
<p>Bei der Variable <em>housing_median_age</em> könnte man eine Auswirkung auf median_house_value erwarten, da neuere Häuser teurer sein könnten als alte Häuser. Anhand der Analyse lässt sich jedoch erkennen, dass diese Auswirkung nur sehr gering ist. Das könnte man bspw. durch teure Altbauwohungen oder durchgeführte Instandhaltungsmaßnahmen erklären.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">},</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_90_0.png" src="_images/regression_90_0.png" />
</div>
</div>
<blockquote>
<div><p><strong>Fazit:</strong> Wie bereits erwartet bietet die Variable <em>median_income</em> das höchste Potential zur Vorhersage von <em>median_house_value</em>. Auch <em>ocean_proximity</em> zeigt eindeutig Auswirkungen auf unsere Y Variable, kann aber ggfs. noch zusammengefasst werden um später die Modelle zu optimieren. Auch bei weiteren Variablen kann Einfluss auf Y gefunden werden, allerdings ist dieser sehr schwach und sollte im Feauture Engineering optimiert werden.</p>
</div></blockquote>
</section>
</section>
</section>
<section id="initial-feature-engineering">
<h1>Initial Feature Engineering<a class="headerlink" href="#initial-feature-engineering" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<section id="erstellen-eigener-variablen">
<h2>Erstellen eigener Variablen<a class="headerlink" href="#erstellen-eigener-variablen" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen neuer Variablen</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">people_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">population</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_room</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="analyse-optimierung">
<h2>Analyse &amp; Optimierung<a class="headerlink" href="#analyse-optimierung" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median_house_value        1.000000
median_income             0.686220
rooms_per_household       0.138533
total_rooms               0.131430
housing_median_age        0.107960
households                0.064087
total_bedrooms            0.048334
people_per_household     -0.021874
population               -0.028566
longitude                -0.044550
bedrooms_per_household   -0.047168
latitude                 -0.146066
bedrooms_per_room        -0.253441
Name: median_house_value, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Anhand der Matrix lässt sich erkennen, dass von den neu erstellten Varaiblen vor allem <em>bedrooms_per_room</em> und <em>rooms_per_household</em> einen Einfluss auf die vorherzusagende Variable <em>median_house_value</em> haben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Analyse neu erstellter Variablen</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">y_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">],</span> <span class="n">x_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;people_per_household&quot;</span><span class="p">,</span> <span class="s2">&quot;bedrooms_per_household&quot;</span><span class="p">,</span> <span class="s2">&quot;rooms_per_household&quot;</span><span class="p">,</span> <span class="s2">&quot;bedrooms_per_room&quot;</span><span class="p">],</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_98_0.png" src="_images/regression_98_0.png" />
</div>
</div>
<p>Hier lassen sich Outlier bei <em>people_per_household</em>, <em>bedrooms_per_household</em> und <em>rooms_per_household</em> erkennen. Diese können später entfernt werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;bedrooms_per_room&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_100_1.png" src="_images/regression_100_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_101_0.png" src="_images/regression_101_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rooms_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;rooms_per_household&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_102_1.png" src="_images/regression_102_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rooms_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_103_0.png" src="_images/regression_103_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;people_per_household&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_104_1.png" src="_images/regression_104_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_105_0.png" src="_images/regression_105_0.png" />
</div>
</div>
<p>Die zuvor auf dem Scatterplot aufgefallenen Outliers von <em>people_per_household</em> sollen nun identifiziert und entfernt werden. Distrikte, in denen im Schnitt mehrere hundert Menschen in einem Haushalt leben klingen nach fehlerhaften Daten (Unterschiedliche Methode in der Erfassung der Daten, Tippfehler etc.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">nlargest</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;people_per_household&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>people_per_household</th>
      <th>bedrooms_per_household</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_room</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>19006</th>
      <td>-121.98</td>
      <td>38.32</td>
      <td>45.0</td>
      <td>19</td>
      <td>5</td>
      <td>7460</td>
      <td>6</td>
      <td>10.2264</td>
      <td>137500.0</td>
      <td>INLAND</td>
      <td>1243.333333</td>
      <td>0.833333</td>
      <td>3.166667</td>
      <td>0.263158</td>
    </tr>
    <tr>
      <th>3364</th>
      <td>-120.51</td>
      <td>40.41</td>
      <td>36.0</td>
      <td>36</td>
      <td>8</td>
      <td>4198</td>
      <td>7</td>
      <td>5.5179</td>
      <td>67500.0</td>
      <td>INLAND</td>
      <td>599.714286</td>
      <td>1.142857</td>
      <td>5.142857</td>
      <td>0.222222</td>
    </tr>
    <tr>
      <th>16669</th>
      <td>-120.70</td>
      <td>35.32</td>
      <td>46.0</td>
      <td>118</td>
      <td>17</td>
      <td>6532</td>
      <td>13</td>
      <td>4.2639</td>
      <td>350000.0</td>
      <td>NEAR OCEAN</td>
      <td>502.461538</td>
      <td>1.307692</td>
      <td>9.076923</td>
      <td>0.144068</td>
    </tr>
    <tr>
      <th>13034</th>
      <td>-121.15</td>
      <td>38.69</td>
      <td>52.0</td>
      <td>240</td>
      <td>44</td>
      <td>6675</td>
      <td>29</td>
      <td>6.1359</td>
      <td>225000.0</td>
      <td>INLAND</td>
      <td>230.172414</td>
      <td>1.517241</td>
      <td>8.275862</td>
      <td>0.183333</td>
    </tr>
    <tr>
      <th>9172</th>
      <td>-118.59</td>
      <td>34.47</td>
      <td>5.0</td>
      <td>538</td>
      <td>98</td>
      <td>8733</td>
      <td>105</td>
      <td>4.2391</td>
      <td>154600.0</td>
      <td>INLAND</td>
      <td>83.171429</td>
      <td>0.933333</td>
      <td>5.123810</td>
      <td>0.182156</td>
    </tr>
    <tr>
      <th>12104</th>
      <td>-117.33</td>
      <td>33.97</td>
      <td>8.0</td>
      <td>152</td>
      <td>19</td>
      <td>1275</td>
      <td>20</td>
      <td>1.6250</td>
      <td>162500.0</td>
      <td>INLAND</td>
      <td>63.750000</td>
      <td>0.950000</td>
      <td>7.600000</td>
      <td>0.125000</td>
    </tr>
    <tr>
      <th>16420</th>
      <td>-121.29</td>
      <td>37.89</td>
      <td>26.0</td>
      <td>161</td>
      <td>27</td>
      <td>1542</td>
      <td>30</td>
      <td>5.7485</td>
      <td>162500.0</td>
      <td>INLAND</td>
      <td>51.400000</td>
      <td>0.900000</td>
      <td>5.366667</td>
      <td>0.167702</td>
    </tr>
    <tr>
      <th>8874</th>
      <td>-118.45</td>
      <td>34.06</td>
      <td>52.0</td>
      <td>204</td>
      <td>34</td>
      <td>1154</td>
      <td>28</td>
      <td>9.3370</td>
      <td>500001.0</td>
      <td>&lt;1H OCEAN</td>
      <td>41.214286</td>
      <td>1.214286</td>
      <td>7.285714</td>
      <td>0.166667</td>
    </tr>
    <tr>
      <th>5986</th>
      <td>-117.71</td>
      <td>34.10</td>
      <td>52.0</td>
      <td>567</td>
      <td>152</td>
      <td>2688</td>
      <td>126</td>
      <td>1.8750</td>
      <td>212500.0</td>
      <td>INLAND</td>
      <td>21.333333</td>
      <td>1.206349</td>
      <td>4.500000</td>
      <td>0.268078</td>
    </tr>
    <tr>
      <th>20352</th>
      <td>-119.09</td>
      <td>34.22</td>
      <td>8.0</td>
      <td>40</td>
      <td>10</td>
      <td>309</td>
      <td>16</td>
      <td>4.0208</td>
      <td>52500.0</td>
      <td>NEAR OCEAN</td>
      <td>19.312500</td>
      <td>0.625000</td>
      <td>2.500000</td>
      <td>0.250000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">nlargest</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;rooms_per_household&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>people_per_household</th>
      <th>bedrooms_per_household</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_room</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1914</th>
      <td>-120.10</td>
      <td>38.91</td>
      <td>33.0</td>
      <td>1561</td>
      <td>282</td>
      <td>30</td>
      <td>11</td>
      <td>1.8750</td>
      <td>500001.0</td>
      <td>INLAND</td>
      <td>2.727273</td>
      <td>25.636364</td>
      <td>141.909091</td>
      <td>0.180653</td>
    </tr>
    <tr>
      <th>1979</th>
      <td>-120.08</td>
      <td>38.80</td>
      <td>34.0</td>
      <td>1988</td>
      <td>511</td>
      <td>36</td>
      <td>15</td>
      <td>4.6250</td>
      <td>162500.0</td>
      <td>INLAND</td>
      <td>2.400000</td>
      <td>34.066667</td>
      <td>132.533333</td>
      <td>0.257042</td>
    </tr>
    <tr>
      <th>12447</th>
      <td>-114.49</td>
      <td>33.97</td>
      <td>17.0</td>
      <td>2809</td>
      <td>635</td>
      <td>83</td>
      <td>45</td>
      <td>1.6154</td>
      <td>87500.0</td>
      <td>INLAND</td>
      <td>1.844444</td>
      <td>14.111111</td>
      <td>62.422222</td>
      <td>0.226059</td>
    </tr>
    <tr>
      <th>11862</th>
      <td>-121.25</td>
      <td>40.27</td>
      <td>25.0</td>
      <td>958</td>
      <td>245</td>
      <td>28</td>
      <td>16</td>
      <td>2.6250</td>
      <td>67500.0</td>
      <td>INLAND</td>
      <td>1.750000</td>
      <td>15.312500</td>
      <td>59.875000</td>
      <td>0.255741</td>
    </tr>
    <tr>
      <th>1912</th>
      <td>-120.16</td>
      <td>39.01</td>
      <td>16.0</td>
      <td>1463</td>
      <td>264</td>
      <td>54</td>
      <td>26</td>
      <td>4.9750</td>
      <td>206300.0</td>
      <td>INLAND</td>
      <td>2.076923</td>
      <td>10.153846</td>
      <td>56.269231</td>
      <td>0.180451</td>
    </tr>
    <tr>
      <th>9676</th>
      <td>-119.02</td>
      <td>37.64</td>
      <td>14.0</td>
      <td>5919</td>
      <td>1278</td>
      <td>265</td>
      <td>112</td>
      <td>3.2431</td>
      <td>221400.0</td>
      <td>INLAND</td>
      <td>2.366071</td>
      <td>11.410714</td>
      <td>52.848214</td>
      <td>0.215915</td>
    </tr>
    <tr>
      <th>11707</th>
      <td>-120.06</td>
      <td>39.15</td>
      <td>22.0</td>
      <td>2213</td>
      <td>372</td>
      <td>98</td>
      <td>42</td>
      <td>1.1912</td>
      <td>170000.0</td>
      <td>INLAND</td>
      <td>2.333333</td>
      <td>8.857143</td>
      <td>52.690476</td>
      <td>0.168098</td>
    </tr>
    <tr>
      <th>2395</th>
      <td>-119.34</td>
      <td>37.12</td>
      <td>23.0</td>
      <td>1881</td>
      <td>380</td>
      <td>64</td>
      <td>37</td>
      <td>3.8750</td>
      <td>125000.0</td>
      <td>INLAND</td>
      <td>1.729730</td>
      <td>10.270270</td>
      <td>50.837838</td>
      <td>0.202020</td>
    </tr>
    <tr>
      <th>1240</th>
      <td>-120.19</td>
      <td>38.42</td>
      <td>11.0</td>
      <td>1568</td>
      <td>369</td>
      <td>82</td>
      <td>33</td>
      <td>3.1250</td>
      <td>77500.0</td>
      <td>INLAND</td>
      <td>2.484848</td>
      <td>11.181818</td>
      <td>47.515152</td>
      <td>0.235332</td>
    </tr>
    <tr>
      <th>11832</th>
      <td>-120.33</td>
      <td>39.30</td>
      <td>16.0</td>
      <td>868</td>
      <td>178</td>
      <td>44</td>
      <td>21</td>
      <td>3.0000</td>
      <td>175000.0</td>
      <td>INLAND</td>
      <td>2.095238</td>
      <td>8.476190</td>
      <td>41.333333</td>
      <td>0.205069</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">nlargest</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="s1">&#39;bedrooms_per_household&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>people_per_household</th>
      <th>bedrooms_per_household</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_room</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1979</th>
      <td>-120.08</td>
      <td>38.80</td>
      <td>34.0</td>
      <td>1988</td>
      <td>511</td>
      <td>36</td>
      <td>15</td>
      <td>4.6250</td>
      <td>162500.0</td>
      <td>INLAND</td>
      <td>2.400000</td>
      <td>34.066667</td>
      <td>132.533333</td>
      <td>0.257042</td>
    </tr>
    <tr>
      <th>1914</th>
      <td>-120.10</td>
      <td>38.91</td>
      <td>33.0</td>
      <td>1561</td>
      <td>282</td>
      <td>30</td>
      <td>11</td>
      <td>1.8750</td>
      <td>500001.0</td>
      <td>INLAND</td>
      <td>2.727273</td>
      <td>25.636364</td>
      <td>141.909091</td>
      <td>0.180653</td>
    </tr>
    <tr>
      <th>11862</th>
      <td>-121.25</td>
      <td>40.27</td>
      <td>25.0</td>
      <td>958</td>
      <td>245</td>
      <td>28</td>
      <td>16</td>
      <td>2.6250</td>
      <td>67500.0</td>
      <td>INLAND</td>
      <td>1.750000</td>
      <td>15.312500</td>
      <td>59.875000</td>
      <td>0.255741</td>
    </tr>
    <tr>
      <th>12447</th>
      <td>-114.49</td>
      <td>33.97</td>
      <td>17.0</td>
      <td>2809</td>
      <td>635</td>
      <td>83</td>
      <td>45</td>
      <td>1.6154</td>
      <td>87500.0</td>
      <td>INLAND</td>
      <td>1.844444</td>
      <td>14.111111</td>
      <td>62.422222</td>
      <td>0.226059</td>
    </tr>
    <tr>
      <th>9676</th>
      <td>-119.02</td>
      <td>37.64</td>
      <td>14.0</td>
      <td>5919</td>
      <td>1278</td>
      <td>265</td>
      <td>112</td>
      <td>3.2431</td>
      <td>221400.0</td>
      <td>INLAND</td>
      <td>2.366071</td>
      <td>11.410714</td>
      <td>52.848214</td>
      <td>0.215915</td>
    </tr>
    <tr>
      <th>1240</th>
      <td>-120.19</td>
      <td>38.42</td>
      <td>11.0</td>
      <td>1568</td>
      <td>369</td>
      <td>82</td>
      <td>33</td>
      <td>3.1250</td>
      <td>77500.0</td>
      <td>INLAND</td>
      <td>2.484848</td>
      <td>11.181818</td>
      <td>47.515152</td>
      <td>0.235332</td>
    </tr>
    <tr>
      <th>2395</th>
      <td>-119.34</td>
      <td>37.12</td>
      <td>23.0</td>
      <td>1881</td>
      <td>380</td>
      <td>64</td>
      <td>37</td>
      <td>3.8750</td>
      <td>125000.0</td>
      <td>INLAND</td>
      <td>1.729730</td>
      <td>10.270270</td>
      <td>50.837838</td>
      <td>0.202020</td>
    </tr>
    <tr>
      <th>1912</th>
      <td>-120.16</td>
      <td>39.01</td>
      <td>16.0</td>
      <td>1463</td>
      <td>264</td>
      <td>54</td>
      <td>26</td>
      <td>4.9750</td>
      <td>206300.0</td>
      <td>INLAND</td>
      <td>2.076923</td>
      <td>10.153846</td>
      <td>56.269231</td>
      <td>0.180451</td>
    </tr>
    <tr>
      <th>1102</th>
      <td>-121.54</td>
      <td>40.06</td>
      <td>17.0</td>
      <td>858</td>
      <td>262</td>
      <td>47</td>
      <td>27</td>
      <td>2.4028</td>
      <td>67500.0</td>
      <td>INLAND</td>
      <td>1.740741</td>
      <td>9.703704</td>
      <td>31.777778</td>
      <td>0.305361</td>
    </tr>
    <tr>
      <th>1872</th>
      <td>-119.93</td>
      <td>38.94</td>
      <td>27.0</td>
      <td>1709</td>
      <td>408</td>
      <td>97</td>
      <td>44</td>
      <td>2.4917</td>
      <td>200000.0</td>
      <td>INLAND</td>
      <td>2.204545</td>
      <td>9.272727</td>
      <td>38.840909</td>
      <td>0.238736</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># people_per_household outlier droppen</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">19006</span><span class="p">,</span><span class="mi">3364</span><span class="p">,</span><span class="mi">16669</span><span class="p">,</span><span class="mi">13034</span><span class="p">])</span>
<span class="c1"># rooms_per_household outlier droppen</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">1914</span><span class="p">,</span><span class="mi">1979</span><span class="p">])</span>
<span class="c1"># bedrooms_per_household bereits in anderen enthalten und gedropped</span>
</pre></div>
</div>
</div>
</div>
<p>Nach dem Entfernen der Outlier lässt sich eine stärke Auswirkung der Features auf die Y Variable erkennen</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_112_0.png" src="_images/regression_112_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rooms_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_113_0.png" src="_images/regression_113_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_114_0.png" src="_images/regression_114_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median_house_value        1.000000
median_income             0.687062
rooms_per_household       0.158067
total_rooms               0.131529
housing_median_age        0.107943
households                0.064261
total_bedrooms            0.048417
population               -0.028492
longitude                -0.044560
bedrooms_per_household   -0.068008
latitude                 -0.146165
people_per_household     -0.161934
bedrooms_per_room        -0.253301
Name: median_house_value, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="auswahl-features">
<h2>Auswahl Features<a class="headerlink" href="#auswahl-features" title="Permalink to this headline">¶</a></h2>
<p>Auf Basis der vorhergegangenen Analysen sollen nun vorläufige Features zur Modellierung ausgewählt werden. Da nicht mehrere Features gewählt werden sollten, welche sich aus den selben Variablen berechnen, wird jeweils die Variable mit der vielversprechendsten Correlation zu Y ausgewählt (bspw. <em>bedrooms_per_room</em> &gt; <em>rooms_per_household</em> ).</p>
<ul class="simple">
<li><p><em>median_income</em></p></li>
<li><p><em>bedrooms_per_room</em></p></li>
<li><p><em>people_per_household</em></p></li>
<li><p><em>ocean_proximity</em></p></li>
<li><p><em>housing_median_age</em></p></li>
</ul>
<p>Obwohl <em>latitude</em> auch eine vielversprechende Correlation zeigt, wird diese Varaible nicht als feature für die Modelle ausgewählt, da geografische Informationen bereits in <em>ocean_proximity</em> enthalten sind.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># choose features and add constant</span>
<span class="n">features</span> <span class="o">=</span> <span class="n">add_constant</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="s1">&#39;median_income&#39;</span><span class="p">,</span><span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span><span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]])</span>
<span class="c1"># create empty DataFrame</span>
<span class="n">vif</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="c1"># calculate vif</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;VIF Factor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">variance_inflation_factor</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">features</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
<span class="c1"># add feature names</span>
<span class="n">vif</span><span class="p">[</span><span class="s2">&quot;Feature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">columns</span>

<span class="n">vif</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\olive\Anaconda\lib\site-packages\statsmodels\tsa\tsatools.py:142: FutureWarning: In a future version of pandas all arguments of concat except for the argument &#39;objs&#39; will be keyword-only
  x = pd.concat(x[::order], 1)
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>VIF Factor</th>
      <th>Feature</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>56.59</td>
      <td>const</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.30</td>
      <td>median_house_value</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3.29</td>
      <td>median_income</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1.76</td>
      <td>bedrooms_per_room</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1.04</td>
      <td>people_per_household</td>
    </tr>
    <tr>
      <th>5</th>
      <td>1.09</td>
      <td>housing_median_age</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Um unsere ausgewählten Variablen auf Multikollinearität zu untersuchen, berechnen wir den Variance Inflation Factor (VIF). Da sich dieser bei allen Variablen unter 5 befindet, stellt die Kollinearität bei diesen Variablen kein Problem dar.</p>
</section>
<section id="erganzung">
<h2>Ergänzung<a class="headerlink" href="#erganzung" title="Permalink to this headline">¶</a></h2>
<p>Nach Durchlauf mehrerer Modelle wird folgendes ergänzt:<br />
Die Ausprägungen <em>ISLAND</em>, <em>NEAR</em> <em>BAY</em> und <em>NEAR</em> <em>OCEAN</em> der Variablen <em>ocean_proximity</em> wurden in verschiedenen Modellen (Classification &amp; Regression) durch P-Values oder Koeffizienten als unwichtig eingestuft.
Daher werden diese nun zu einer Ausprägung zusammengefasst.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ISLAND&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NEAR BAY&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NEAR OCEAN&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;1H OCEAN&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># durch die gerade stattgefundene Transformation muss der datatype wieder korrigiert werden</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>NEAR WATER    11123
INLAND         5223
Name: ocean_proximity, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verteilung von ocean_proximity auf Geokoordinaten visualisieren</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_125_0.png" src="_images/regression_125_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Untersuchung der kategroialen Variable &quot;ocean_proximity&quot; mit einem erweiterten Boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxenplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_126_0.png" src="_images/regression_126_0.png" />
</div>
</div>
</section>
</section>
<section id="modelling">
<h1>Modelling<a class="headerlink" href="#modelling" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<section id="linear-ols-regression">
<h2>1. Linear OLS Regression<a class="headerlink" href="#linear-ols-regression" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<section id="model-1-1-linear-ols-regression-mit-scikit-learn">
<h3>Model 1.1 - Linear OLS Regression mit scikit learn<a class="headerlink" href="#model-1-1-linear-ols-regression-mit-scikit-learn" title="Permalink to this headline">¶</a></h3>
<section id="modellierung">
<h4>Modellierung<a class="headerlink" href="#modellierung" title="Permalink to this headline">¶</a></h4>
<p>Mit den zuvor ausgewählten Variablen testen wir nun das Lineare Regressionsmodell von scikit learn.<br />
Um die Daten in das für scikit learn benötigte Format zu bringen, führen wir erneut einen datasplit durch. Da wir bereits vom Anfang noch ein Testdatenset haben, wird bei diesem Split ein Validierungsdatenset erzeugt, mit welchem das Modell erst validiert wird, bevor es dann am Ende mit den Testdaten evaluiert wird.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Auswahl der Features und Split der Trainingsdaten in X und Y Varaiblen</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span>
<span class="n">X1</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data Split für Modell Scikitlearn</span>
<span class="n">X_train1</span><span class="p">,</span> <span class="n">X_val1</span><span class="p">,</span> <span class="n">y_train1</span><span class="p">,</span> <span class="n">y_val1</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pipeline with model</span>
<span class="n">lin_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show pipeline</span>
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
<span class="c1"># Fit model</span>
<span class="n">lin_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train1</span><span class="p">,</span> <span class="n">y_train1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-f216df2b-8441-4009-bfac-45fc149c022b {color: black;background-color: white;}#sk-f216df2b-8441-4009-bfac-45fc149c022b pre{padding: 0;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-toggleable {background-color: white;}#sk-f216df2b-8441-4009-bfac-45fc149c022b label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-f216df2b-8441-4009-bfac-45fc149c022b input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-f216df2b-8441-4009-bfac-45fc149c022b input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-estimator:hover {background-color: #d4ebff;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-item {z-index: 1;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-parallel-item:only-child::after {width: 0;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-f216df2b-8441-4009-bfac-45fc149c022b div.sk-container {display: inline-block;position: relative;}</style><div id="sk-f216df2b-8441-4009-bfac-45fc149c022b" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="69b1f1e4-a749-4325-a73e-8d446420ef06" type="checkbox" ><label class="sk-toggleable__label" for="69b1f1e4-a749-4325-a73e-8d446420ef06">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])),
                ('lin', LinearRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ec76a1b9-d803-4c07-9d07-6de838bfec81" type="checkbox" ><label class="sk-toggleable__label" for="ec76a1b9-d803-4c07-9d07-6de838bfec81">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="e47d7881-f013-491a-8d2d-6744a4f0aaa5" type="checkbox" ><label class="sk-toggleable__label" for="e47d7881-f013-491a-8d2d-6744a4f0aaa5">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ba54500e-ec2c-4318-854a-4028f2a0167b" type="checkbox" ><label class="sk-toggleable__label" for="ba54500e-ec2c-4318-854a-4028f2a0167b">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5054ec28-03a8-4cbc-90b8-607946014fa2" type="checkbox" ><label class="sk-toggleable__label" for="5054ec28-03a8-4cbc-90b8-607946014fa2">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="5187cd71-9dcf-4ad2-b583-61a29749ec5c" type="checkbox" ><label class="sk-toggleable__label" for="5187cd71-9dcf-4ad2-b583-61a29749ec5c">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6103333c-160a-487b-a8fd-28e5c2ef7887" type="checkbox" ><label class="sk-toggleable__label" for="6103333c-160a-487b-a8fd-28e5c2ef7887">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0937c15c-7ad7-4467-adce-3d032930b657" type="checkbox" ><label class="sk-toggleable__label" for="0937c15c-7ad7-4467-adce-3d032930b657">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6dd46deb-685c-4ab2-8d00-6310b15913fd" type="checkbox" ><label class="sk-toggleable__label" for="6dd46deb-685c-4ab2-8d00-6310b15913fd">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtain model coefficients</span>
<span class="n">lin_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 83634.3235705 ,  16523.70721509, -16232.45330721,  12342.81207397,
       -33603.07831092,  33603.07831092])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_numerical</span> <span class="o">=</span> <span class="n">X1</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">list_numerical</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">lin_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;onehot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()))</span>
<span class="n">features_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;median_income&#39;, &#39;bedrooms_per_room&#39;, &#39;people_per_household&#39;,
       &#39;housing_median_age&#39;, &#39;x0_INLAND&#39;, &#39;x0_NEAR WATER&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<p>Mit Hilfe der Koeffizienten der ausgewählten Variablen können wir uns die Relevanz grafisch darstellen lassen. So können beim Optimieren des Models gezielt weniger wichtige Features weggelassen werden. So wie aktuell dargestellt haben alle Features zumindest eine gewisse Relevanz. Ein Durchlauf des Models ohne die schwächste Variable <em>housing_median_age</em> erzielt kein besseres Ergebnis (Siehe “Evaluation mit Trainingsdaten” unten). Zuvor wurde hier ebenfalls Ausprägungen von <em>ocean_proximity</em> als irrelevant dargestellt, was unter anderem Anlass war, im Feature Engineering die Ausprägungen zu <em>NEAR</em> <em>WATER</em> zusammengefasst wurden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get absolute values of coefficients</span>
<span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lin_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">features_names</span>
            <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_140_0.png" src="_images/regression_140_0.png" />
</div>
</div>
</section>
<section id="evaluation-mit-trainingsdaten">
<h4>Evaluation mit Trainingsdaten<a class="headerlink" href="#evaluation-mit-trainingsdaten" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred1train</span> <span class="o">=</span> <span class="n">lin_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred1train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([416076.67957139, 254530.64297383, 201335.73206234, ...,
       113675.58919158, 404117.08422568, 152155.08694092])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r2 in %:&#39;</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_train1</span><span class="p">,</span> <span class="n">y_pred1train</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE:&#39;</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train1</span><span class="p">,</span> <span class="n">y_pred1train</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE:&#39;</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train1</span><span class="p">,</span> <span class="n">y_pred1train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2 in %: 62.59503206786563
MSE: 5031965114.543374
RMSE: 70936.34551161608
</pre></div>
</div>
</div>
</div>
<p>Ein Ergebnis von r2 = 62,62% und einem RMSE von 70712 ist kein besonders gutes Ergebnis. Das Modell weicht im Schnitt 70712<span class="math notranslate nohighlight">\( vom eigentlichen *median_house_value* ab, welcher sich meistens zwischen 100.000 und 500.000\)</span> bewegt. Als Versuch wurde das schwächste Feature <em>housing_median_age</em> entfernt, das Ergebnis fiel dabei leicht schlechter aus:</p>
<p>Modell ohne <em>housing_median_age</em>:</p>
<ul class="simple">
<li><p>r2 in %: 61.742949278293366</p></li>
<li><p>MSE: 5117358064.557615</p></li>
<li><p>RMSE: 71535.71181275556</p></li>
</ul>
</section>
<section id="validierung-mit-testdaten">
<h4>Validierung mit Testdaten<a class="headerlink" href="#validierung-mit-testdaten" title="Permalink to this headline">¶</a></h4>
<p>Nun wird das Modell mit dem Validation dataset validiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred1val</span> <span class="o">=</span> <span class="n">lin_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;r2 in %:&#39;</span><span class="p">,</span> <span class="n">r2_score</span><span class="p">(</span><span class="n">y_val1</span><span class="p">,</span> <span class="n">y_pred1val</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE:&#39;</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val1</span><span class="p">,</span> <span class="n">y_pred1val</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE:&#39;</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val1</span><span class="p">,</span> <span class="n">y_pred1val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>r2 in %: 60.12220550458062
MSE: 5246250124.666709
RMSE: 72431.00251043547
</pre></div>
</div>
</div>
</div>
<p>Das Ergebnis der Validierung fällt noch schlechter aus.
Das Modell ist also nicht gut genug gefittet, also underfitted. Nun kann entweder das Modell angepasst werden (bspw. andere Varaiblen gewählt werden) oder ein anderes Modell getestet werden um auf ein besseres Ergebnis zu kommen. Da nach verschiedenen Tests kein bessere Kombination an Features gefunden werden konnte, werden zunächst andere Modelle getestet.</p>
</section>
</section>
<section id="model-1-2-linear-ols-regression-with-statsmodels">
<h3>Model 1.2 - Linear OLS Regression with Statsmodels<a class="headerlink" href="#model-1-2-linear-ols-regression-with-statsmodels" title="Permalink to this headline">¶</a></h3>
<section id="id1">
<h4>Modellierung<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>Für das Linear Regression Modell von statsmodels ist kein erneuter datasplit notwendig, das Modell kann mit dem train_dataset arbeiten, welches X und Y Variablen enthält. Auf die seperate Erstellung eines Validation Datasets wird hier verzichtet, das Modell wird lediglich mit den Traingsdaten und schließlich mit den Testdaten evaluiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + ocean_proximity + bedrooms_per_room + people_per_household + housing_median_age&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Short summary</span>
<span class="n">lm1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td>-6.134e+04</td> <td> 4227.647</td> <td>  -14.509</td> <td> 0.000</td> <td>-6.96e+04</td> <td>-5.31e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR WATER]</th> <td> 6.744e+04</td> <td> 1355.990</td> <td>   49.735</td> <td> 0.000</td> <td> 6.48e+04</td> <td> 7.01e+04</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 4.351e+04</td> <td>  405.883</td> <td>  107.208</td> <td> 0.000</td> <td> 4.27e+04</td> <td> 4.43e+04</td>
</tr>
<tr>
  <th>bedrooms_per_room</th>             <td> 2.849e+05</td> <td> 1.29e+04</td> <td>   22.057</td> <td> 0.000</td> <td>  2.6e+05</td> <td>  3.1e+05</td>
</tr>
<tr>
  <th>people_per_household</th>          <td>-1.174e+04</td> <td>  439.002</td> <td>  -26.751</td> <td> 0.000</td> <td>-1.26e+04</td> <td>-1.09e+04</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td>  973.1340</td> <td>   46.419</td> <td>   20.964</td> <td> 0.000</td> <td>  882.148</td> <td> 1064.120</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full summary</span>
<span class="n">lm1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.622</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.622</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   5372.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Wed, 19 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>12:59:26</td>      <th>  Log-Likelihood:    </th> <td>-2.0583e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 16346</td>       <th>  AIC:               </th>  <td>4.117e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 16340</td>       <th>  BIC:               </th>  <td>4.117e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     5</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td>-6.134e+04</td> <td> 4227.647</td> <td>  -14.509</td> <td> 0.000</td> <td>-6.96e+04</td> <td>-5.31e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR WATER]</th> <td> 6.744e+04</td> <td> 1355.990</td> <td>   49.735</td> <td> 0.000</td> <td> 6.48e+04</td> <td> 7.01e+04</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 4.351e+04</td> <td>  405.883</td> <td>  107.208</td> <td> 0.000</td> <td> 4.27e+04</td> <td> 4.43e+04</td>
</tr>
<tr>
  <th>bedrooms_per_room</th>             <td> 2.849e+05</td> <td> 1.29e+04</td> <td>   22.057</td> <td> 0.000</td> <td>  2.6e+05</td> <td>  3.1e+05</td>
</tr>
<tr>
  <th>people_per_household</th>          <td>-1.174e+04</td> <td>  439.002</td> <td>  -26.751</td> <td> 0.000</td> <td>-1.26e+04</td> <td>-1.09e+04</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td>  973.1340</td> <td>   46.419</td> <td>   20.964</td> <td> 0.000</td> <td>  882.148</td> <td> 1064.120</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>5352.896</td> <th>  Durbin-Watson:     </th> <td>   1.987</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>35565.746</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 1.410</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 9.653</td>  <th>  Cond. No.          </th> <td>    761.</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lm1</span><span class="o">.</span><span class="n">mse_resid</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE 71187.88381161772
</pre></div>
</div>
</div>
</div>
<p>Das Modell weißt schon einen ähnlichen r2 value auf wie das scikit learn Modell. Die gewählten Features scheinen sinnvoll gewählt zu sein, da keine einen P-Value von größer 0,05 besitzt. Damit können wir die Null Hypothese verwerfen und davon ausgehen, dass die Features Einfluss auf unsere Y Variable haben.</p>
<p>Mehrere Tests ergeben, dass das Löschen von Variablen (getestet wurde ohne <em>housing_median_age</em> und <em>people_per_household</em>) negativen Einfluss auf den Erfolg des Modells hat.</p>
<p>Bevor die Ergebnisse weiter interpretiert werden, soll zunächste ein Optimierung durch die Entfernung von Outliern stattfinden. Die Outlier werden durch die Methode “Cook’s Distance” identifiziert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualisierung der Outlier nach Cook&#39;s Distance</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">influence_plot</span><span class="p">(</span><span class="n">lm1</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;cooks&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_159_0.png" src="_images/regression_159_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Berechnen der Outlier nach Cook&#39;s Distance</span>
<span class="c1"># obtain Cook&#39;s distance </span>
<span class="n">lm1_cooksd</span> <span class="o">=</span> <span class="n">lm1</span><span class="o">.</span><span class="n">get_influence</span><span class="p">()</span><span class="o">.</span><span class="n">cooks_distance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># get length of df to obtain n</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">[</span><span class="s2">&quot;median_income&quot;</span><span class="p">])</span>

<span class="c1"># calculate critical d</span>
<span class="n">critical_d</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Critical Cooks distance:&#39;</span><span class="p">,</span> <span class="n">critical_d</span><span class="p">)</span>

<span class="c1"># identification of potential outliers with leverage</span>
<span class="n">out_d</span> <span class="o">=</span> <span class="n">lm1_cooksd</span> <span class="o">&gt;</span> <span class="n">critical_d</span>

<span class="c1"># output potential outliers with leverage</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> 
    <span class="n">lm1_cooksd</span><span class="p">[</span><span class="n">out_d</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Critical Cooks distance: 0.0002447081854888046
Int64Index([10574, 17237,  4643,  4592,  5288, 15700, 17108,  8857,  5464,
             5466,
            ...
            12341,  4065, 15641, 20091,  4245,  5282,   199,    59, 16835,
             8767],
           dtype=&#39;int64&#39;, length=819) 
 [2.28113130e-03 3.46736799e-04 7.94212143e-04 9.41437453e-04
 2.91710354e-04 7.17529070e-04 3.33664252e-03 2.70405840e-04
 7.29870656e-04 4.15292631e-04 3.32549018e-04 6.77643128e-04
 3.76883632e-04 1.02646758e-03 3.12792105e-04 1.79005733e-03
 6.28543151e-04 8.79664957e-04 1.53323253e-02 3.61463664e-03
 6.19814958e-04 5.89325545e-04 3.02288089e-04 3.30204643e-04
 1.98353122e-03 8.01140772e-04 2.86265393e-04 2.87592302e-04
 1.02454185e-03 2.51142736e-04 2.49464954e-04 3.83435086e-04
 3.73039136e-04 5.34194711e-04 5.41784732e-04 8.97536210e-04
 1.98810692e-03 9.40109212e-04 9.38722526e-04 1.91188605e-03
 3.39591233e-04 3.69032607e-04 2.67207283e-04 3.19858729e-03
 4.13736858e-04 3.31731633e-04 4.71042891e-03 3.08637706e-04
 2.93664050e-04 4.87229841e-04 2.76955937e-03 4.55443455e-04
 5.12998345e-04 4.62162688e-04 4.17454545e-04 4.29059713e-04
 8.33917274e-04 8.06678894e-04 3.63678748e-04 6.78547957e-04
 4.58891341e-04 8.56477711e-04 4.82922619e-04 5.69578291e-04
 4.90513260e-04 4.12274499e-04 3.33090356e-04 4.06686550e-04
 2.67131969e-04 3.93822411e-03 9.43799783e-04 7.35692062e-04
 1.26296945e-03 2.69415308e-04 3.23482354e-04 2.78282335e-04
 2.53635033e-04 3.08716476e-04 4.47677023e-04 3.13815346e-04
 7.35545422e-04 6.23804691e-04 3.97664798e-03 4.38840697e-04
 4.41531439e-04 6.39512403e-04 3.76809409e-04 3.64073524e-04
 3.61370633e-04 3.15765390e-03 3.95662133e-03 3.41488406e-04
 4.48128358e-04 3.19001427e-02 2.94509977e-04 7.16999261e-04
 2.75893916e-04 2.42599479e-03 2.87562791e-04 2.65569029e-04
 1.99933172e-03 4.31656809e-04 3.67683010e-03 1.31997319e-02
 6.96573102e-04 2.10605289e-03 7.22291028e-04 4.65665619e-03
 2.96810673e-04 3.27155461e-03 3.23828842e-04 7.69105512e-04
 2.48716130e-04 2.52170912e-04 3.59721617e-04 3.51366131e-04
 3.16985926e-04 5.94889249e-04 2.47283672e-04 6.00437958e-04
 3.07622740e-04 3.06110422e-04 2.52961041e-04 2.78640489e-04
 3.06169698e-03 3.23542621e-04 6.58564345e-04 3.67669022e-04
 1.32747159e-03 3.67556615e-04 2.44961259e-04 6.38662073e-04
 7.43258904e-04 4.81879005e-04 3.58595614e-04 3.51188982e-04
 6.14191949e-03 3.60152935e-04 7.89595770e-04 5.16146795e-04
 2.82962425e-04 5.54970471e-03 3.49220352e-04 3.42357092e-03
 5.87724686e-04 2.50003100e-04 4.71933891e-04 3.02362196e-03
 3.20736250e-04 1.38013581e-03 8.14010152e-04 3.21214632e-03
 3.05707830e-04 2.07651759e-03 3.49079857e-04 3.72064764e-04
 5.87108470e-04 5.01779383e-04 1.07814761e-03 6.05984241e-04
 4.06916516e-04 5.47158615e-04 2.97621730e-04 1.60088217e-03
 1.13285122e-03 5.70717245e-04 6.61060572e-04 2.56173138e-04
 2.60860010e-04 4.52520998e-04 3.04875728e-04 4.17599139e-04
 3.25152532e-04 3.76866648e-04 3.09497900e-04 3.37430132e-04
 3.57891645e-04 8.88411411e-04 4.34741323e-04 3.00147732e-04
 8.65854731e-04 6.66434009e-04 4.39562041e-04 8.34637172e-04
 9.02683231e-04 2.46630848e-03 2.87389334e-04 6.42873268e-04
 5.19513212e-04 4.92550538e-04 5.71916183e-04 4.54626760e-04
 6.00514942e-04 2.57090008e-04 2.95991649e-04 3.30490897e-04
 4.23464058e-04 3.87899297e-04 1.68035937e-03 3.34212595e-04
 3.38399493e-04 2.80117466e-03 3.16190052e-04 2.96707431e-04
 3.79045588e-04 3.90241342e-04 1.30805709e-03 2.60037423e-04
 3.46117971e-03 2.63309541e-04 6.92277691e-04 3.44903879e-04
 7.30469006e-04 3.62874149e-03 5.50231979e-04 2.99827075e-04
 9.53479861e-04 4.93729436e-04 4.20689539e-04 7.87852346e-04
 2.83248618e-04 2.73547601e-04 3.39181429e-04 1.25447292e-03
 1.59776190e-02 3.24061651e-04 1.10008810e-03 2.63085812e-04
 2.54007719e-04 4.70644831e-04 4.79617156e-03 2.83511312e-03
 1.00058295e-03 4.17791659e-04 4.38828622e-04 1.68696059e-03
 3.42557377e-03 3.75541871e-04 5.36640600e-04 5.52578935e-04
 2.53979156e-04 5.33958776e-04 6.15101622e-04 5.65372856e-04
 2.80835687e-04 3.92582486e-04 2.81566194e-04 9.55020605e-04
 4.03797105e-02 2.45609597e-04 3.07026043e-04 7.38331571e-04
 9.18312190e-04 2.89129652e-04 2.51518147e-04 3.25233985e-04
 2.49498057e-04 3.05977353e-04 3.31876304e-04 9.05355630e-01
 3.33164184e-04 1.58049457e-03 2.48860353e-04 6.73946263e-04
 4.53795559e-03 2.56216338e-04 2.51205785e-04 3.67963240e-04
 2.70121717e-04 6.79290851e-04 4.54860328e-03 3.05047822e-04
 2.54883289e-04 3.81256933e-04 1.30418063e-03 2.65002247e-04
 4.22730420e-04 2.55777215e-04 6.27633284e-04 2.84121589e-04
 5.99344401e-03 5.58727120e-03 3.71227478e-04 4.10266359e-04
 3.46714066e-04 4.58791744e-04 3.78534177e-03 3.93341271e-04
 3.44972051e-04 2.53306364e-04 5.35002760e-04 4.89205096e-04
 2.64980771e-04 2.91182948e-04 2.59350969e-04 1.21254337e-03
 3.84834015e-04 3.38575500e-04 3.79463795e-04 3.01808977e-04
 2.50694296e-04 2.81995121e-04 3.22325310e-04 4.74096381e-04
 4.36200696e-04 5.00915801e-04 1.73958334e-02 1.50201948e-03
 3.66210354e-04 3.88985527e-04 4.31745270e-04 5.60072495e-04
 6.37009582e-04 5.00424806e-03 2.65764160e-04 6.99740914e-03
 2.80475491e-04 4.55258716e-04 2.84823339e-04 9.21185473e-04
 2.70260481e-04 5.24991930e-04 1.41830161e-03 1.18753416e-03
 7.21518951e-04 5.00986768e-04 3.11681481e-04 8.38085745e-04
 1.99297758e-03 2.12101851e-03 4.91986955e-04 1.51408539e-03
 2.60428679e-04 3.10534028e-04 4.06872476e-04 3.47860431e-04
 3.02456642e-04 3.07520251e-04 8.21608308e-04 3.41277698e-04
 5.59164102e-04 4.28587274e-04 2.87862555e-04 3.93383924e-03
 4.20221694e-04 3.35618833e-04 5.12937232e-04 3.23211188e-04
 2.66531022e-04 3.94467484e-03 3.92414923e-04 2.88958460e-04
 6.42349067e-04 9.39582129e-04 1.35685725e-03 6.88015170e-04
 4.97775603e-02 4.14049404e-04 3.43665767e-03 4.17226926e-03
 3.58572442e-04 3.64403610e-04 3.56797407e-04 4.37013854e-03
 9.19975206e-03 4.13310594e-04 4.67595928e-04 2.98698033e-04
 2.19974254e-03 4.65185842e-04 3.59550826e-04 2.47739392e-03
 2.71851306e-04 9.23541887e-04 1.05500884e-03 1.38003643e-02
 7.98464029e-04 6.99570052e-04 8.50572612e-03 2.55480861e-04
 4.19932439e-04 1.46913533e-03 2.62697639e-04 4.67921697e-04
 5.61742744e-04 7.10731667e-04 3.12079242e-04 2.78917852e-04
 4.78209484e-04 2.61822435e-04 6.15255208e-04 1.16974197e-03
 1.50190945e-03 3.77772424e-04 2.55457750e-04 8.64854894e-04
 2.83408343e-04 2.91217936e-04 6.20101765e-03 2.73612626e-04
 4.18231036e-04 3.63495757e-04 3.76849077e-03 7.24575441e-04
 4.64564123e-04 3.62294533e-04 5.02313420e-04 3.31925234e-04
 5.58411649e-04 3.62529940e-03 2.90886527e-04 1.33844445e-03
 6.25132200e-04 8.19410686e-04 5.64799536e-04 1.05462840e-03
 4.69337217e-04 4.69218350e-04 4.17022254e-04 6.27363226e-04
 6.80981244e-04 3.33946819e-04 3.94782399e-04 5.08532798e-04
 8.83124837e-04 2.51542095e-04 5.01744011e-04 3.57251074e-04
 2.59727974e-04 5.36854392e-04 5.00209975e-04 3.59843528e-04
 7.06288893e-04 2.93284480e-04 8.66168898e-04 7.66625067e-04
 1.27632470e-03 4.17123807e-04 5.22185992e-04 5.02218630e-04
 3.35971086e-04 4.60145811e-04 3.15390342e-04 3.87017023e-04
 3.54064296e-04 6.32733180e-04 9.57076286e-04 3.26785738e-04
 3.61233763e-04 1.42936901e-03 5.51573066e-04 6.86956788e-04
 2.72202670e-04 8.99809153e-04 3.23302902e-04 3.48088981e-04
 3.62478418e-03 2.59211994e-04 4.02765215e-04 8.14799711e-04
 2.48605537e-03 3.21706465e-04 7.68444659e-04 4.18778871e-04
 2.58940069e-04 3.23479113e-04 2.53730819e-04 4.02271211e-04
 7.03785255e-04 2.46783543e-04 2.92852412e-04 3.86952959e-04
 3.28918286e-04 5.62936942e-04 4.61561908e+00 2.24880306e-03
 2.66614631e-04 3.93294310e-04 7.61000743e-04 3.90142948e-04
 3.18885356e-04 4.23417420e-03 3.38826526e-04 7.89793896e-04
 2.92061554e-04 6.99955497e-04 2.76346024e-04 3.98465042e-04
 3.86075357e-04 3.85823301e-04 2.95301250e-04 3.71670520e-04
 3.14996256e-04 2.54108671e-04 3.02165292e-04 7.04543663e-04
 5.24550623e-04 4.42906948e-04 3.18308847e-04 4.01133996e-04
 6.64940019e-04 1.33590164e-03 1.79884139e-03 4.46573737e-03
 3.08276766e-04 2.72453921e-04 2.26047056e-03 7.72194629e-03
 6.65921353e-04 2.67736469e-04 8.95508251e-04 4.41131986e-04
 2.14590265e-03 5.20498041e-04 4.08752345e-04 3.75829944e-04
 3.40520408e-04 4.97301449e-04 2.91272779e-03 3.73173165e-04
 2.93053927e-03 3.55420992e-04 8.44629804e-03 4.95143163e-04
 1.44427898e-03 2.92817428e-04 3.06748428e-04 3.40778736e-04
 1.11346708e-03 9.12683557e-04 2.67079143e-04 6.03750058e-04
 1.56740727e-03 2.70103408e-04 3.69231621e-04 8.40943107e-04
 4.66976178e-04 3.30395310e-04 6.32096794e-04 3.12594006e-04
 2.53024095e-03 9.77816835e-04 1.60152418e-03 2.54242977e-04
 3.87077795e-03 1.14626940e-03 4.43297819e-04 4.44475302e-04
 7.12608994e-04 3.31105699e-04 1.14512387e-03 1.62281791e-03
 3.87543376e-04 8.74064562e-04 6.17355149e-04 6.59564022e-04
 3.80734008e-04 3.19551976e-04 4.51435307e-04 5.66668609e-04
 1.01081359e-03 6.06925873e-04 2.58509422e-04 7.75518957e-04
 3.25389593e-04 2.67144936e-04 3.31616221e-04 2.04541403e-03
 3.34381174e-04 6.03957734e-04 1.11167736e-03 5.39444258e-04
 3.77488782e-03 8.78531959e-04 4.84931561e-04 1.83685651e-03
 3.18075514e-04 2.47172546e-04 7.65470612e-04 8.63002744e-04
 3.78541699e-03 5.99364865e-04 2.44928891e-04 3.00823858e-04
 6.73002778e-04 4.55085191e-04 2.99411224e-04 1.64227734e-03
 1.02165368e-03 3.02177089e-04 8.17893697e-03 3.30282057e-04
 8.60186867e-04 5.59962780e-04 2.68764640e-04 6.34527870e-03
 2.62642091e-04 3.36954503e-04 2.57659253e-04 3.51639934e-04
 3.52534381e-04 2.52804561e-04 4.13640682e-03 4.42584277e-03
 3.19107855e-03 4.35052262e-03 4.34320403e-04 4.25337364e-04
 4.04236064e-04 8.69590368e-04 2.90486129e-04 2.92536567e-04
 2.06200812e-03 4.18355453e-04 4.40961653e-04 3.74404233e-04
 2.50602519e-04 3.29301060e-04 3.09201863e-04 1.22344451e-03
 3.68654010e-04 4.62299503e-04 2.91271517e-04 2.64704922e-03
 3.83598707e-04 2.63026436e-04 7.78182068e-04 3.05425847e-04
 4.55479349e-04 5.74021073e-04 4.28329217e-04 4.38757567e-04
 2.18959153e-03 7.10728563e-04 2.83116553e-04 2.49564777e-03
 3.82058324e-04 3.60088355e-04 2.95215936e-04 2.57248154e-04
 5.64136082e-04 5.52455154e-04 4.14443482e-04 4.36072918e-04
 7.84239973e-04 3.95264959e-04 2.45433133e-04 4.63076560e-04
 4.27399991e-04 2.76172129e-04 2.91329472e-04 3.92221323e-04
 4.10397845e-04 2.82055111e-04 8.36680882e-04 1.17449317e-03
 6.75379756e-04 5.09819672e-04 2.53113843e-04 2.84083617e-04
 3.44110353e-04 4.44311042e-03 5.87815750e-04 4.41400945e-03
 3.35166268e-04 5.07799052e-04 2.53515903e-04 1.27452422e-03
 3.55839483e-03 1.32646475e-03 3.61935736e-04 5.05195810e-04
 2.79176462e-04 4.06763214e-04 2.68139446e-04 4.77331725e-04
 3.44978834e-04 5.14964260e-04 9.59205291e-04 5.44117507e-04
 6.07315232e-04 1.27824754e+01 2.65486288e-04 4.08089699e-04
 2.62303506e-04 2.41978094e-03 2.97791465e-04 3.35612648e-04
 4.75084588e-01 3.73689057e-04 3.36009152e-04 4.05387786e-04
 3.24860172e-04 9.39808789e-04 7.07054019e-04 3.62439247e-04
 2.54164122e-02 4.38474810e-04 3.61113614e-04 5.34997048e-04
 2.60484908e-04 3.04322941e-04 2.89373761e-04 2.88026758e-04
 3.61161745e-04 7.16378230e-04 7.78315377e-04 2.49093047e-04
 7.53560517e-04 3.33891170e-04 3.57229464e-03 2.46005328e-04
 2.97326378e-04 3.32411321e-04 2.92633722e-04 3.39611161e-03
 1.33085983e-03 4.15417048e-04 1.35261032e-03 4.83465598e-03
 3.25326464e-04 3.06686011e-04 7.02590186e-04 3.60312154e-04
 3.72464976e-04 2.75826614e-04 2.53982718e-04 3.66294218e-04
 5.85806137e-04 3.77419609e-04 1.27562844e-03 1.37451710e-03
 3.19590849e-04 2.01554096e-03 3.88066579e-04 2.56546365e-04
 7.24018019e-04 3.43907086e-04 1.19201260e-03 6.31321128e-04
 2.62838952e-04 4.11651514e-04 3.12567912e-04 7.09391040e-04
 4.40918769e-04 9.31741088e-04 3.21981776e-04 9.40713619e-04
 5.30779376e-04 3.67148222e-04 2.60765688e-04 5.54163071e-04
 3.03971578e-04 4.51329198e-04 6.68795189e-04 5.13840435e-04
 5.35940337e-04 5.24277404e-04 2.68172173e-03 2.10171040e-03
 4.29275773e-03 2.61239655e-04 5.32085551e-04 9.79548390e-04
 7.23270658e-04 6.57586613e-04 2.79247055e-04 4.40909156e-03
 2.97443343e-04 4.00172479e-04 3.77434015e-04 3.43141288e-04
 3.58155842e-04 2.78361546e-04 4.22879599e-04 2.54652245e-04
 3.93070697e-04 2.57497733e-04 4.21643617e-04 3.29474692e-04
 5.34577200e-04 3.74455538e-03 7.83542024e-04 5.04988713e-04
 3.44108478e-04 4.99970544e-04 1.24517507e-03 4.75954199e-04
 4.59089504e-04 2.51882299e-04 1.18494882e-03 3.94884335e-03
 5.24203839e-04 4.95134955e-04 6.18768775e-04 2.93084423e-03
 1.90402372e-03 4.15794254e-04 2.56298576e-04 6.14736089e-04
 5.16464021e-04 8.07622706e-04 5.98824408e-04 3.21399734e-04
 4.51217810e-02 4.04796429e-04 2.73366144e-04 3.02027286e-04
 2.96538941e-04 8.57327216e-04 4.95980875e-04 1.03338715e-03
 4.26227170e-04 6.92722344e-04 4.03705334e-04 3.10364540e-04
 2.81500263e-04 9.10110544e-04 5.51228682e-04]
</pre></div>
</div>
</div>
</div>
<p>Um das Trainingsdatenset noch für weitere Modelle verwenden zu können ohne es neu erzeugen zu müssen, wird an dieser Stelle ein neues Datenset erstellt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># droppen der Outlier Observations</span>
<span class="n">train_dataset2</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Nun wird der Algorithmus erneut durchgeführt, auf Basis des bereinigten datasets.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + ocean_proximity + bedrooms_per_room + people_per_household + housing_median_age&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.742</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.742</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   8934.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Wed, 19 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>13:00:22</td>      <th>  Log-Likelihood:    </th> <td>-1.9102e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 15527</td>       <th>  AIC:               </th>  <td>3.821e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 15521</td>       <th>  BIC:               </th>  <td>3.821e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     5</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td>-5.056e+04</td> <td> 4114.530</td> <td>  -12.288</td> <td> 0.000</td> <td>-5.86e+04</td> <td>-4.25e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR WATER]</th> <td> 5.872e+04</td> <td> 1071.584</td> <td>   54.795</td> <td> 0.000</td> <td> 5.66e+04</td> <td> 6.08e+04</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 4.821e+04</td> <td>  372.767</td> <td>  129.335</td> <td> 0.000</td> <td> 4.75e+04</td> <td> 4.89e+04</td>
</tr>
<tr>
  <th>bedrooms_per_room</th>             <td> 3.572e+05</td> <td> 1.21e+04</td> <td>   29.524</td> <td> 0.000</td> <td> 3.33e+05</td> <td> 3.81e+05</td>
</tr>
<tr>
  <th>people_per_household</th>          <td>-2.626e+04</td> <td>  567.689</td> <td>  -46.264</td> <td> 0.000</td> <td>-2.74e+04</td> <td>-2.52e+04</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td>  907.5866</td> <td>   36.666</td> <td>   24.753</td> <td> 0.000</td> <td>  835.716</td> <td>  979.457</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>1138.759</td> <th>  Durbin-Watson:     </th> <td>   1.979</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>1550.133</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.636</td>  <th>  Prob(JB):          </th> <td>    0.00</td>
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 3.881</td>  <th>  Cond. No.          </th> <td>    920.</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lm2</span><span class="o">.</span><span class="n">mse_resid</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE 53300.59730084918
</pre></div>
</div>
</div>
</div>
<p>Folgende Erkenntnisse lassen sich hier gewinnen:</p>
<ul class="simple">
<li><p>Der r2 hat sich um 12% verbessert. 74,2% Abweichung kann durch das Modell erklärt werden.</p></li>
<li><p>F-Statistic gibt uns einen Überblick über das Modell im Vehältnis zum Fehler im Modell ( Verhältnis von “wie sehr hat das Modell die Vorhersage des Ergebnisses verbessert vs. Abweichungen/Fehler des Modells). Wenn die Vebesserung überwiegt, entsteht ein großer F Wert, was hier der Fall ist.</p></li>
<li><p>AIC und BIC haben sich auch verbessert nach der Entferung der Outlier.</p></li>
<li><p>Die Normalverteilung der residuals kann über Omnibus und Jarque-Bera analysiert werden, ist in diesem Fall mit einem Datensatz mit weit mehr als 50 Observations allerdings zu vernachlässigen.</p></li>
<li><p>Aus einem Durbin-Watson Wert nahe 2 kann man erkennen, dass keine autocorrelation vorliegt.</p></li>
<li><p>der RMSE hat sich auch verbessert und ist um einiges besser als der RMSE im scikit learn Modell</p></li>
</ul>
</section>
</section>
<section id="regression-diagnostics">
<h3>Regression Diagnostics<a class="headerlink" href="#regression-diagnostics" title="Permalink to this headline">¶</a></h3>
<p>In diesem Abschnitt soll nun noch einmal verstärkt die Auswirkung der einzelnen Features auf unser Modell sowie mögliche Outlier untersucht werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_partregress_grid</span><span class="p">(</span><span class="n">lm2</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_170_0.png" src="_images/regression_170_0.png" />
</div>
</div>
<p>Auf dem Partial Regression Plot können wir jeweils einen mehr oder weniger linearen Zusammenhang der Features auf die Y Variable erkennen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">},</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_172_0.png" src="_images/regression_172_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">},</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_173_0.png" src="_images/regression_173_0.png" />
</div>
</div>
<p>Da bereits im Feature Engineering sowie durch Cook’s Distance starke Outlier entfernt wurden, sind hier keine Outlier mehr mit bspw. besonders starkem Hebel zu erkennen.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>people_per_household</th>
      <th>bedrooms_per_household</th>
      <th>rooms_per_household</th>
      <th>bedrooms_per_room</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14740</th>
      <td>-117.05</td>
      <td>32.58</td>
      <td>22.0</td>
      <td>2101</td>
      <td>399</td>
      <td>1551</td>
      <td>371</td>
      <td>4.1518</td>
      <td>136900.0</td>
      <td>NEAR WATER</td>
      <td>4.180593</td>
      <td>1.075472</td>
      <td>5.663073</td>
      <td>0.189910</td>
    </tr>
    <tr>
      <th>10101</th>
      <td>-117.97</td>
      <td>33.92</td>
      <td>32.0</td>
      <td>2620</td>
      <td>398</td>
      <td>1296</td>
      <td>429</td>
      <td>5.7796</td>
      <td>241300.0</td>
      <td>NEAR WATER</td>
      <td>3.020979</td>
      <td>0.927739</td>
      <td>6.107226</td>
      <td>0.151908</td>
    </tr>
    <tr>
      <th>20566</th>
      <td>-121.84</td>
      <td>38.65</td>
      <td>29.0</td>
      <td>3167</td>
      <td>548</td>
      <td>1554</td>
      <td>534</td>
      <td>4.3487</td>
      <td>200700.0</td>
      <td>INLAND</td>
      <td>2.910112</td>
      <td>1.026217</td>
      <td>5.930712</td>
      <td>0.173034</td>
    </tr>
    <tr>
      <th>2670</th>
      <td>-115.60</td>
      <td>33.20</td>
      <td>37.0</td>
      <td>709</td>
      <td>187</td>
      <td>390</td>
      <td>142</td>
      <td>2.4511</td>
      <td>72500.0</td>
      <td>INLAND</td>
      <td>2.746479</td>
      <td>1.316901</td>
      <td>4.992958</td>
      <td>0.263752</td>
    </tr>
    <tr>
      <th>15709</th>
      <td>-122.43</td>
      <td>37.79</td>
      <td>25.0</td>
      <td>1637</td>
      <td>394</td>
      <td>649</td>
      <td>379</td>
      <td>5.0049</td>
      <td>460000.0</td>
      <td>NEAR WATER</td>
      <td>1.712401</td>
      <td>1.039578</td>
      <td>4.319261</td>
      <td>0.240684</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4083</th>
      <td>-118.38</td>
      <td>34.15</td>
      <td>36.0</td>
      <td>2933</td>
      <td>619</td>
      <td>1115</td>
      <td>579</td>
      <td>4.3036</td>
      <td>365900.0</td>
      <td>NEAR WATER</td>
      <td>1.925734</td>
      <td>1.069085</td>
      <td>5.065630</td>
      <td>0.211047</td>
    </tr>
    <tr>
      <th>7616</th>
      <td>-118.22</td>
      <td>33.86</td>
      <td>16.0</td>
      <td>8732</td>
      <td>1489</td>
      <td>3944</td>
      <td>1493</td>
      <td>5.1948</td>
      <td>203500.0</td>
      <td>NEAR WATER</td>
      <td>2.641661</td>
      <td>0.997321</td>
      <td>5.848627</td>
      <td>0.170522</td>
    </tr>
    <tr>
      <th>16388</th>
      <td>-121.30</td>
      <td>38.05</td>
      <td>52.0</td>
      <td>122</td>
      <td>26</td>
      <td>62</td>
      <td>25</td>
      <td>1.1500</td>
      <td>112500.0</td>
      <td>INLAND</td>
      <td>2.480000</td>
      <td>1.040000</td>
      <td>4.880000</td>
      <td>0.213115</td>
    </tr>
    <tr>
      <th>19949</th>
      <td>-119.37</td>
      <td>36.21</td>
      <td>35.0</td>
      <td>2228</td>
      <td>476</td>
      <td>1567</td>
      <td>449</td>
      <td>1.4455</td>
      <td>54100.0</td>
      <td>INLAND</td>
      <td>3.489978</td>
      <td>1.060134</td>
      <td>4.962138</td>
      <td>0.213645</td>
    </tr>
    <tr>
      <th>10078</th>
      <td>-120.27</td>
      <td>39.35</td>
      <td>11.0</td>
      <td>2520</td>
      <td>401</td>
      <td>397</td>
      <td>165</td>
      <td>4.6650</td>
      <td>145600.0</td>
      <td>INLAND</td>
      <td>2.406061</td>
      <td>2.430303</td>
      <td>15.272727</td>
      <td>0.159127</td>
    </tr>
  </tbody>
</table>
<p>15527 rows × 14 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred2</span> <span class="o">=</span> <span class="n">lm2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_dataset2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">residplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_pred2</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_177_0.png" src="_images/regression_177_0.png" />
</div>
</div>
<p>Im residplot sollten im Optimalfall die residuals einigermaßen gleichmäßig zufällig um die horizontale Nulllinie verteilt sein.
Da dies nicht ganz der Fall ist, könnte es auf heteroscedasticity hindeuten. Das bedeutet, dass die Error im Modell nicht gleichmäßig verteilt sind.</p>
<p>Um das zu überprüfen, wird der Breusch-Pagan Lagrange Multiplier Test angewendet. Die Null Hypothese hierbei ist homoscedasticity.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Lagrange multiplier statistic&#39;</span><span class="p">,</span> <span class="s1">&#39;p-value&#39;</span><span class="p">,</span> <span class="s1">&#39;f-value&#39;</span><span class="p">,</span> <span class="s1">&#39;f p-value&#39;</span><span class="p">]</span>
<span class="n">test</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">stats</span><span class="o">.</span><span class="n">het_breuschpagan</span><span class="p">(</span><span class="n">lm2</span><span class="o">.</span><span class="n">resid</span><span class="p">,</span> <span class="n">lm2</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">exog</span><span class="p">)</span>
<span class="n">lzip</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">test</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[(&#39;Lagrange multiplier statistic&#39;, 933.4828238955702),
 (&#39;p-value&#39;, 1.5071399882460282e-199),
 (&#39;f-value&#39;, 198.56196055885547),
 (&#39;f p-value&#39;, 8.121999469744528e-206)]
</pre></div>
</div>
</div>
</div>
<p>Da alle P-Values über 0,05 liegen können wir die Null-Hypothese akzeptieren, was auf homoscedasticity hindeutet.</p>
<p>Im Detail lassen sich auch noch einzelne Variablen untersuchen, was hier lediglich an der einflussreichsten Variablen <em>median_income</em> durchgeführt werden soll. Die folgende Funktion liefert mehrere Plots für eine Variable:</p>
<ul class="simple">
<li><p>Y and Fitted vs. X: Die auf Basis von <em>median_income</em> gefitteten Werte bewegen sich in einem ähnlichen Bereich wie unsere Y Variable</p></li>
<li><p>Partial Regression &amp; CCPR Plot deuten auf ein lineares Verhältnis von <em>median_income</em> auf Y hin</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regression diagnostics für Variable &quot;median_income&quot;</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_regress_exog</span><span class="p">(</span><span class="n">lm2</span><span class="p">,</span> <span class="s2">&quot;median_income&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_182_0.png" src="_images/regression_182_0.png" />
</div>
</div>
</section>
</section>
<section id="lasso-regression-mit-scikit-learn">
<h2>2. Lasso Regression mit scikit learn<a class="headerlink" href="#lasso-regression-mit-scikit-learn" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<p>Für das Lasso Modell muss wieder nach scikit learn Logik ein datasplit durchgeführt werden.</p>
<section id="lasso-split-data">
<h3>Lasso - Split Data<a class="headerlink" href="#lasso-split-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der X und Y Variablen</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">train_dataset2</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">train_dataset2</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data split</span>
<span class="n">X_train2</span><span class="p">,</span> <span class="n">X_val2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">,</span> <span class="n">y_val2</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso-model">
<h3>Lasso - Model<a class="headerlink" href="#lasso-model" title="Permalink to this headline">¶</a></h3>
<p>Bei der ersten Durchführung des Modells setzen wir den Alpha Wert standardmäßig auf 1. Dieser wird später noch optimiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der Pipeline mit Lasso Modell</span>
<span class="n">lasso_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitten von Pipeline/Modell</span>
<span class="n">lasso_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-2f13929c-eecc-4084-8e51-09929a837be3 {color: black;background-color: white;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 pre{padding: 0;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-toggleable {background-color: white;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-item {z-index: 1;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-parallel-item:only-child::after {width: 0;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-2f13929c-eecc-4084-8e51-09929a837be3 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-2f13929c-eecc-4084-8e51-09929a837be3" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ba9d4eaa-6f49-48ea-8b27-15629defb299" type="checkbox" ><label class="sk-toggleable__label" for="ba9d4eaa-6f49-48ea-8b27-15629defb299">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])),
                ('lasso', Lasso(alpha=1))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a997f487-c0ae-41e4-8814-b8802cfbaca8" type="checkbox" ><label class="sk-toggleable__label" for="a997f487-c0ae-41e4-8814-b8802cfbaca8">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ff7be644-5542-453a-aba8-e55ce7bdd078" type="checkbox" ><label class="sk-toggleable__label" for="ff7be644-5542-453a-aba8-e55ce7bdd078">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fdf0e51d-1000-4db6-8b70-8197101343ae" type="checkbox" ><label class="sk-toggleable__label" for="fdf0e51d-1000-4db6-8b70-8197101343ae">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ef241b6e-d8b8-4694-bc5b-3b992d928ff9" type="checkbox" ><label class="sk-toggleable__label" for="ef241b6e-d8b8-4694-bc5b-3b992d928ff9">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8d00ddd0-73ac-4d22-a02d-e9b0f1ed162f" type="checkbox" ><label class="sk-toggleable__label" for="8d00ddd0-73ac-4d22-a02d-e9b0f1ed162f">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="8cc60b3e-0643-4144-9706-3a738d5dcbc8" type="checkbox" ><label class="sk-toggleable__label" for="8cc60b3e-0643-4144-9706-3a738d5dcbc8">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="14467aa3-0be3-48bd-a742-46c99ad360e6" type="checkbox" ><label class="sk-toggleable__label" for="14467aa3-0be3-48bd-a742-46c99ad360e6">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="25588e76-6f06-4670-8edf-0ed472a4ee45" type="checkbox" ><label class="sk-toggleable__label" for="25588e76-6f06-4670-8edf-0ed472a4ee45">Lasso</label><div class="sk-toggleable__content"><pre>Lasso(alpha=1)</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>Um die Importance der einzelnen Features im Lasso Algorithmus zu visualisieren, wird an dieser Stelle eine Liste mit allen Feature Namen erstellt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen einer Liste der numerical features</span>
<span class="n">list_numerical</span> <span class="o">=</span> <span class="n">X2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
<span class="n">list_numerical</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;median_income&#39;, &#39;people_per_household&#39;, &#39;bedrooms_per_room&#39;,
       &#39;housing_median_age&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen einer Liste aller Feature Namen</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">list_numerical</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;onehot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()))</span>
<span class="n">feature_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;median_income&#39;, &#39;people_per_household&#39;, &#39;bedrooms_per_room&#39;,
       &#39;housing_median_age&#39;, &#39;x0_INLAND&#39;, &#39;x0_NEAR WATER&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get absolute values of coefficients</span>
<span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lasso&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">feature_names</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_195_0.png" src="_images/regression_195_0.png" />
</div>
</div>
</section>
<section id="lasso-model-evaluation">
<h3>Lasso - Model Evaluation<a class="headerlink" href="#lasso-model-evaluation" title="Permalink to this headline">¶</a></h3>
<p>Bevor es an die Optimierung geht, soll zuerst das Modell noch mit dem Wert alpha = 1 evaluiert werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_train</span> <span class="o">=</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train2</span><span class="p">)</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_val2</span><span class="p">,</span> <span class="n">y_val2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE train set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train2</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val2</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set 73.9
R squared validation set 74.89
RMSE train set 53097.18
RMSE validation set 53753.5
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Training data</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train2</span><span class="p">)</span>
<span class="n">mse_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train2</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mse_train</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Validation data</span>
<span class="n">pred_test</span> <span class="o">=</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val2</span><span class="p">)</span>
<span class="n">mse_test</span> <span class="o">=</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val2</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mse_test</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE training set 2819310917.08
MSE validation set 2889438999.32
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso-k-fold-cross-validation">
<h3>Lasso - k-fold cross validation<a class="headerlink" href="#lasso-k-fold-cross-validation" title="Permalink to this headline">¶</a></h3>
<p>Nun soll mit Hilfe der k-fold Cross Validation Methode der optimale Wert für alpha ermittelt werden, um unser Modell weiter zu optimieren.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen von Modell mit Pipeline</span>
<span class="n">lassoCV_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lassoCV&#39;</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit model</span>
<span class="n">lassoCV_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 {color: black;background-color: white;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 pre{padding: 0;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-toggleable {background-color: white;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-estimator:hover {background-color: #d4ebff;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-item {z-index: 1;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-parallel-item:only-child::after {width: 0;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-e90a3b2b-5d6b-426c-88ca-188a6cf6b004" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3a44113d-0417-47db-9b85-59c6c1362945" type="checkbox" ><label class="sk-toggleable__label" for="3a44113d-0417-47db-9b85-59c6c1362945">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])),
                ('lassoCV', LassoCV(cv=5, max_iter=10000, random_state=0))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="92250a54-48a7-4441-b62d-ed1ca1cabb7a" type="checkbox" ><label class="sk-toggleable__label" for="92250a54-48a7-4441-b62d-ed1ca1cabb7a">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d6e96557-7f11-44cd-89de-8edb8fbca652" type="checkbox" ><label class="sk-toggleable__label" for="d6e96557-7f11-44cd-89de-8edb8fbca652">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="0a8e9a51-5345-419a-98f3-41712d5e7c43" type="checkbox" ><label class="sk-toggleable__label" for="0a8e9a51-5345-419a-98f3-41712d5e7c43">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="fe93e927-380d-401d-a74c-88bb7f4b1f1b" type="checkbox" ><label class="sk-toggleable__label" for="fe93e927-380d-401d-a74c-88bb7f4b1f1b">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="319c7593-56cf-4395-8da4-721b03c4e607" type="checkbox" ><label class="sk-toggleable__label" for="319c7593-56cf-4395-8da4-721b03c4e607">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2e678764-ef0f-40a3-b54a-ed8ff9135daf" type="checkbox" ><label class="sk-toggleable__label" for="2e678764-ef0f-40a3-b54a-ed8ff9135daf">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ab3ea0f9-250b-45b4-9b1e-dc1bb78fddc7" type="checkbox" ><label class="sk-toggleable__label" for="ab3ea0f9-250b-45b4-9b1e-dc1bb78fddc7">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="40fc172e-fc6a-41fd-abdb-692ec1e1086b" type="checkbox" ><label class="sk-toggleable__label" for="40fc172e-fc6a-41fd-abdb-692ec1e1086b">LassoCV</label><div class="sk-toggleable__content"><pre>LassoCV(cv=5, max_iter=10000, random_state=0)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lassoCV_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lassoCV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>78.1184746941765
</pre></div>
</div>
</div>
</div>
<p>Der ermittelte optimale Wert alpha liegt bei 80.62796500840743</p>
</section>
<section id="lasso-lasso-best">
<h3>Lasso - Lasso Best<a class="headerlink" href="#lasso-lasso-best" title="Permalink to this headline">¶</a></h3>
<p>Der ermittelte Optimalwert für alpha wird nun in das Modell eingesetzt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pipeline with model</span>
<span class="n">lassobest_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lassobest&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">lassoCV_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lassoCV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span><span class="p">))</span>
                            <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set best alpha</span>

<span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 {color: black;background-color: white;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 pre{padding: 0;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-toggleable {background-color: white;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-estimator:hover {background-color: #d4ebff;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-item {z-index: 1;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-parallel-item:only-child::after {width: 0;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-7181b38a-7c84-48e1-918e-20f38ea3b664 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-7181b38a-7c84-48e1-918e-20f38ea3b664" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b3d671f8-cd4f-4f88-897e-998cbe5fb21e" type="checkbox" ><label class="sk-toggleable__label" for="b3d671f8-cd4f-4f88-897e-998cbe5fb21e">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])),
                ('lassobest', Lasso(alpha=78.1184746941765))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="2e6a479b-aaee-4121-98a7-727e154e6cef" type="checkbox" ><label class="sk-toggleable__label" for="2e6a479b-aaee-4121-98a7-727e154e6cef">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4a9c0593-ec80-4d0a-b447-47a682688697" type="checkbox" ><label class="sk-toggleable__label" for="4a9c0593-ec80-4d0a-b447-47a682688697">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7C1ABE6D0></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="91434b99-2aff-4cb9-9561-5b84a46d268d" type="checkbox" ><label class="sk-toggleable__label" for="91434b99-2aff-4cb9-9561-5b84a46d268d">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="9e8c51fb-d138-465a-bab6-f6731851a08f" type="checkbox" ><label class="sk-toggleable__label" for="9e8c51fb-d138-465a-bab6-f6731851a08f">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d427ea4a-651f-4a48-af9a-f47b86da6e7f" type="checkbox" ><label class="sk-toggleable__label" for="d427ea4a-651f-4a48-af9a-f47b86da6e7f">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x000001F7CEB0DC10></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="3304d3f9-2aff-40e7-be3e-b06bb67720a0" type="checkbox" ><label class="sk-toggleable__label" for="3304d3f9-2aff-40e7-be3e-b06bb67720a0">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="12435d4a-4580-40e8-9799-c31b0440bd5a" type="checkbox" ><label class="sk-toggleable__label" for="12435d4a-4580-40e8-9799-c31b0440bd5a">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dbf1f971-32f2-43af-9d80-c01d42c0b19b" type="checkbox" ><label class="sk-toggleable__label" for="dbf1f971-32f2-43af-9d80-c01d42c0b19b">Lasso</label><div class="sk-toggleable__content"><pre>Lasso(alpha=78.1184746941765)</pre></div></div></div></div></div></div></div></div></div>
</div>
<p>Zur Berechnung des RMSE werden auch mit dem Modell lassobest_pipe Predictions berechnet.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_trainbest</span> <span class="o">=</span> <span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train2</span><span class="p">)</span>
<span class="n">pred_valbest</span> <span class="o">=</span> <span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Werte mit optimalem alpha:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;mit lasso best:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared validation set &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_val2</span><span class="p">,</span> <span class="n">y_val2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE train set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train2</span><span class="p">,</span> <span class="n">pred_trainbest</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val2</span><span class="p">,</span> <span class="n">pred_valbest</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>mit lasso best:
R squared training set  73.9
R squared validation set  74.88
RMSE train set 53097.67
RMSE validation set 53757.1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Werte ohne optimales alpha:</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;ohne Lasso best:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set lasso &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared validation set lasso &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_val2</span><span class="p">,</span> <span class="n">y_val2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE train set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train2</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val2</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ohne Lasso best:
R squared training set lasso  73.9
R squared validation set lasso  74.89
RMSE train set 53097.18
RMSE validation set 53753.5
</pre></div>
</div>
</div>
</div>
<p><strong>Fazit</strong>: Durch die best alpha Optimierung hat sich das Ergebnis unseres Modells nicht verbessert, lediglich der RMSE ist kaum merklich besser geworden. Ein r2 von ca. 73% und ein RMSE von ca 53.000 ist ähnlich gut wie das Linear Regression Modell mit statsmodels.</p>
</section>
</section>
<section id="splines">
<h2>3. Splines<a class="headerlink" href="#splines" title="Permalink to this headline">¶</a></h2>
<hr class="docutils" />
<section id="splines-mit-scikit-learn">
<h3>3.1 Splines mit scikit learn<a class="headerlink" href="#splines-mit-scikit-learn" title="Permalink to this headline">¶</a></h3>
<p>Für das scikit leran Modell wird wieder der übliche datasplit durchgeführt.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y3</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]]</span>
<span class="n">X3</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_median_age&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data split</span>
<span class="n">X_train3</span><span class="p">,</span> <span class="n">X_val3</span><span class="p">,</span> <span class="n">y_train3</span><span class="p">,</span> <span class="n">y_val3</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Für das Modell definieren wir die Anzahl der zu platzierenden Knots auf 4. Die Komponente SplineTransformer wird diese Knots dann autoamtisch platzieren.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen des Models mit Pipeline. Der Spline Transformer soll 4 Knots platzieren.</span>
<span class="n">splines_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;splines&#39;</span><span class="p">,</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SplineTransformer</span><span class="p">(</span><span class="n">n_knots</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> 
                       <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">splines_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train3</span><span class="p">,</span> <span class="n">y_train3</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Nach dem Erstellen und fitten des Modells wird eine Funktion definiert, um den RMSE auszugeben.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der Funktion model_results um KPIs auszugeben</span>
<span class="k">def</span> <span class="nf">model_results</span><span class="p">(</span><span class="n">model_name</span><span class="p">):</span>

    <span class="c1"># Training data</span>
    <span class="n">pred_train</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train3</span><span class="p">)</span>
    <span class="n">rmse_train</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train3</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Test data</span>
    <span class="n">pred_val</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val3</span><span class="p">)</span>
    <span class="n">rmse_val</span> <span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val3</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Print model results</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span> 
        <span class="s2">&quot;rmse_train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_train</span><span class="p">],</span> 
        <span class="s2">&quot;rmse_val&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_val</span><span class="p">]}</span>
        <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_results</span><span class="p">(</span><span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;spline sklearn&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>rmse_train</th>
      <th>rmse_val</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>spline sklearn</td>
      <td>66611.8676</td>
      <td>66620.3066</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">splines_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train3</span><span class="p">,</span> <span class="n">y_train3</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">splines_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_val3</span><span class="p">,</span> <span class="n">y_val3</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set 66.86
R squared validation set 66.89
</pre></div>
</div>
</div>
</div>
<p>Sowohl der r2 Wert als auch der RMSE des Modells liegen hinter dem der vorherigen Modelle mit statsmodels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create observations</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_val3</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">X_val3</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X3</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">x_new</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">ocean_proximity</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x_new</span><span class="p">:</span> <span class="s2">&quot;dummy&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\olive\AppData\Local\Temp/ipykernel_27644/1056164967.py:2: FutureWarning: Dropping of nuisance columns in DataFrame reductions (with &#39;numeric_only=None&#39;) is deprecated; in a future version this will raise TypeError.  Select only valid columns before calling the reduction.
  x_new = np.linspace(X_val3.min(),X_val3.max(), 100)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">((</span><span class="n">x_new</span><span class="p">))</span>

<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train3</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train3</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">[</span><span class="s2">&quot;median_income&quot;</span><span class="p">],</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cubic spline with degree=3&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_230_0.png" src="_images/regression_230_0.png" />
</div>
</div>
<section id="test-mit-cook-s-distance-bereinigten-dataset">
<h4>Test mit Cook’s Distance bereinigten Dataset<a class="headerlink" href="#test-mit-cook-s-distance-bereinigten-dataset" title="Permalink to this headline">¶</a></h4>
<p>Da dieses Splines Modell das vielversprechendste ist, wird das Modell als Test noch einmal mit den per Cook’s Distance bereinigten Trainingsdaten gefittet und evaluiert.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y5</span> <span class="o">=</span> <span class="n">train_dataset2</span><span class="p">[[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]]</span>
<span class="n">X5</span> <span class="o">=</span> <span class="n">train_dataset2</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_median_age&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data split</span>
<span class="n">X_train5</span><span class="p">,</span> <span class="n">X_val5</span><span class="p">,</span> <span class="n">y_train5</span><span class="p">,</span> <span class="n">y_val5</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X5</span><span class="p">,</span> <span class="n">y5</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen des Models mit Pipeline. Der Spline Transformer soll 4 Knots platzieren.</span>
<span class="n">splinesCD_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;splines&#39;</span><span class="p">,</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SplineTransformer</span><span class="p">(</span><span class="n">n_knots</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> 
                       <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train5</span><span class="p">,</span> <span class="n">y_train5</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der Funktion model_results um KPIs auszugeben</span>
<span class="k">def</span> <span class="nf">model_results</span><span class="p">(</span><span class="n">model_name</span><span class="p">):</span>

    <span class="c1"># Training data</span>
    <span class="n">pred_train</span> <span class="o">=</span> <span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train5</span><span class="p">)</span>
    <span class="n">rmse_train</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train5</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Test data</span>
    <span class="n">pred_val</span> <span class="o">=</span> <span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_val5</span><span class="p">)</span>
    <span class="n">rmse_val</span> <span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val5</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Print model results</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span> 
        <span class="s2">&quot;rmse_train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_train</span><span class="p">],</span> 
        <span class="s2">&quot;rmse_val&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_val</span><span class="p">]}</span>
        <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_results</span><span class="p">(</span><span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;spline sklearn&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>rmse_train</th>
      <th>rmse_val</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>spline sklearn</td>
      <td>52272.2565</td>
      <td>52687.1737</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train5</span><span class="p">,</span> <span class="n">y_train5</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_val5</span><span class="p">,</span> <span class="n">y_val5</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set 74.7
R squared validation set 75.87
</pre></div>
</div>
</div>
</div>
<p>Das Resultat ist um einiges besser als im vorherigen Versuch. Ob das Modell mit den originalen Testdaten auch so gut abschneidet muss allerdings erst evaluiert werden.</p>
</section>
</section>
<section id="cubic-spline-with-patsy-statsmodels">
<h3>3.2 Cubic Spline with Patsy &amp; Statsmodels<a class="headerlink" href="#cubic-spline-with-patsy-statsmodels" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y4</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]]</span>
<span class="n">X4</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data split</span>
<span class="n">X_train4</span><span class="p">,</span> <span class="n">X_val4</span><span class="p">,</span> <span class="n">y_train4</span><span class="p">,</span> <span class="n">y_val4</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X4</span><span class="p">,</span> <span class="n">y4</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen eines cubic spline mit 3 manuell platzierten knots bei 1, 4 und 7</span>
<span class="n">transformed_x</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">(</span>
            <span class="s2">&quot;bs(train, knots=(1,4,7), degree=3, include_intercept=False)&quot;</span><span class="p">,</span> 
                <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train4</span><span class="p">},</span><span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitten des linearen models an das transformierte dataset</span>
<span class="n">spline2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="p">(</span><span class="n">y_train4</span><span class="p">,</span> <span class="n">transformed_x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Training data</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">spline2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;bs(train, knots=(1,4,7), include_intercept=False)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train4</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train4</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Validation data</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">spline2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;bs(val, knots=(1,4,7), include_intercept=False)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="n">X_val4</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_val</span> <span class="o">=</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val4</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Save model results</span>
<span class="n">model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Cubic spline&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;rmse_train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_train</span><span class="p">],</span> 
    <span class="s2">&quot;rmse_val&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_val</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">model_results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>rmse_train</th>
      <th>rmse_val</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cubic spline</td>
      <td>82755.707542</td>
      <td>83552.807458</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_train4</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared validation set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val4</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set 48.84
R squared validation set 47.93
</pre></div>
</div>
</div>
</div>
<p>In diesem Modell ist sowohl der r2 Wert als auch der RMSE sehr viel schlechter als in den übrigen Modellen. Dies überrascht nicht, da in diesem Modell nur eine X Variable zur Vorhersage verwendet wurde.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create observations</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_val4</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">X_val4</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1"># Make some predictions</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">spline2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;bs(xp, knots=(1,4,7), include_intercept=False)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;xp&quot;</span><span class="p">:</span> <span class="n">xp</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>

<span class="c1"># plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train4</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train4</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cubic spline with degree=3 (3 knots)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_249_0.png" src="_images/regression_249_0.png" />
</div>
</div>
</section>
<section id="natural-spline-with-patsy-statsmodels">
<h3>3.3 Natural Spline with Patsy &amp; Statsmodels<a class="headerlink" href="#natural-spline-with-patsy-statsmodels" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_x3</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(train,df = 3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train4</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>

<span class="n">spline3</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="p">(</span><span class="n">y_train3</span><span class="p">,</span> <span class="n">transformed_x3</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Training data</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">spline3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(train, df=3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train4</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train4</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Validation data</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">spline3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(val, df=3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="n">X_val4</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_val</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_val4</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Save model results</span>
<span class="n">model_results_ns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Natural spline (ns)&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;rmse_train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_train</span><span class="p">],</span> 
    <span class="s2">&quot;rmse_val&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_val</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">model_results_ns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>rmse_train</th>
      <th>rmse_val</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Natural spline (ns)</td>
      <td>83727.928042</td>
      <td>84043.715646</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_train4</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_val4</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set 47.63
R squared test set 47.31
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make predictions</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">spline3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(xp, df=3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;xp&quot;</span><span class="p">:</span> <span class="n">xp</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_val4</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">X_val4</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train4</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train4</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Natural spline&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_254_0.png" src="_images/regression_254_0.png" />
</div>
</div>
</section>
</section>
</section>
<section id="abschlieszende-evaluation-mit-testdaten">
<h1>Abschließende Evaluation mit Testdaten<a class="headerlink" href="#abschlieszende-evaluation-mit-testdaten" title="Permalink to this headline">¶</a></h1>
<section id="transformation-testdaten">
<h2>Transformation Testdaten<a class="headerlink" href="#transformation-testdaten" title="Permalink to this headline">¶</a></h2>
<p>Um die Testdaten verwenden zu können, müssen die gleichen Schritte zur Transformation durchgeführt werden wie mit den Traindaten (ANpassung Datentypen, droppen NULL values, Erzeugen von selbst erstellten Features)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10</th>
      <td>-122.26</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>2202</td>
      <td>434.0</td>
      <td>910</td>
      <td>402</td>
      <td>3.2031</td>
      <td>281500.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>13</th>
      <td>-122.26</td>
      <td>37.84</td>
      <td>52.0</td>
      <td>696</td>
      <td>191.0</td>
      <td>345</td>
      <td>174</td>
      <td>2.6736</td>
      <td>191300.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>19</th>
      <td>-122.27</td>
      <td>37.84</td>
      <td>52.0</td>
      <td>1503</td>
      <td>298.0</td>
      <td>690</td>
      <td>275</td>
      <td>2.6033</td>
      <td>162900.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>28</th>
      <td>-122.28</td>
      <td>37.84</td>
      <td>50.0</td>
      <td>2082</td>
      <td>492.0</td>
      <td>1131</td>
      <td>473</td>
      <td>1.6424</td>
      <td>108900.0</td>
      <td>NEAR BAY</td>
      <td>below</td>
    </tr>
    <tr>
      <th>40</th>
      <td>-122.26</td>
      <td>37.83</td>
      <td>52.0</td>
      <td>1665</td>
      <td>419.0</td>
      <td>946</td>
      <td>395</td>
      <td>2.0978</td>
      <td>155400.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20605</th>
      <td>-121.58</td>
      <td>39.12</td>
      <td>26.0</td>
      <td>2796</td>
      <td>629.0</td>
      <td>2017</td>
      <td>632</td>
      <td>1.8355</td>
      <td>61200.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20609</th>
      <td>-121.56</td>
      <td>39.11</td>
      <td>18.0</td>
      <td>2171</td>
      <td>480.0</td>
      <td>1527</td>
      <td>447</td>
      <td>2.3011</td>
      <td>57500.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20620</th>
      <td>-121.48</td>
      <td>39.05</td>
      <td>40.0</td>
      <td>198</td>
      <td>41.0</td>
      <td>151</td>
      <td>48</td>
      <td>4.5625</td>
      <td>100000.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
    <tr>
      <th>20622</th>
      <td>-121.44</td>
      <td>39.00</td>
      <td>20.0</td>
      <td>755</td>
      <td>147.0</td>
      <td>457</td>
      <td>157</td>
      <td>2.4167</td>
      <td>67000.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20634</th>
      <td>-121.56</td>
      <td>39.27</td>
      <td>28.0</td>
      <td>2332</td>
      <td>395.0</td>
      <td>1041</td>
      <td>344</td>
      <td>3.7125</td>
      <td>116800.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
  </tbody>
</table>
<p>4128 rows × 11 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># droppen von NULL Values</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># nicht benötigte Variable droppen</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;price_category&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Anpassung der datatypes</span>
<span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;total_bedrooms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;total_bedrooms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># erzeugen der selbst erstellten Features</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">people_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">population</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_room</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zusammenfassung des Features ocean_proximity</span>
<span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;ISLAND&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NEAR BAY&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;NEAR OCEAN&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">ocean_proximity</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;1H OCEAN&quot;</span><span class="p">,</span> <span class="s2">&quot;NEAR WATER&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Korrektur des datatype von ocean_proximity</span>
<span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-data-split">
<h2>Test Data Split<a class="headerlink" href="#test-data-split" title="Permalink to this headline">¶</a></h2>
<p>Um die Testdaten in der Evaluation für bestimmte Modelle verwenden zu können, müssen diese nach Features und vorherzusagender Varaible aufgeteilt werden.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#X = test_dataset.drop([&quot;median_house_value&quot;], axis=1)</span>
<span class="c1">#y= test_dataset[&quot;median_house_value&quot;]</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;people_per_household&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;bedrooms_per_room&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">test_dataset</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="finale-evaluation">
<h2>Finale Evaluation<a class="headerlink" href="#finale-evaluation" title="Permalink to this headline">¶</a></h2>
<p>Zur finalen Evaluation mit den Testdaten werden die besten Modelle ausgewählt:</p>
<ol class="simple">
<li><p>Lineare Regression mit statsmodels</p></li>
<li><p>Lasso Regression mit scikit learn</p></li>
<li><p>Splines mit scikit learn</p></li>
</ol>
<section id="evaluation-lineares-regressionsmodell-mit-statsmodels">
<h3>Evaluation Lineares Regressionsmodell mit statsmodels<a class="headerlink" href="#evaluation-lineares-regressionsmodell-mit-statsmodels" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_test</span> <span class="o">=</span> <span class="n">lm2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">r2_score</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>RMSE test set 69665.64
R squared test set 62.77
</pre></div>
</div>
</div>
</div>
<p>Die Ergebnisse mit den Testdaten sind schlechter als die Resultate mit den bearbeiteten Trainingsdaten. Dies liegt vermutlich am Entfernen vieler Outlier durch Cook’s Distance.</p>
</section>
<section id="evaluation-lasso-regression-mit-scikit-learn">
<h3>Evaluation Lasso Regression mit scikit learn<a class="headerlink" href="#evaluation-lasso-regression-mit-scikit-learn" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_testfinal</span> <span class="o">=</span> <span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testergebnis mit lasso best:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set &#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred_testfinal</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Testergebnis mit lasso best:
R squared test set  35.76
RMSE test set 91509.58
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluation-splines-mit-scikit-learn">
<h3>Evaluation Splines mit scikit learn<a class="headerlink" href="#evaluation-splines-mit-scikit-learn" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der Funktion model_results um KPIs auszugeben</span>
<span class="k">def</span> <span class="nf">model_results</span><span class="p">(</span><span class="n">model_name</span><span class="p">):</span>

    <span class="c1"># Training data</span>
    <span class="n">pred_train</span> <span class="o">=</span> <span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train5</span><span class="p">)</span>
    <span class="n">rmse_train</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train5</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Test data</span>
    <span class="n">pred_val</span> <span class="o">=</span> <span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">rmse_val</span> <span class="o">=</span><span class="nb">round</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pred_val</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Print model results</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="p">,</span> 
        <span class="s2">&quot;rmse_train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_train</span><span class="p">],</span> 
        <span class="s2">&quot;rmse_test&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_val</span><span class="p">]}</span>
        <span class="p">)</span>
    
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_results</span><span class="p">(</span><span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;spline sklearn&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>rmse_train</th>
      <th>rmse_test</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>spline sklearn</td>
      <td>52272.2565</td>
      <td>65233.9997</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">splinesCD_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared test set 67.36
</pre></div>
</div>
</div>
</div>
<p>Das Modell, welches mit dem Cook’s Distance optimierten Traindataset gefitted wurde, erzielt in der Evaluation mit den Testdaten leicht bessere Ergebnisse.</p>
<p>Zum Vergleich die KPIs ohne Cook’s Distance Optimierung:</p>
<ul class="simple">
<li><p>RMSE: 66017.6385</p></li>
<li><p>r2: 66.57</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Variablen.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Variablen</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="classification.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Classification Modelle</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Oliver Schabe<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
    
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>


    
  </body>
</html>