
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Regression Project &#8212; California Housing Guide</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Variablen" href="Variablen.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">California Housing Guide</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   California Housing Guide
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="content.html">
   Content in Jupyter Book
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="Variablen.html">
     Variablen
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Regression Project
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/executablebooks/jupyter-book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2Fregression.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/regression.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Regression Project
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mit-welchem-rmse-ware-ich-zufrieden">
   Mit welchem RMSE wäre ich zufrieden?
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#import-von-benotigten-libraries">
     Import von benötigten Libraries
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#erstellen-der-pipeline-fur-scikit-learn-modelle">
     Erstellen der Pipeline für scikit learn Modelle
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-data">
   Import Data
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-split">
   Data Split
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-inspection">
   Data Inspection
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#deskriptive-statistik">
   Deskriptive Statistik
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploratory-data-analysis">
   Exploratory Data Analysis
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eda-analyse-kategorialer-varaiblen">
     <strong>
      EDA - Analyse kategorialer Varaiblen
     </strong>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#eda-analyse-numerischer-varaiblen">
     <strong>
      EDA - Analyse numerischer Varaiblen
     </strong>
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#correlation">
     <strong>
      Correlation
     </strong>
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#initial-feature-engineering">
   Initial Feature Engineering
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#modelling">
   Modelling
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#linear-ols-regression">
     1. Linear OLS Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#model-1-1-linear-ols-regression-with-sklearn">
       Model 1.1 - Linear OLS Regression with sklearn
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#evaluation-with-test-data">
         Evaluation with Test Data
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#evaluate-with-training-data">
         Evaluate with Training data
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id1">
         Evaluation with Test Data
        </a>
       </li>
      </ul>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#model-1-2-linear-ols-regression-with-statsmodels">
       Model 1.2 - Linear OLS Regression with Statsmodels
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#model-mit-original-variablen">
         Model mit Original Variablen
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#regression-diagnostics">
         <strong>
          Regression Diagnostics
         </strong>
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#model-mit-selbst-erstellten-variablen">
         Model mit selbst erstellten Variablen
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#id2">
         Regression Diagnostics
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#lasso-regression">
     2. Lasso Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lasso-regression-mit-scikit-learn">
       2.1 Lasso Regression mit scikit-learn
      </a>
      <ul class="nav section-nav flex-column">
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#split-data">
         Split Data
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#standardization">
         Standardization
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lasso-model">
         Lasso - Model
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lasso-model-evaluation">
         Lasso - Model Evaluation
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lasso-k-fold-cross-validation">
         Lasso - k-fold cross validation
        </a>
       </li>
       <li class="toc-h4 nav-item toc-entry">
        <a class="reference internal nav-link" href="#lasso-lasso-best">
         Lasso - Lasso Best
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splines">
     3. Splines
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#splines-with-sclearn">
       3.1 Splines with sclearn
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#splines-with-patsy">
       3.2 Splines with Patsy
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#natural-spline-with-patsy-statsmodels">
       3.3 Natural Spline with Patsy &amp; Statsmodels
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <section id="regression-project">
<h1>Regression Project<a class="headerlink" href="#regression-project" title="Permalink to this headline">¶</a></h1>
<p>In this project, your goal is to build regression models of housing prices. The models should learn from data and be able to predict the median house price in a district (which is a population of 600 to 3000 people), given some predictor variables.</p>
</section>
<section id="mit-welchem-rmse-ware-ich-zufrieden">
<h1>Mit welchem RMSE wäre ich zufrieden?<a class="headerlink" href="#mit-welchem-rmse-ware-ich-zufrieden" title="Permalink to this headline">¶</a></h1>
</section>
<section id="setup">
<h1>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h1>
<section id="import-von-benotigten-libraries">
<h2>Import von benötigten Libraries<a class="headerlink" href="#import-von-benotigten-libraries" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Allgemein</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span> 
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">statsmodels.compat</span> <span class="kn">import</span> <span class="n">lzip</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">from</span> <span class="nn">statsmodels.formula.api</span> <span class="kn">import</span> <span class="n">ols</span>
<span class="kn">from</span> <span class="nn">statsmodels.stats.outliers_influence</span> <span class="kn">import</span> <span class="n">variance_inflation_factor</span>

<span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>
<span class="kn">from</span> <span class="nn">statsmodels.tools.eval_measures</span> <span class="kn">import</span> <span class="n">mse</span><span class="p">,</span> <span class="n">rmse</span>

<span class="c1"># Einstellung für Visualisierungen</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;ticks&quot;</span><span class="p">,</span> <span class="n">color_codes</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="c1"># Für sklearn pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">make_column_selector</span> <span class="k">as</span> <span class="n">selector</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.impute</span> <span class="kn">import</span> <span class="n">SimpleImputer</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">set_config</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Lasso</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LassoCV</span>

<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">r2_score</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>


<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">px</span>

<span class="kn">from</span> <span class="nn">patsy</span> <span class="kn">import</span> <span class="n">dmatrix</span>

<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">SplineTransformer</span>

<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="erstellen-der-pipeline-fur-scikit-learn-modelle">
<h2>Erstellen der Pipeline für scikit learn Modelle<a class="headerlink" href="#erstellen-der-pipeline-fur-scikit-learn-modelle" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for numeric features</span>
<span class="c1">#Normalisierung (X=(X-Mittelwert) / Standardabweichung)</span>
<span class="n">numeric_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;median&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;scaler&#39;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for categorical features  </span>
<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;imputer&#39;</span><span class="p">,</span> <span class="n">SimpleImputer</span><span class="p">(</span><span class="n">strategy</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s1">&#39;missing&#39;</span><span class="p">)),</span> <span class="c1">#Konstante bei fehlenden Werten reinschreiben</span>
    <span class="p">(</span><span class="s1">&#39;onehot&#39;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">))</span><span class="c1">#pro Featureausprägung eine Spalte, zutreffendes Feature hat dann Wert 1 und die anderen Wert 0</span>
    <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pipeline</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;num&#39;</span><span class="p">,</span> <span class="n">numeric_transformer</span><span class="p">,</span> <span class="n">selector</span><span class="p">(</span><span class="n">dtype_exclude</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;cat&#39;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">selector</span><span class="p">(</span><span class="n">dtype_include</span><span class="o">=</span><span class="s2">&quot;category&quot;</span><span class="p">))</span>
        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="import-data">
<h1>Import Data<a class="headerlink" href="#import-data" title="Permalink to this headline">¶</a></h1>
<p>Als nächstes wird der Datensatz aus dem GutHub Repository importiert</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ROOT</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/jan-kirenz/project-OliScha/main/&quot;</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="s2">&quot;project_data.csv?token=GHSAT0AAAAAABPCEITIYHBIEPRTFMZJXUGKYPKREJQ&quot;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">ROOT</span> <span class="o">+</span> <span class="n">DATA</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Prüfen ob Import funktioniert hat und ersten Blick auf Daten werfen</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-122.23</td>
      <td>37.88</td>
      <td>41.0years</td>
      <td>880</td>
      <td>129.0</td>
      <td>322</td>
      <td>126</td>
      <td>8.3252</td>
      <td>452600.0$</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-122.22</td>
      <td>37.86</td>
      <td>21.0</td>
      <td>7099</td>
      <td>1106.0</td>
      <td>2401</td>
      <td>1138</td>
      <td>8.3014</td>
      <td>358500.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-122.24</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1467</td>
      <td>190.0</td>
      <td>496</td>
      <td>177</td>
      <td>7.2574</td>
      <td>352100.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>3</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1274</td>
      <td>235.0</td>
      <td>558</td>
      <td>219</td>
      <td>5.6431</td>
      <td>341300.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-122.25</td>
      <td>37.85</td>
      <td>52.0</td>
      <td>1627</td>
      <td>280.0</td>
      <td>565</td>
      <td>259</td>
      <td>3.8462</td>
      <td>342200.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20635</th>
      <td>-121.09</td>
      <td>39.48</td>
      <td>25.0</td>
      <td>1665</td>
      <td>374.0</td>
      <td>845</td>
      <td>330</td>
      <td>1.5603</td>
      <td>78100.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20636</th>
      <td>-121.21</td>
      <td>39.49</td>
      <td>18.0</td>
      <td>697</td>
      <td>150.0</td>
      <td>356</td>
      <td>114</td>
      <td>2.5568</td>
      <td>77100.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20637</th>
      <td>-121.22</td>
      <td>39.43</td>
      <td>17.0</td>
      <td>2254</td>
      <td>485.0</td>
      <td>1007</td>
      <td>433</td>
      <td>1.7000</td>
      <td>92300.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20638</th>
      <td>-121.32</td>
      <td>39.43</td>
      <td>18.0</td>
      <td>1860</td>
      <td>409.0</td>
      <td>741</td>
      <td>349</td>
      <td>1.8672</td>
      <td>84700.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20639</th>
      <td>-121.24</td>
      <td>39.37</td>
      <td>16.0</td>
      <td>2785</td>
      <td>616.0</td>
      <td>1387</td>
      <td>530</td>
      <td>2.3886</td>
      <td>89400.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
  </tbody>
</table>
<p>20640 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="data-split">
<h1>Data Split<a class="headerlink" href="#data-split" title="Permalink to this headline">¶</a></h1>
<p>The error rate on new cases is called the generalization error (or out-of-sample error), and by evaluating our model on the test set, we get an estimate of this error. This value tells you how well your model will perform on instances it has never seen before</p>
<p><em>Im nächsten Schritt wird das df in Trainingsdaten und Testdaten aufgeteilt. Durch random state = 0 sind die Datensätze jederzeit replizierbar.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data Split</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">test_dataset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="n">train_dataset</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>ocean_proximity</th>
      <th>price_category</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>14740</th>
      <td>-117.05</td>
      <td>32.58</td>
      <td>22.0</td>
      <td>2101</td>
      <td>399.0</td>
      <td>1551</td>
      <td>371</td>
      <td>4.1518</td>
      <td>136900.0</td>
      <td>NEAR OCEAN</td>
      <td>below</td>
    </tr>
    <tr>
      <th>10101</th>
      <td>-117.97</td>
      <td>33.92</td>
      <td>32.0</td>
      <td>2620</td>
      <td>398.0</td>
      <td>1296</td>
      <td>429</td>
      <td>5.7796</td>
      <td>241300.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
    </tr>
    <tr>
      <th>20566</th>
      <td>-121.84</td>
      <td>38.65</td>
      <td>29.0</td>
      <td>3167</td>
      <td>548.0</td>
      <td>1554</td>
      <td>534</td>
      <td>4.3487</td>
      <td>200700.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>2670</th>
      <td>-115.60</td>
      <td>33.20</td>
      <td>37.0</td>
      <td>709</td>
      <td>187.0</td>
      <td>390</td>
      <td>142</td>
      <td>2.4511</td>
      <td>72500.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>15709</th>
      <td>-122.43</td>
      <td>37.79</td>
      <td>25.0</td>
      <td>1637</td>
      <td>394.0</td>
      <td>649</td>
      <td>379</td>
      <td>5.0049</td>
      <td>460000.0</td>
      <td>NEAR BAY</td>
      <td>above</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7616</th>
      <td>-118.22</td>
      <td>33.86</td>
      <td>16.0</td>
      <td>8732</td>
      <td>1489.0</td>
      <td>3944</td>
      <td>1493</td>
      <td>5.1948</td>
      <td>203500.0</td>
      <td>&lt;1H OCEAN</td>
      <td>above</td>
    </tr>
    <tr>
      <th>8767</th>
      <td>-118.39</td>
      <td>33.81</td>
      <td>35.0</td>
      <td>1008</td>
      <td>165.0</td>
      <td>391</td>
      <td>167</td>
      <td>3.7778</td>
      <td>487500.0</td>
      <td>NEAR OCEAN</td>
      <td>above</td>
    </tr>
    <tr>
      <th>16388</th>
      <td>-121.30</td>
      <td>38.05</td>
      <td>52.0</td>
      <td>122</td>
      <td>26.0</td>
      <td>62</td>
      <td>25</td>
      <td>1.1500</td>
      <td>112500.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
    <tr>
      <th>19949</th>
      <td>-119.37</td>
      <td>36.21</td>
      <td>35.0</td>
      <td>2228</td>
      <td>476.0</td>
      <td>1567</td>
      <td>449</td>
      <td>1.4455</td>
      <td>54100.0</td>
      <td>INLAND</td>
      <td>above</td>
    </tr>
    <tr>
      <th>10078</th>
      <td>-120.27</td>
      <td>39.35</td>
      <td>11.0</td>
      <td>2520</td>
      <td>401.0</td>
      <td>397</td>
      <td>165</td>
      <td>4.6650</td>
      <td>145600.0</td>
      <td>INLAND</td>
      <td>below</td>
    </tr>
  </tbody>
</table>
<p>16512 rows × 11 columns</p>
</div></div></div>
</div>
</section>
<section id="data-inspection">
<h1>Data Inspection<a class="headerlink" href="#data-inspection" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Datentypen und fehlende Werte prüfen</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 16512 entries, 14740 to 10078
Data columns (total 11 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   longitude           16512 non-null  float64
 1   latitude            16512 non-null  float64
 2   housing_median_age  16512 non-null  object 
 3   total_rooms         16512 non-null  int64  
 4   total_bedrooms      16352 non-null  float64
 5   population          16512 non-null  int64  
 6   households          16512 non-null  int64  
 7   median_income       16512 non-null  float64
 8   median_house_value  16512 non-null  object 
 9   ocean_proximity     16512 non-null  object 
 10  price_category      16512 non-null  object 
dtypes: float64(4), int64(3), object(4)
memory usage: 1.5+ MB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identifizieren der NULL Werte via Heatmap</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">isnull</span><span class="p">(),</span> 
            <span class="n">yticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">cbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_20_0.png" src="_images/regression_20_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Identifizieren der NULL Werte via Liste</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>longitude               0
latitude                0
housing_median_age      0
total_rooms             0
total_bedrooms        160
population              0
households              0
median_income           0
median_house_value      0
ocean_proximity         0
price_category          0
dtype: int64
</pre></div>
</div>
</div>
</div>
<p>In den vorherigen Schritten kann erkannt werden, das für das Attribut total_bedrooms 207 Null Values vorliegen. alle anderen Attribute sind vollständig</p>
<p><em>Anhand der hier abgebildeten Untersuchung kann erkannt werden, dass die Variable “total_bedrooms” in 207 Observations leer ist. Die hier entdeckten Anomalien werden später unter Feature Engineering entfernt.</em></p>
</section>
<section id="deskriptive-statistik">
<h1>Deskriptive Statistik<a class="headerlink" href="#deskriptive-statistik" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># summary statistics for all numerical columns</span>
<span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>longitude</th>
      <td>20640.0</td>
      <td>-119.6</td>
      <td>2.0</td>
      <td>-124.4</td>
      <td>-121.8</td>
      <td>-118.5</td>
      <td>-118.0</td>
      <td>-114.3</td>
    </tr>
    <tr>
      <th>latitude</th>
      <td>20640.0</td>
      <td>35.6</td>
      <td>2.1</td>
      <td>32.5</td>
      <td>33.9</td>
      <td>34.3</td>
      <td>37.7</td>
      <td>42.0</td>
    </tr>
    <tr>
      <th>total_rooms</th>
      <td>20640.0</td>
      <td>2635.8</td>
      <td>2181.6</td>
      <td>2.0</td>
      <td>1447.8</td>
      <td>2127.0</td>
      <td>3148.0</td>
      <td>39320.0</td>
    </tr>
    <tr>
      <th>total_bedrooms</th>
      <td>20433.0</td>
      <td>537.9</td>
      <td>421.4</td>
      <td>1.0</td>
      <td>296.0</td>
      <td>435.0</td>
      <td>647.0</td>
      <td>6445.0</td>
    </tr>
    <tr>
      <th>population</th>
      <td>20640.0</td>
      <td>1425.5</td>
      <td>1132.5</td>
      <td>3.0</td>
      <td>787.0</td>
      <td>1166.0</td>
      <td>1725.0</td>
      <td>35682.0</td>
    </tr>
    <tr>
      <th>households</th>
      <td>20640.0</td>
      <td>499.5</td>
      <td>382.3</td>
      <td>1.0</td>
      <td>280.0</td>
      <td>409.0</td>
      <td>605.0</td>
      <td>6082.0</td>
    </tr>
    <tr>
      <th>median_income</th>
      <td>20640.0</td>
      <td>3.9</td>
      <td>1.9</td>
      <td>0.5</td>
      <td>2.6</td>
      <td>3.5</td>
      <td>4.7</td>
      <td>15.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Die Zeilen mit 25 %, 50 % und 75 % zeigen die entsprechenden Perzentile: EinPerzentil besagt, dass ein bestimmter prozentualer Anteil der Beobachtungenunterhalb eines Werts liegt. Beispielsweise haben 25 % der Bezirke ein housing_median_age unter 18, 50 % liegen unter 29, und 75 % liegen unter 37. Diese nenntman oft das 25. Perzentil (oder 1. Quartil), den Median und das 75. Perzentil(oder 3. Quartil)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_18856</span><span class="o">/</span><span class="mf">2021759643.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span> <span class="p">)</span>

<span class="nn">~\Anaconda\lib\site-packages\seaborn\distributions.py</span> in <span class="ni">displot</span><span class="nt">(data, x, y, hue, row, col, weights, kind, rug, rug_kws, log_scale, legend, palette, hue_order, hue_norm, color, col_wrap, row_order, col_order, height, aspect, facet_kws, **kwargs)</span>
<span class="g g-Whitespace">   </span><span class="mi">2240</span>     <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">2241</span>         <span class="n">allowed_types</span> <span class="o">=</span> <span class="kc">None</span>
<span class="ne">-&gt; </span><span class="mi">2242</span>     <span class="n">p</span><span class="o">.</span><span class="n">_attach</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">allowed_types</span><span class="o">=</span><span class="n">allowed_types</span><span class="p">,</span> <span class="n">log_scale</span><span class="o">=</span><span class="n">log_scale</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">2243</span> 
<span class="g g-Whitespace">   </span><span class="mi">2244</span>     <span class="c1"># Check for a specification that lacks x/y data and return early</span>

<span class="nn">~\Anaconda\lib\site-packages\seaborn\_core.py</span> in <span class="ni">_attach</span><span class="nt">(self, obj, allowed_types, log_scale)</span>
<span class="g g-Whitespace">   </span><span class="mi">1123</span>                     <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">allowed_types</span><span class="si">}</span><span class="s2"> is required&quot;</span>
<span class="g g-Whitespace">   </span><span class="mi">1124</span>                 <span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1125</span>                 <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1126</span> 
<span class="g g-Whitespace">   </span><span class="mi">1127</span>             <span class="c1"># Register with the matplotlib unit conversion machinery</span>

<span class="ne">TypeError</span>: The x variable is categorical, but one of [&#39;numeric&#39;, &#39;datetime&#39;] is required
</pre></div>
</div>
<img alt="_images/regression_27_1.png" src="_images/regression_27_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">bins</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="mi">15</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_28_0.png" src="_images/regression_28_0.png" />
</div>
</div>
</section>
<section id="exploratory-data-analysis">
<h1>Exploratory Data Analysis<a class="headerlink" href="#exploratory-data-analysis" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#nimmt nur numerische variablen</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_30_0.png" src="_images/regression_30_0.png" />
</div>
</div>
<p><em><strong>Erkenntnis:</strong> Ein Zusammenhang zwischen Income und house value ist zu erkennen, ansonstn keine offensichtlichen Zusammenhänge.<br />
Lineare Zusammenhänge zwischen rooms, bedrooms, households und population sind logisch und müssen bei der Modellierung später beachtet werden (Collinearity).</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median_house_value        1.000000
median_income             0.690796
household_per_person      0.263035
rooms_per_household       0.165391
total_rooms               0.135640
housing_median_age        0.109786
households                0.066077
total_bedrooms            0.049908
population               -0.026873
longitude                -0.047459
bedrooms_per_household   -0.066208
latitude                 -0.142811
people_per_household     -0.208637
Name: median_house_value, dtype: float64
</pre></div>
</div>
</div>
</div>
<hr class="docutils" />
<section id="eda-analyse-kategorialer-varaiblen">
<h2><strong>EDA - Analyse kategorialer Varaiblen</strong><a class="headerlink" href="#eda-analyse-kategorialer-varaiblen" title="Permalink to this headline">¶</a></h2>
<p><em>Als nächstes werden die kategorialen Variablen näher untersucht. Im Datensatz gibt es lediglich zwei kategoriale Variablen, “ocean_proximity” und “price_category”. Da sich die Variable “price_category” direkt von der vorherzusagenden Variablen “median_house_value” ableitet, ist diese nicht zur Vorhersage geeignet und wird daher nicht weiter beachtet.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;1H OCEAN     7211
INLAND        5209
NEAR OCEAN    2112
NEAR BAY      1802
ISLAND           5
Name: ocean_proximity, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Verteilung von ocean_proximity auf Geokoordinaten visualisieren</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_37_0.png" src="_images/regression_37_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualisierung Dichte</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_38_0.png" src="_images/regression_38_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s2">&quot;scatter&quot;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">7</span><span class="p">),</span><span class="n">c</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s2">&quot;jet&quot;</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x21e738d92e0&gt;
</pre></div>
</div>
<img alt="_images/regression_39_2.png" src="_images/regression_39_2.png" />
</div>
</div>
<p><em>Auf der Karte (Kalifornien) lässt sich eine klare Verteilung der Variablen “ocean_proximity” erkennen. Die Ausprägungen “Island” und “Near Bay” liegen nur an jeweils einer bestimmten Stelle auf der Karte vor.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Untersuchung der kategroialen Variable &quot;ocean_proximity&quot; mit einem erweiterten Boxplot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">boxenplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_41_0.png" src="_images/regression_41_0.png" />
</div>
</div>
<p><em>Im Boxplot Diagramm lassen sich bereits einige Outlier erkennen, welche sich am unteren Wertebereich von “median_house_value” befinden.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ergänzung zum Boxplot um Menge und Dichte der Observations zu visualisieren</span>
<span class="n">sns</span><span class="o">.</span><span class="n">stripplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span> <span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_43_0.png" src="_images/regression_43_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyse von &quot;ocean_proximity&quot; mit displot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">displot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">hue</span> <span class="o">=</span> <span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="s2">&quot;kde&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;seaborn.axisgrid.FacetGrid at 0x21e74694fd0&gt;
</pre></div>
</div>
<img alt="_images/regression_44_1.png" src="_images/regression_44_1.png" />
</div>
</div>
<blockquote>
<div><p><em><strong>Fazit:</strong> “ocean_proximity” hat definitiv Einfluss auf unsere vorherzusagende Variable. Inland ist bspw. tenedneziell günstiger als die anderen Ausprägungen.<br />
Auffällig ist, das es für die Ausprägung Island nur sehr wenige Observations gibt und Island und Near Bay stark auf lokale Gebiete beschränkt sind (siehe Karte).</em></p>
</div></blockquote>
</section>
<hr class="docutils" />
<section id="eda-analyse-numerischer-varaiblen">
<h2><strong>EDA - Analyse numerischer Varaiblen</strong><a class="headerlink" href="#eda-analyse-numerischer-varaiblen" title="Permalink to this headline">¶</a></h2>
<p><em>Vor allem die numerische Variable “median_income” sieht auf Basis des zu Beginn erstellen pairplots vielversprechend aus und wird daher nun näher untersucht. Aber auch andere numerische Varaiblen sollen noch genauer betrachtet werden.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Grouped summary statistics for all numerical columns (in transposed view)</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ocean_proximity</th>
      <th>&lt;1H OCEAN</th>
      <th>INLAND</th>
      <th>ISLAND</th>
      <th>NEAR BAY</th>
      <th>NEAR OCEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">longitude</th>
      <th>count</th>
      <td>7211.000000</td>
      <td>5209.000000</td>
      <td>5.000000</td>
      <td>1802.000000</td>
      <td>2112.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>-118.842258</td>
      <td>-119.724281</td>
      <td>-118.354000</td>
      <td>-122.264506</td>
      <td>-119.330251</td>
    </tr>
    <tr>
      <th>std</th>
      <td>1.584648</td>
      <td>1.896371</td>
      <td>0.070569</td>
      <td>0.148030</td>
      <td>2.329356</td>
    </tr>
    <tr>
      <th>min</th>
      <td>-124.140000</td>
      <td>-123.530000</td>
      <td>-118.480000</td>
      <td>-122.590000</td>
      <td>-124.350000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>-118.495000</td>
      <td>-121.340000</td>
      <td>-118.330000</td>
      <td>-122.410000</td>
      <td>-122.020000</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">rooms_per_household</th>
      <th>min</th>
      <td>0.846154</td>
      <td>1.550409</td>
      <td>4.138728</td>
      <td>1.824719</td>
      <td>1.968051</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>4.231236</td>
      <td>4.867500</td>
      <td>5.060423</td>
      <td>4.427575</td>
      <td>4.224502</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>5.058925</td>
      <td>5.495446</td>
      <td>5.473318</td>
      <td>5.075336</td>
      <td>5.125758</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>5.953044</td>
      <td>6.204188</td>
      <td>6.225000</td>
      <td>5.905523</td>
      <td>6.015899</td>
    </tr>
    <tr>
      <th>max</th>
      <td>22.222222</td>
      <td>62.422222</td>
      <td>7.385417</td>
      <td>9.802326</td>
      <td>28.600000</td>
    </tr>
  </tbody>
</table>
<p>104 rows × 5 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">round</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">describe</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>longitude</th>
      <td>16339.0</td>
      <td>-119.56</td>
      <td>2.00</td>
      <td>-124.35</td>
      <td>-121.79</td>
      <td>-118.49</td>
      <td>-118.00</td>
      <td>-114.31</td>
    </tr>
    <tr>
      <th>latitude</th>
      <td>16339.0</td>
      <td>35.63</td>
      <td>2.14</td>
      <td>32.55</td>
      <td>33.93</td>
      <td>34.25</td>
      <td>37.71</td>
      <td>41.95</td>
    </tr>
    <tr>
      <th>housing_median_age</th>
      <td>16339.0</td>
      <td>28.63</td>
      <td>12.60</td>
      <td>1.00</td>
      <td>18.00</td>
      <td>29.00</td>
      <td>37.00</td>
      <td>52.00</td>
    </tr>
    <tr>
      <th>total_rooms</th>
      <td>16339.0</td>
      <td>2623.28</td>
      <td>2126.35</td>
      <td>6.00</td>
      <td>1453.00</td>
      <td>2120.00</td>
      <td>3127.00</td>
      <td>37937.00</td>
    </tr>
    <tr>
      <th>total_bedrooms</th>
      <td>16339.0</td>
      <td>535.25</td>
      <td>410.92</td>
      <td>1.00</td>
      <td>297.00</td>
      <td>434.00</td>
      <td>644.00</td>
      <td>5471.00</td>
    </tr>
    <tr>
      <th>population</th>
      <td>16339.0</td>
      <td>1416.02</td>
      <td>1071.59</td>
      <td>3.00</td>
      <td>787.00</td>
      <td>1163.00</td>
      <td>1720.00</td>
      <td>16122.00</td>
    </tr>
    <tr>
      <th>households</th>
      <td>16339.0</td>
      <td>496.71</td>
      <td>372.69</td>
      <td>1.00</td>
      <td>281.00</td>
      <td>408.00</td>
      <td>601.00</td>
      <td>5189.00</td>
    </tr>
    <tr>
      <th>median_income</th>
      <td>16339.0</td>
      <td>3.88</td>
      <td>1.90</td>
      <td>0.50</td>
      <td>2.56</td>
      <td>3.54</td>
      <td>4.75</td>
      <td>15.00</td>
    </tr>
    <tr>
      <th>median_house_value</th>
      <td>16339.0</td>
      <td>207197.92</td>
      <td>115876.63</td>
      <td>14999.00</td>
      <td>119600.00</td>
      <td>179200.00</td>
      <td>265950.00</td>
      <td>500001.00</td>
    </tr>
    <tr>
      <th>people_per_household</th>
      <td>16339.0</td>
      <td>2.94</td>
      <td>0.97</td>
      <td>0.69</td>
      <td>2.43</td>
      <td>2.82</td>
      <td>3.29</td>
      <td>41.21</td>
    </tr>
    <tr>
      <th>household_per_person</th>
      <td>16339.0</td>
      <td>0.36</td>
      <td>0.09</td>
      <td>0.02</td>
      <td>0.30</td>
      <td>0.35</td>
      <td>0.41</td>
      <td>1.44</td>
    </tr>
    <tr>
      <th>bedrooms_per_household</th>
      <td>16339.0</td>
      <td>1.10</td>
      <td>0.40</td>
      <td>0.38</td>
      <td>1.01</td>
      <td>1.05</td>
      <td>1.10</td>
      <td>15.31</td>
    </tr>
    <tr>
      <th>rooms_per_household</th>
      <td>16339.0</td>
      <td>5.44</td>
      <td>2.18</td>
      <td>0.85</td>
      <td>4.45</td>
      <td>5.24</td>
      <td>6.05</td>
      <td>62.42</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Analyse der Variablen &quot;median_income&quot;</span>
<span class="n">sns</span><span class="o">.</span><span class="n">jointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ocean_proximity&quot;</span><span class="p">,</span> <span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_51_0.png" src="_images/regression_51_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_52_0.png" src="_images/regression_52_0.png" />
</div>
</div>
<p><strong>Analyse “household_per_person”</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;household_per_person&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;household_per_person&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_54_1.png" src="_images/regression_54_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;household_per_person&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_55_0.png" src="_images/regression_55_0.png" />
</div>
</div>
<p><strong>Analyse “rooms_per_household”</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rooms_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;rooms_per_household&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_57_1.png" src="_images/regression_57_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;rooms_per_household&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_58_0.png" src="_images/regression_58_0.png" />
</div>
</div>
<p><strong>Analyse “housing_median_age”</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot:xlabel=&#39;housing_median_age&#39;, ylabel=&#39;median_house_value&#39;&gt;
</pre></div>
</div>
<img alt="_images/regression_60_1.png" src="_images/regression_60_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">train_dataset</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_61_0.png" src="_images/regression_61_0.png" />
</div>
</div>
</section>
<section id="correlation">
<h2><strong>Correlation</strong><a class="headerlink" href="#correlation" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create correlation matrix for numerical variables</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr_matrix</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>longitude</th>
      <th>latitude</th>
      <th>housing_median_age</th>
      <th>total_rooms</th>
      <th>total_bedrooms</th>
      <th>population</th>
      <th>households</th>
      <th>median_income</th>
      <th>median_house_value</th>
      <th>people_per_household</th>
      <th>household_per_person</th>
      <th>bedrooms_per_household</th>
      <th>rooms_per_household</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>longitude</th>
      <td>1.000000</td>
      <td>-0.924162</td>
      <td>-0.109765</td>
      <td>0.049214</td>
      <td>0.075765</td>
      <td>0.109251</td>
      <td>0.062156</td>
      <td>-0.016895</td>
      <td>-0.047459</td>
      <td>0.134256</td>
      <td>-0.138509</td>
      <td>0.019678</td>
      <td>-0.031336</td>
    </tr>
    <tr>
      <th>latitude</th>
      <td>-0.924162</td>
      <td>1.000000</td>
      <td>0.010871</td>
      <td>-0.038576</td>
      <td>-0.071595</td>
      <td>-0.117794</td>
      <td>-0.077228</td>
      <td>-0.079124</td>
      <td>-0.142811</td>
      <td>-0.130333</td>
      <td>0.120870</td>
      <td>0.078912</td>
      <td>0.120070</td>
    </tr>
    <tr>
      <th>housing_median_age</th>
      <td>-0.109765</td>
      <td>0.010871</td>
      <td>1.000000</td>
      <td>-0.358937</td>
      <td>-0.318286</td>
      <td>-0.300734</td>
      <td>-0.299495</td>
      <td>-0.114836</td>
      <td>0.109786</td>
      <td>0.000160</td>
      <td>0.024449</td>
      <td>-0.101127</td>
      <td>-0.181565</td>
    </tr>
    <tr>
      <th>total_rooms</th>
      <td>0.049214</td>
      <td>-0.038576</td>
      <td>-0.358937</td>
      <td>1.000000</td>
      <td>0.928399</td>
      <td>0.863667</td>
      <td>0.916751</td>
      <td>0.201362</td>
      <td>0.135640</td>
      <td>-0.109974</td>
      <td>0.076010</td>
      <td>0.040937</td>
      <td>0.158909</td>
    </tr>
    <tr>
      <th>total_bedrooms</th>
      <td>0.075765</td>
      <td>-0.071595</td>
      <td>-0.318286</td>
      <td>0.928399</td>
      <td>1.000000</td>
      <td>0.886206</td>
      <td>0.978400</td>
      <td>-0.008631</td>
      <td>0.049908</td>
      <td>-0.140112</td>
      <td>0.154664</td>
      <td>0.061178</td>
      <td>0.004549</td>
    </tr>
    <tr>
      <th>population</th>
      <td>0.109251</td>
      <td>-0.117794</td>
      <td>-0.300734</td>
      <td>0.863667</td>
      <td>0.886206</td>
      <td>1.000000</td>
      <td>0.917338</td>
      <td>0.003006</td>
      <td>-0.026873</td>
      <td>0.156216</td>
      <td>-0.187900</td>
      <td>-0.083340</td>
      <td>-0.089146</td>
    </tr>
    <tr>
      <th>households</th>
      <td>0.062156</td>
      <td>-0.077228</td>
      <td>-0.299495</td>
      <td>0.916751</td>
      <td>0.978400</td>
      <td>0.917338</td>
      <td>1.000000</td>
      <td>0.013337</td>
      <td>0.066077</td>
      <td>-0.124652</td>
      <td>0.131059</td>
      <td>-0.066871</td>
      <td>-0.094716</td>
    </tr>
    <tr>
      <th>median_income</th>
      <td>-0.016895</td>
      <td>-0.079124</td>
      <td>-0.114836</td>
      <td>0.201362</td>
      <td>-0.008631</td>
      <td>0.003006</td>
      <td>0.013337</td>
      <td>1.000000</td>
      <td>0.690796</td>
      <td>-0.051023</td>
      <td>-0.007098</td>
      <td>-0.077353</td>
      <td>0.371443</td>
    </tr>
    <tr>
      <th>median_house_value</th>
      <td>-0.047459</td>
      <td>-0.142811</td>
      <td>0.109786</td>
      <td>0.135640</td>
      <td>0.049908</td>
      <td>-0.026873</td>
      <td>0.066077</td>
      <td>0.690796</td>
      <td>1.000000</td>
      <td>-0.208637</td>
      <td>0.263035</td>
      <td>-0.066208</td>
      <td>0.165391</td>
    </tr>
    <tr>
      <th>people_per_household</th>
      <td>0.134256</td>
      <td>-0.130333</td>
      <td>0.000160</td>
      <td>-0.109974</td>
      <td>-0.140112</td>
      <td>0.156216</td>
      <td>-0.124652</td>
      <td>-0.051023</td>
      <td>-0.208637</td>
      <td>1.000000</td>
      <td>-0.784152</td>
      <td>-0.067947</td>
      <td>-0.057770</td>
    </tr>
    <tr>
      <th>household_per_person</th>
      <td>-0.138509</td>
      <td>0.120870</td>
      <td>0.024449</td>
      <td>0.076010</td>
      <td>0.154664</td>
      <td>-0.187900</td>
      <td>0.131059</td>
      <td>-0.007098</td>
      <td>0.263035</td>
      <td>-0.784152</td>
      <td>1.000000</td>
      <td>0.102202</td>
      <td>0.003634</td>
    </tr>
    <tr>
      <th>bedrooms_per_household</th>
      <td>0.019678</td>
      <td>0.078912</td>
      <td>-0.101127</td>
      <td>0.040937</td>
      <td>0.061178</td>
      <td>-0.083340</td>
      <td>-0.066871</td>
      <td>-0.077353</td>
      <td>-0.066208</td>
      <td>-0.067947</td>
      <td>0.102202</td>
      <td>1.000000</td>
      <td>0.801603</td>
    </tr>
    <tr>
      <th>rooms_per_household</th>
      <td>-0.031336</td>
      <td>0.120070</td>
      <td>-0.181565</td>
      <td>0.158909</td>
      <td>0.004549</td>
      <td>-0.089146</td>
      <td>-0.094716</td>
      <td>0.371443</td>
      <td>0.165391</td>
      <td>-0.057770</td>
      <td>0.003634</td>
      <td>0.801603</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen einer Heatmap um Abhängigkeiten zwischen den verschiedenen Variablen zu visualisieren</span>

<span class="c1"># Use a mask to plot only part of a matrix</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span><span class="o">=</span> <span class="kc">True</span>

<span class="c1"># Erstellen der Heatmap mit zusätzlichen Parametern</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
<span class="n">heatmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> 
                      <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">,</span> 
                      <span class="n">square</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
                      <span class="n">linewidths</span> <span class="o">=</span> <span class="mf">.5</span><span class="p">,</span>
                      <span class="n">cmap</span> <span class="o">=</span> <span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span>
                      <span class="n">cbar_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;shrink&#39;</span><span class="p">:</span> <span class="mf">.6</span><span class="p">,</span>
                                <span class="s1">&#39;ticks&#39;</span> <span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">]},</span>
                      <span class="n">vmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                      <span class="n">vmax</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                      <span class="n">annot</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                      <span class="n">annot_kws</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_64_0.png" src="_images/regression_64_0.png" />
</div>
</div>
</section>
</section>
<section id="initial-feature-engineering">
<h1>Initial Feature Engineering<a class="headerlink" href="#initial-feature-engineering" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create new, more relevant variables</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">people_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">population</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">household_per_person</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">households</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">population</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_room</span><span class="o">=</span><span class="k">lambda</span> <span class="n">train_dataset</span><span class="p">:</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create new, more relevant variables</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">people_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">population</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">household_per_person</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">households</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">population</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">rooms_per_household</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">households</span><span class="p">)</span>
<span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">bedrooms_per_room</span><span class="o">=</span><span class="k">lambda</span> <span class="n">test_dataset</span><span class="p">:</span> <span class="n">test_dataset</span><span class="o">.</span><span class="n">total_bedrooms</span><span class="o">/</span><span class="n">test_dataset</span><span class="o">.</span><span class="n">total_rooms</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># drop remaining row with one missing value</span>
<span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#drop population outlier</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">15360</span><span class="p">,</span> <span class="mi">9880</span><span class="p">])</span>
<span class="c1">#drop people_per_household outlier</span>
<span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">19006</span><span class="p">,</span> <span class="mi">16669</span><span class="p">,</span> <span class="mi">13034</span><span class="p">,</span> <span class="mi">3364</span><span class="p">,</span> <span class="mi">9172</span><span class="p">,</span> <span class="mi">12104</span><span class="p">,</span> <span class="mi">16420</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyError</span><span class="g g-Whitespace">                                  </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_11016</span><span class="o">/</span><span class="mf">2865436691.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1">#drop population outlier</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">15360</span><span class="p">,</span> <span class="mi">9880</span><span class="p">])</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1">#drop people_per_household outlier</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">train_dataset</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="mi">19006</span><span class="p">,</span> <span class="mi">16669</span><span class="p">,</span> <span class="mi">13034</span><span class="p">,</span> <span class="mi">3364</span><span class="p">,</span> <span class="mi">9172</span><span class="p">,</span> <span class="mi">12104</span><span class="p">,</span> <span class="mi">16420</span><span class="p">])</span>

<span class="nn">~\Anaconda\lib\site-packages\pandas\util\_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~\Anaconda\lib\site-packages\pandas\core\frame.py</span> in <span class="ni">drop</span><span class="nt">(self, labels, axis, index, columns, level, inplace, errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">4904</span>                 <span class="n">weight</span>  <span class="mf">1.0</span>     <span class="mf">0.8</span>
<span class="g g-Whitespace">   </span><span class="mi">4905</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">-&gt; </span><span class="mi">4906</span><span class="s2">         return super().drop(</span>
<span class="g g-Whitespace">   </span><span class="mi">4907</span><span class="s2">             labels=labels,</span>
<span class="g g-Whitespace">   </span><span class="mi">4908</span><span class="s2">             axis=axis,</span>

<span class="nn">~\Anaconda\lib\site-packages\pandas\core\generic.py</span> in <span class="ni">drop</span><span class="nt">(self, labels, axis, index, columns, level, inplace, errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">4148</span><span class="s2">         for axis, labels in axes.items():</span>
<span class="g g-Whitespace">   </span><span class="mi">4149</span><span class="s2">             if labels is not None:</span>
<span class="ne">-&gt; </span><span class="mi">4150</span><span class="s2">                 obj = obj._drop_axis(labels, axis, level=level, errors=errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">4151</span><span class="s2"> </span>
<span class="g g-Whitespace">   </span><span class="mi">4152</span><span class="s2">         if inplace:</span>

<span class="nn">~\Anaconda\lib\site-packages\pandas\core\generic.py</span> in <span class="ni">_drop_axis</span><span class="nt">(self, labels, axis, level, errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">4183</span><span class="s2">                 new_axis = axis.drop(labels, level=level, errors=errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">4184</span><span class="s2">             else:</span>
<span class="ne">-&gt; </span><span class="mi">4185</span><span class="s2">                 new_axis = axis.drop(labels, errors=errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">4186</span><span class="s2">             result = self.reindex(**{axis_name: new_axis})</span>
<span class="g g-Whitespace">   </span><span class="mi">4187</span><span class="s2"> </span>

<span class="nn">~\Anaconda\lib\site-packages\pandas\core\indexes\base.py</span> in <span class="ni">drop</span><span class="nt">(self, labels, errors)</span>
<span class="g g-Whitespace">   </span><span class="mi">6015</span><span class="s2">         if mask.any():</span>
<span class="g g-Whitespace">   </span><span class="mi">6016</span><span class="s2">             if errors != &quot;ignore&quot;:</span>
<span class="ne">-&gt; </span><span class="mi">6017</span><span class="s2">                 raise KeyError(f&quot;</span><span class="si">{labels[mask]}</span><span class="s2"> not found in axis&quot;)</span>
<span class="g g-Whitespace">   </span><span class="mi">6018</span><span class="s2">             indexer = indexer[~mask]</span>
<span class="g g-Whitespace">   </span><span class="mi">6019</span><span class="s2">         return self.delete(indexer)</span>

<span class="ne">KeyError</span>: &#39;[15360] not found in axis&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># change datatype zu string um str.replace transformation durchzuführen</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;string&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Bereinigung der &quot;fehlerhaften&quot; Werte</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">median_house_value</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">median_house_value</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">housing_median_age</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">housing_median_age</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;years&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data type anpassen</span>
<span class="c1"># value oder age könnte auch float sein, hier aber für int entschieden da keine Nachkommastellen vorhanden </span>
<span class="c1"># ocean proximity und price category bleiben object, da categroical values ohne order, mit meaning und nur string</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float64&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;total_bedrooms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;total_bedrooms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
<span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;price_category&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;price_category&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># summary statistics for all categorical/object columns</span>
<span class="n">train_dataset</span><span class="o">.</span><span class="n">describe</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;category&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>unique</th>
      <th>top</th>
      <th>freq</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ocean_proximity</th>
      <td>16352</td>
      <td>5</td>
      <td>&lt;1H OCEAN</td>
      <td>7225</td>
    </tr>
    <tr>
      <th>price_category</th>
      <td>16352</td>
      <td>2</td>
      <td>above</td>
      <td>13199</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">corr</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>median_house_value        1.000000
median_income             0.686220
household_per_person      0.266171
rooms_per_household       0.138533
total_rooms               0.131430
housing_median_age        0.107960
households                0.064087
total_bedrooms            0.048334
people_per_household     -0.021874
population               -0.028566
longitude                -0.044550
bedrooms_per_household   -0.047168
latitude                 -0.146066
bedrooms_per_room        -0.253441
Name: median_house_value, dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="modelling">
<h1>Modelling<a class="headerlink" href="#modelling" title="Permalink to this headline">¶</a></h1>
<section id="linear-ols-regression">
<h2>1. Linear OLS Regression<a class="headerlink" href="#linear-ols-regression" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select features for simple regression</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;household_per_person&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;rooms_per_household&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span>
<span class="n">X1</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>

<span class="c1"># Create response</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="model-1-1-linear-ols-regression-with-sklearn">
<h3>Model 1.1 - Linear OLS Regression with sklearn<a class="headerlink" href="#model-1-1-linear-ols-regression-with-sklearn" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data Split für Modell Scikitlearn</span>
<span class="n">X_train1</span><span class="p">,</span> <span class="n">X_test1</span><span class="p">,</span> <span class="n">y_train1</span><span class="p">,</span> <span class="n">y_test1</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pipeline with model</span>
<span class="n">lin_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lin&#39;</span><span class="p">,</span> <span class="n">LinearRegression</span><span class="p">())</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show pipeline</span>
<span class="n">set_config</span><span class="p">(</span><span class="n">display</span><span class="o">=</span><span class="s2">&quot;diagram&quot;</span><span class="p">)</span>
<span class="c1"># Fit model</span>
<span class="n">lin_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train1</span><span class="p">,</span> <span class="n">y_train1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 {color: black;background-color: white;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 pre{padding: 0;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-toggleable {background-color: white;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-estimator:hover {background-color: #d4ebff;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-item {z-index: 1;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-parallel-item:only-child::after {width: 0;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-34f8db32-257a-43ff-ae10-60a87c6cfd26 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-34f8db32-257a-43ff-ae10-60a87c6cfd26" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="79e910e2-31ca-4716-825f-f09da0510187" type="checkbox" ><label class="sk-toggleable__label" for="79e910e2-31ca-4716-825f-f09da0510187">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000021E76F8F880>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000021E76F8F760>)])),
                ('lin', LinearRegression())])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bd58dcfd-e1d9-4f4a-b0e4-edf894e36bd9" type="checkbox" ><label class="sk-toggleable__label" for="bd58dcfd-e1d9-4f4a-b0e4-edf894e36bd9">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000021E76F8F880>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000021E76F8F760>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="21018325-0036-4e81-8bf1-e49a358f7f7e" type="checkbox" ><label class="sk-toggleable__label" for="21018325-0036-4e81-8bf1-e49a358f7f7e">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000021E76F8F880></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="dc15a39f-8936-4a86-b84e-b0a1f5326dea" type="checkbox" ><label class="sk-toggleable__label" for="dc15a39f-8936-4a86-b84e-b0a1f5326dea">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f792ab66-8df3-4977-951f-2fac7c1fcc56" type="checkbox" ><label class="sk-toggleable__label" for="f792ab66-8df3-4977-951f-2fac7c1fcc56">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="d639f3a4-0b7c-461d-81ee-1c6e6a410f3a" type="checkbox" ><label class="sk-toggleable__label" for="d639f3a4-0b7c-461d-81ee-1c6e6a410f3a">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000021E76F8F760></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a907a312-6f8a-4137-b699-abe3ebbd95b3" type="checkbox" ><label class="sk-toggleable__label" for="a907a312-6f8a-4137-b699-abe3ebbd95b3">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="bdc22774-8e5f-49ba-9b09-edcc8f22cfb5" type="checkbox" ><label class="sk-toggleable__label" for="bdc22774-8e5f-49ba-9b09-edcc8f22cfb5">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c93d1e0a-6b2a-4565-9c16-b85f05db0057" type="checkbox" ><label class="sk-toggleable__label" for="c93d1e0a-6b2a-4565-9c16-b85f05db0057">LinearRegression</label><div class="sk-toggleable__content"><pre>LinearRegression()</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtain model coefficients</span>
<span class="n">lin_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 72032.60849607,  28483.62374275,    921.78833357,  12054.20051743,
       -20043.94030758, -93478.81535555, 150582.30222604, -22632.25997908,
       -14427.28658384])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get absolute values of coefficients</span>
<span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lin_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">list_numerical</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_11016</span><span class="o">/</span><span class="mf">4234811267.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> 
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span> 
<span class="ne">----&gt; </span><span class="mi">5</span>             <span class="n">y</span><span class="o">=</span><span class="n">list_numerical</span><span class="p">);</span>

<span class="ne">NameError</span>: name &#39;list_numerical&#39; is not defined
</pre></div>
</div>
</div>
</div>
<section id="evaluation-with-test-data">
<h4>Evaluation with Test Data<a class="headerlink" href="#evaluation-with-test-data" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred1</span> <span class="o">=</span> <span class="n">lin_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test1</span><span class="p">,</span> <span class="n">y_pred1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6440749956216951
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluate-with-training-data">
<h4>Evaluate with Training data<a class="headerlink" href="#evaluate-with-training-data" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred1train</span> <span class="o">=</span> <span class="n">lin_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred1train</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([275757.06485042, 267476.10000415, 628514.08957977, ...,
       123975.4545491 , 157412.95242652, 210577.37843559])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_train1</span><span class="p">,</span> <span class="n">y_pred1train</span><span class="p">)</span>  
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.660905216524134
</pre></div>
</div>
</div>
</div>
<p>Ergebnis mit Top 4 features [‘median_income’, ‘household_per_person’, ‘ocean_proximity’, ‘room_per_person’] : r2 = 0.6514777282231453</p>
<ul class="simple">
<li><p>housing_median_age = 0.660916387867293</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train1</span><span class="p">,</span> <span class="n">y_pred1train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4559576385.898086
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># RMSE</span>
<span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train1</span><span class="p">,</span> <span class="n">y_pred1train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>67524.6353999641
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">residplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">y_pred1train</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train1</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_94_0.png" src="_images/regression_94_0.png" />
</div>
</div>
</section>
<section id="id1">
<h4>Evaluation with Test Data<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred1test</span> <span class="o">=</span> <span class="n">lin_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE:&#39;</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test1</span><span class="p">,</span> <span class="n">y_pred1test</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;RMSE:&#39;</span><span class="p">,</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test1</span><span class="p">,</span> <span class="n">y_pred1test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE: 4750668163.255863
RMSE: 68925.09095573152
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot with Plotly Express</span>
<span class="n">px</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_test1</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_test1</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.65</span><span class="p">,</span> 
                <span class="n">trendline</span><span class="o">=</span><span class="s1">&#39;ols&#39;</span><span class="p">,</span> <span class="n">trendline_color_override</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>

<span class="n">x_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s1">&#39;median_income&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)})</span>
<span class="n">y_range</span> <span class="o">=</span>  <span class="n">lin_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>

<span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">([</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;train&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">),</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_test</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">y</span><span class="o">=</span><span class="n">y_test</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">),</span>
    <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x_range</span><span class="o">.</span><span class="n">median_income</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;prediction&#39;</span><span class="p">)</span>
<span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_15444</span><span class="o">/</span><span class="mf">718030785.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">x_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span> <span class="s1">&#39;median_income&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">X_train</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)})</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">y_range</span> <span class="o">=</span>  <span class="n">lin_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> 

<span class="ne">NameError</span>: name &#39;X_train&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="model-1-2-linear-ols-regression-with-statsmodels">
<h3>Model 1.2 - Linear OLS Regression with Statsmodels<a class="headerlink" href="#model-1-2-linear-ols-regression-with-statsmodels" title="Permalink to this headline">¶</a></h3>
<p>Im Folgenden wird die Lineare Regression mit Statsmodels einmal mit den klassischen Varaiblen und einmal mit selbst erstellten Varaiblen druchgeführt. Bei beiden Varianten werden mit Hilfe von Cook’s Distance Outlier identifiziert und aus dem Modell entfernt.<br />
Dann soll vergleichen werden, welche Vorgehensweise zu einem besseren Ergebnis führt.</p>
<p>Backward / Forward Selection einbauen</p>
<section id="model-mit-original-variablen">
<h4>Model mit Original Variablen<a class="headerlink" href="#model-mit-original-variablen" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit Model with original features</span>
<span class="n">lm1</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + housing_median_age + ocean_proximity + population + total_bedrooms&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Short summary</span>
<span class="n">lm1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td> 3.532e+04</td> <td> 2608.234</td> <td>   13.542</td> <td> 0.000</td> <td> 3.02e+04</td> <td> 4.04e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.INLAND]</th>     <td>-7.296e+04</td> <td> 1351.523</td> <td>  -53.986</td> <td> 0.000</td> <td>-7.56e+04</td> <td>-7.03e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.ISLAND]</th>     <td> 1.633e+05</td> <td> 3.13e+04</td> <td>    5.213</td> <td> 0.000</td> <td> 1.02e+05</td> <td> 2.25e+05</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR BAY]</th>   <td> 4741.7129</td> <td> 1901.465</td> <td>    2.494</td> <td> 0.013</td> <td> 1014.634</td> <td> 8468.792</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR OCEAN]</th> <td> 9668.0007</td> <td> 1740.243</td> <td>    5.556</td> <td> 0.000</td> <td> 6256.934</td> <td> 1.31e+04</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 3.897e+04</td> <td>  302.573</td> <td>  128.795</td> <td> 0.000</td> <td> 3.84e+04</td> <td> 3.96e+04</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td> 1214.8921</td> <td>   49.655</td> <td>   24.467</td> <td> 0.000</td> <td> 1117.563</td> <td> 1312.221</td>
</tr>
<tr>
  <th>population</th>                    <td>  -39.4971</td> <td>    1.115</td> <td>  -35.416</td> <td> 0.000</td> <td>  -41.683</td> <td>  -37.311</td>
</tr>
<tr>
  <th>total_bedrooms</th>                <td>  118.3993</td> <td>    2.926</td> <td>   40.467</td> <td> 0.000</td> <td>  112.664</td> <td>  124.134</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full summary</span>
<span class="n">lm1</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.635</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.635</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   3558.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Sat, 15 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>12:38:36</td>      <th>  Log-Likelihood:    </th> <td>-2.0546e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 16339</td>       <th>  AIC:               </th>  <td>4.109e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 16330</td>       <th>  BIC:               </th>  <td>4.110e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     8</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td> 3.532e+04</td> <td> 2608.234</td> <td>   13.542</td> <td> 0.000</td> <td> 3.02e+04</td> <td> 4.04e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.INLAND]</th>     <td>-7.296e+04</td> <td> 1351.523</td> <td>  -53.986</td> <td> 0.000</td> <td>-7.56e+04</td> <td>-7.03e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.ISLAND]</th>     <td> 1.633e+05</td> <td> 3.13e+04</td> <td>    5.213</td> <td> 0.000</td> <td> 1.02e+05</td> <td> 2.25e+05</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR BAY]</th>   <td> 4741.7129</td> <td> 1901.465</td> <td>    2.494</td> <td> 0.013</td> <td> 1014.634</td> <td> 8468.792</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR OCEAN]</th> <td> 9668.0007</td> <td> 1740.243</td> <td>    5.556</td> <td> 0.000</td> <td> 6256.934</td> <td> 1.31e+04</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 3.897e+04</td> <td>  302.573</td> <td>  128.795</td> <td> 0.000</td> <td> 3.84e+04</td> <td> 3.96e+04</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td> 1214.8921</td> <td>   49.655</td> <td>   24.467</td> <td> 0.000</td> <td> 1117.563</td> <td> 1312.221</td>
</tr>
<tr>
  <th>population</th>                    <td>  -39.4971</td> <td>    1.115</td> <td>  -35.416</td> <td> 0.000</td> <td>  -41.683</td> <td>  -37.311</td>
</tr>
<tr>
  <th>total_bedrooms</th>                <td>  118.3993</td> <td>    2.926</td> <td>   40.467</td> <td> 0.000</td> <td>  112.664</td> <td>  124.134</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>3455.903</td> <th>  Durbin-Watson:     </th> <td>   1.979</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>10505.016</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 1.092</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 6.264</td>  <th>  Cond. No.          </th> <td>1.08e+05</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 1.08e+05. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div></div>
</div>
<p>Interpretation</p>
<p>If Durbin–Watson is less than 1.0, there may be cause for concern.</p>
<p>Small values of d indicate successive error terms are positively correlated.</p>
<p>If d &gt; 2, successive error terms are negatively correlated.</p>
<p>Omnisbus und JB kann bei großen Datensätzen vernachlässigt werden (SKript? Regression Diagnostics)</p>
</section>
<section id="regression-diagnostics">
<h4><strong>Regression Diagnostics</strong><a class="headerlink" href="#regression-diagnostics" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># influence plot </span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">influence_plot</span><span class="p">(</span><span class="n">lm1</span><span class="p">,</span> <span class="n">criterion</span><span class="o">=</span><span class="s2">&quot;cooks&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_110_0.png" src="_images/regression_110_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtain Cook&#39;s distance </span>
<span class="n">lm1_cooksd</span> <span class="o">=</span> <span class="n">lm1</span><span class="o">.</span><span class="n">get_influence</span><span class="p">()</span><span class="o">.</span><span class="n">cooks_distance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># get length of df to obtain n</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset2</span><span class="p">[</span><span class="s2">&quot;median_income&quot;</span><span class="p">])</span>

<span class="c1"># calculate critical d</span>
<span class="n">critical_d</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Critical Cooks distance:&#39;</span><span class="p">,</span> <span class="n">critical_d</span><span class="p">)</span>

<span class="c1"># identification of potential outliers with leverage</span>
<span class="n">out_d</span> <span class="o">=</span> <span class="n">lm1_cooksd</span> <span class="o">&gt;</span> <span class="n">critical_d</span>

<span class="c1"># output potential outliers with leverage</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_dataset2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> 
    <span class="n">lm1_cooksd</span><span class="p">[</span><span class="n">out_d</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Critical Cooks distance: 0.0002448130240528796
Int64Index([ 5300, 15413, 12377, 13958,  6024, 18904, 16906,  8846,  7357,
             8940,
            ...
             8867,   199, 18499, 16952,    59,  9810, 10752,  8858,  1601,
            18041],
           dtype=&#39;int64&#39;, length=957) 
 [0.00055053 0.00076178 0.00080329 0.00604638 0.00027508 0.00025655
 0.00029313 0.00132242 0.00025532 0.00031729 0.00121339 0.00064395
 0.00044116 0.00031568 0.01957591 0.00064359 0.00027662 0.00152719
 0.0005685  0.0019479  0.00057967 0.00032244 0.0007018  0.00065234
 0.00032382 0.00065263 0.0003474  0.00060354 0.00049622 0.00040568
 0.00098225 0.00035191 0.00101965 0.00071798 0.00039624 0.00027432
 0.00036073 0.00030557 0.00072637 0.00054968 0.00025036 0.00050458
 0.0010173  0.00075916 0.00062949 0.00061142 0.00093703 0.0026863
 0.00040669 0.00044602 0.00042028 0.00030663 0.00186755 0.00034386
 0.00083633 0.00024899 0.01523149 0.00186829 0.00043181 0.000559
 0.00071027 0.00028647 0.00033721 0.00024835 0.00049255 0.00036035
 0.00046473 0.00030992 0.00060262 0.0003551  0.00025167 0.001342
 0.0003126  0.00118704 0.0015916  0.00171112 0.000993   0.0002871
 0.11184544 0.00039611 0.00046006 0.00037395 0.00025754 0.00136445
 0.00058591 0.00046087 0.00068802 0.00075561 0.00026651 0.00097212
 0.00077309 0.0018085  0.00032928 0.00025405 0.00044273 0.00026398
 0.00291962 0.00058388 0.0004603  0.00027089 0.00050129 0.0005211
 0.00116755 0.00047863 0.0002693  0.0003262  0.00025186 0.0005055
 0.00056936 0.00115907 0.0008903  0.00055259 0.00028786 0.00187157
 0.00132842 0.0002661  0.00026877 0.00043325 0.00024587 0.00178866
 0.00025095 0.00025938 0.00065867 0.00027658 0.00052905 0.00047776
 0.00039243 0.00055081 0.00048826 0.00038529 0.00034538 0.00099123
 0.00028095 0.00065627 0.00028386 0.00055379 0.00072361 0.00064303
 0.00035441 0.00044121 0.00031582 0.00047475 0.00109485 0.00030286
 0.00026873 0.0009549  0.00032196 0.00203715 0.00041992 0.00029663
 0.00027203 0.00093049 0.00079226 0.00079963 0.00035335 0.00052043
 0.0003018  0.00050917 0.00040894 0.00046203 0.00040966 0.00251996
 0.00090394 0.00079818 0.00203605 0.00032956 0.00052602 0.00091047
 0.00039326 0.00040484 0.00032564 0.00034978 0.00040928 0.00026649
 0.00037108 0.00032204 0.00034742 0.00044745 0.00030353 0.0004011
 0.00083001 0.00027303 0.00029648 0.00040103 0.00024684 0.00025246
 0.00035175 0.00161972 0.0004368  0.00121479 0.00030635 0.00247271
 0.00057675 0.00029837 0.02930872 0.00090606 0.00024861 0.00077966
 0.0002791  0.03451127 0.00216027 0.0002719  0.00048351 0.00194433
 0.00116935 0.00024838 0.00025896 0.00153836 0.00030462 0.00033007
 0.00025724 0.00025367 0.00072733 0.00025469 0.00586834 0.00102889
 0.0004091  0.00035469 0.00027799 0.00036135 0.0015639  0.0006702
 0.00034532 0.00187451 0.00027214 0.00079312 0.00082901 0.00076616
 0.00024624 0.00029833 0.00041872 0.00034733 0.00070396 0.00026646
 0.00078677 0.00051053 0.00099309 0.00066245 0.00064073 0.00057683
 0.00040861 0.00059869 0.00046829 0.00029437 0.00038599 0.00160382
 0.00036247 0.00067063 0.00026154 0.00074368 0.00047351 0.00040062
 0.00060507 0.00032974 0.00060139 0.00027097 0.00104517 0.00055836
 0.0047583  0.00026004 0.0004766  0.00039684 0.00033804 0.00048592
 0.00040884 0.00113341 0.00195671 0.07415087 0.00090161 0.00085007
 0.00070408 0.00025948 0.00289658 0.00025488 0.00048304 0.00037739
 0.00038991 0.00188654 0.00027413 0.00030624 0.00066    0.00039693
 0.00029157 0.00083535 0.00155148 0.00085335 0.00025001 0.00063423
 0.00030863 0.00085891 0.00028707 0.00049833 0.00079881 0.00038503
 0.00046244 0.00039481 0.0007356  0.00040547 0.00058356 0.00040778
 0.00029462 0.00032058 0.00041546 0.00076153 0.00054683 0.00049381
 0.00203583 0.00042028 0.00111227 0.00031181 0.00109694 0.00041452
 0.00026263 0.00034966 0.00192987 0.00063109 0.0004317  0.00092489
 0.00026229 0.00027094 0.00091559 0.00025666 0.00055815 0.00608825
 0.0015897  0.0007953  0.00032848 0.00025115 0.0007123  0.00072172
 0.00036054 0.00031333 0.00132751 0.00037435 0.00030699 0.00113338
 0.00048948 0.00025691 0.0016858  0.00027851 0.00032273 0.0009135
 0.00033005 0.00057899 0.00033795 0.00048725 0.00077284 0.00064113
 0.00084481 0.00036893 0.00094403 0.00070274 0.00034004 0.00043264
 0.0003751  0.00032736 0.00026072 0.00035157 0.00029569 0.00030816
 0.00113728 0.00033983 0.00042584 0.00215672 0.00044049 0.00064402
 0.00024766 0.00028893 0.00024695 0.00052203 0.00034004 0.00061653
 0.00043497 0.00204604 0.00048066 0.00103397 0.00025586 0.00124343
 0.00040213 0.000571   0.00059036 0.00026663 0.00030247 0.0004408
 0.00213778 0.00204611 0.00035951 0.02099506 0.00069777 0.00092534
 0.00072557 0.00103025 0.0004971  0.00067242 0.0002649  0.00099955
 0.00034304 0.0009747  0.00140533 0.0021316  0.00052051 0.00038064
 0.00057569 0.00033333 0.00031097 0.00030005 0.00031057 0.00059414
 0.00025116 0.00038235 0.00103553 0.00025593 0.00058316 0.00026574
 0.00031164 0.00085675 0.00048112 0.00037966 0.00072766 0.00038574
 0.00203212 0.00131614 0.00051508 0.0005294  0.00144566 0.0006985
 0.00045573 0.00038727 0.00105129 0.00033891 0.00029081 0.02888925
 0.00086195 0.0003197  0.00043386 0.00077714 0.00177435 0.0010108
 0.00028517 0.00030869 0.00062948 0.00057097 0.00026337 0.00050726
 0.00480668 0.00364591 0.00107685 0.00061905 0.0002913  0.00040216
 0.00051754 0.00068865 0.00033116 0.0004007  0.00299774 0.00025868
 0.00030469 0.00046354 0.00060466 0.00088397 0.00107424 0.00082222
 0.00062446 0.00029382 0.00049439 0.00055469 0.00172959 0.00062429
 0.00024643 0.00236207 0.0002572  0.00214933 0.00091174 0.00043725
 0.0009872  0.00028552 0.00033286 0.00030668 0.00037921 0.00091213
 0.00061572 0.00067455 0.00027418 0.00110811 0.00056664 0.0009894
 0.00185277 0.0009052  0.00024953 0.00030438 0.0003646  0.00047287
 0.00188966 0.0006965  0.00033734 0.00221139 0.00027384 0.00040749
 0.00060542 0.00032171 0.00181542 0.0007485  0.00049267 0.0008248
 0.00057314 0.00060813 0.00047313 0.00035412 0.00039355 0.00026253
 0.00132226 0.00070049 0.00028655 0.00217058 0.00046606 0.00258293
 0.00030646 0.00026935 0.00046187 0.00263947 0.00043957 0.00037983
 0.00052632 0.00074874 0.00031824 0.00201667 0.00057077 0.00026774
 0.00182123 0.0006961  0.000667   0.00035108 0.00029426 0.00045113
 0.00041031 0.00114943 0.00039864 0.00115661 0.00030528 0.00041042
 0.00025263 0.00045998 0.00034017 0.0002647  0.00430248 0.00037736
 0.00094783 0.00062902 0.00038443 0.0003662  0.0003153  0.00052875
 0.00076862 0.00091511 0.00024896 0.00027118 0.00627705 0.00041724
 0.00071122 0.00028009 0.01052943 0.00070313 0.00055574 0.00030467
 0.00132983 0.00121698 0.00045021 0.00049481 0.00282237 0.00056734
 0.00062674 0.00025771 0.00861325 0.00112661 0.0004428  0.00044231
 0.00046888 0.0003228  0.002435   0.00039742 0.00027304 0.00028642
 0.0003498  0.00042511 0.00093824 0.0003033  0.00061922 0.00099023
 0.00082933 0.00075654 0.0030896  0.00041086 0.00651446 0.00170637
 0.00029118 0.00105526 0.00248064 0.00040694 0.00059714 0.00036083
 0.00028991 0.00030426 0.00166185 0.00199188 0.00030751 0.00076586
 0.00040215 0.00064346 0.00030195 0.00028538 0.0008435  0.00028827
 0.00055851 0.0002615  0.00041561 0.00027627 0.00030248 0.00239557
 0.00042584 0.00024641 0.00024485 0.0002834  0.00038756 0.00062258
 0.00198507 0.00027513 0.00028816 0.00044598 0.00047437 0.00057
 0.00105593 0.00057907 0.00050112 0.00029196 0.00040718 0.00031537
 0.00028737 0.00038035 0.00027639 0.00068574 0.00046043 0.00025283
 0.00173342 0.00085254 0.00084199 0.00034693 0.00026587 0.00030743
 0.00055074 0.00071545 0.00025563 0.00044554 0.00025248 0.00038943
 0.00052179 0.00027399 0.00042303 0.00040637 0.0007379  0.00038294
 0.00157339 0.00024813 0.00150605 0.00024834 0.00024485 0.00103205
 0.0002629  0.00055753 0.00049056 0.00044883 0.00042158 0.00031794
 0.00043703 0.00046713 0.00058692 0.00172767 0.00164994 0.00104009
 0.00063444 0.00058024 0.00036361 0.00048796 0.00075497 0.0003744
 0.00065263 0.00031547 0.00036502 0.00060434 0.00093668 0.00038717
 0.00090859 0.00037165 0.00083282 0.00036382 0.00534924 0.00033901
 0.00164038 0.00048437 0.00126839 0.00024713 0.00062429 0.00025723
 0.0010694  0.02263782 0.00024946 0.00030652 0.00028872 0.00069463
 0.00032549 0.00032677 0.00067053 0.00045728 0.00027756 0.00030505
 0.00047859 0.00030637 0.00026725 0.00026606 0.0002556  0.00045899
 0.00039992 0.00033223 0.00156867 0.00027651 0.00046803 0.00043685
 0.00024951 0.00128658 0.00754079 0.00034742 0.000261   0.00027337
 0.00030829 0.00040941 0.00024805 0.00028505 0.00231162 0.00034269
 0.00037539 0.00107757 0.00028058 0.00030188 0.00033097 0.00031661
 0.0003253  0.00066217 0.0002731  0.00094831 0.00026484 0.00028095
 0.00131403 0.00045523 0.00152477 0.00033278 0.00163514 0.00024659
 0.00068941 0.00080386 0.00078239 0.000248   0.00209059 0.00070671
 0.00067856 0.00056861 0.0006699  0.0008151  0.00046094 0.00030366
 0.00427169 0.00048665 0.00027724 0.00034906 0.00039487 0.00064399
 0.00029107 0.00153676 0.00044599 0.00024802 0.00028455 0.00027579
 0.00192643 0.0003233  0.00026698 0.00028472 0.0008746  0.00026005
 0.00040937 0.000399   0.00025534 0.00402686 0.00046579 0.00213388
 0.00031975 0.00034202 0.00027005 0.00032859 0.00039575 0.00052615
 0.00571335 0.00025666 0.00059451 0.00052977 0.00024646 0.00217215
 0.00066123 0.00037448 0.00029747 0.00048658 0.00026819 0.00048324
 0.00033359 0.00062811 0.00027644 0.00027928 0.00084738 0.00034695
 0.00035959 0.00027047 0.00084637 0.00034232 0.0006207  0.0003453
 0.0005061  0.00105257 0.00030979 0.00027376 0.00060914 0.00047356
 0.00062451 0.00031022 0.00031589 0.00056361 0.00024981 0.00042088
 0.00034514 0.00168282 0.00143157 0.00059664 0.00057163 0.00027561
 0.00026787 0.00027354 0.00042884 0.0005926  0.00047167 0.00069546
 0.00040581 0.00025326 0.00026974 0.00070266 0.00025463 0.00035227
 0.00026237 0.00087116 0.00028685 0.00046101 0.00047816 0.00057847
 0.00026316 0.00107771 0.00054998 0.00031715 0.00033674 0.00029298
 0.00028409 0.00026646 0.00026824 0.00072011 0.0004176  0.00126266
 0.0002692  0.00024802 0.00025527 0.00152456 0.00223543 0.00034693
 0.00131151 0.00026871 0.00228766 0.00035023 0.00107681 0.00030418
 0.00051296 0.00033937 0.00028873 0.00059163 0.00255206 0.00027113
 0.00179043 0.00025118 0.00065465 0.00024897 0.00025049 0.00064667
 0.00037415 0.00029138 0.00052386 0.0003488  0.00034876 0.00042842
 0.00133014 0.00033098 0.00125246 0.00062567 0.00025192 0.00038643
 0.00033363 0.00074818 0.00029448 0.00526031 0.00027206 0.00042358
 0.00030275 0.00038553 0.00026986 0.00025523 0.00036758 0.00096104
 0.00025901 0.00025646 0.00060855 0.0010576  0.01168292 0.00026767
 0.00182091 0.00024709 0.00029335 0.00046384 0.00127265 0.00031195
 0.00035606 0.00095092 0.00030834 0.00046813 0.00037754 0.00061247
 0.00054323 0.00040194 0.00057387 0.00053339 0.00035163 0.00081153
 0.00059356 0.00078545 0.0002901  0.00108687 0.00026918 0.00034717
 0.00028688 0.00026447 0.00051637 0.00025414 0.00028038 0.00025903
 0.00099363 0.00042602 0.0005526 ]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset2a</span><span class="o">=</span><span class="n">train_dataset2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit Model with original features</span>
<span class="n">lm2</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + housing_median_age + ocean_proximity + population + total_bedrooms&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2a</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full summary</span>
<span class="n">lm2</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.735</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.735</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   6103.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Sat, 15 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>12:40:11</td>      <th>  Log-Likelihood:    </th> <td>-1.8932e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 15382</td>       <th>  AIC:               </th>  <td>3.787e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 15374</td>       <th>  BIC:               </th>  <td>3.787e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     7</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td> 1.386e+04</td> <td> 2183.914</td> <td>    6.345</td> <td> 0.000</td> <td> 9575.747</td> <td> 1.81e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.INLAND]</th>     <td>-6.663e+04</td> <td> 1065.529</td> <td>  -62.534</td> <td> 0.000</td> <td>-6.87e+04</td> <td>-6.45e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.ISLAND]</th>     <td>-2.765e-11</td> <td> 1.28e-11</td> <td>   -2.164</td> <td> 0.030</td> <td>-5.27e-11</td> <td>-2.61e-12</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR BAY]</th>   <td>-7079.2510</td> <td> 1549.788</td> <td>   -4.568</td> <td> 0.000</td> <td>-1.01e+04</td> <td>-4041.483</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR OCEAN]</th> <td> 5354.9973</td> <td> 1398.675</td> <td>    3.829</td> <td> 0.000</td> <td> 2613.428</td> <td> 8096.566</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 4.192e+04</td> <td>  259.798</td> <td>  161.373</td> <td> 0.000</td> <td> 4.14e+04</td> <td> 4.24e+04</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td> 1227.4471</td> <td>   40.279</td> <td>   30.474</td> <td> 0.000</td> <td> 1148.496</td> <td> 1306.398</td>
</tr>
<tr>
  <th>population</th>                    <td>  -42.6861</td> <td>    1.030</td> <td>  -41.436</td> <td> 0.000</td> <td>  -44.705</td> <td>  -40.667</td>
</tr>
<tr>
  <th>total_bedrooms</th>                <td>  132.7850</td> <td>    2.816</td> <td>   47.157</td> <td> 0.000</td> <td>  127.266</td> <td>  138.304</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>997.307</td> <th>  Durbin-Watson:     </th> <td>   1.991</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>1243.753</td> 
</tr>
<tr>
  <th>Skew:</th>          <td> 0.625</td>  <th>  Prob(JB):          </th> <td>8.36e-271</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.615</td>  <th>  Cond. No.          </th> <td>5.29e+17</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The smallest eigenvalue is 1.81e-25. This might indicate that there are<br/>strong multicollinearity problems or that the design matrix is singular.</div></div>
</div>
</section>
<section id="model-mit-selbst-erstellten-variablen">
<h4>Model mit selbst erstellten Variablen<a class="headerlink" href="#model-mit-selbst-erstellten-variablen" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm3</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + ocean_proximity + household_per_person + rooms_per_household + housing_median_age&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Short summary</span>
<span class="n">lm3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td>-6.018e+04</td> <td> 3130.220</td> <td>  -19.224</td> <td> 0.000</td> <td>-6.63e+04</td> <td> -5.4e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.INLAND]</th>     <td>-7.192e+04</td> <td> 1345.205</td> <td>  -53.463</td> <td> 0.000</td> <td>-7.46e+04</td> <td>-6.93e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.ISLAND]</th>     <td> 1.632e+05</td> <td> 3.04e+04</td> <td>    5.378</td> <td> 0.000</td> <td> 1.04e+05</td> <td> 2.23e+05</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR BAY]</th>   <td>-2024.2754</td> <td> 1854.983</td> <td>   -1.091</td> <td> 0.275</td> <td>-5660.245</td> <td> 1611.694</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR OCEAN]</th> <td> 3423.0784</td> <td> 1694.236</td> <td>    2.020</td> <td> 0.043</td> <td>  102.190</td> <td> 6743.967</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 3.883e+04</td> <td>  321.493</td> <td>  120.776</td> <td> 0.000</td> <td> 3.82e+04</td> <td> 3.95e+04</td>
</tr>
<tr>
  <th>household_per_person</th>          <td> 3.073e+05</td> <td> 5803.288</td> <td>   52.950</td> <td> 0.000</td> <td> 2.96e+05</td> <td> 3.19e+05</td>
</tr>
<tr>
  <th>rooms_per_household</th>           <td> -132.0086</td> <td>  275.124</td> <td>   -0.480</td> <td> 0.631</td> <td> -671.282</td> <td>  407.265</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td>  989.9966</td> <td>   45.395</td> <td>   21.808</td> <td> 0.000</td> <td>  901.017</td> <td> 1078.976</td>
</tr>
</table></div></div>
</div>
<p>P &lt; 0,05, dh wir können Null Hyptohese verwerfen, dh Zusammenhang ist da</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Full summary</span>
<span class="n">lm3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.658</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.657</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   3922.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Sat, 15 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>12:50:48</td>      <th>  Log-Likelihood:    </th> <td>-2.0494e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 16339</td>       <th>  AIC:               </th>  <td>4.099e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 16330</td>       <th>  BIC:               </th>  <td>4.100e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     8</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td>-6.018e+04</td> <td> 3130.220</td> <td>  -19.224</td> <td> 0.000</td> <td>-6.63e+04</td> <td> -5.4e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.INLAND]</th>     <td>-7.192e+04</td> <td> 1345.205</td> <td>  -53.463</td> <td> 0.000</td> <td>-7.46e+04</td> <td>-6.93e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.ISLAND]</th>     <td> 1.632e+05</td> <td> 3.04e+04</td> <td>    5.378</td> <td> 0.000</td> <td> 1.04e+05</td> <td> 2.23e+05</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR BAY]</th>   <td>-2024.2754</td> <td> 1854.983</td> <td>   -1.091</td> <td> 0.275</td> <td>-5660.245</td> <td> 1611.694</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR OCEAN]</th> <td> 3423.0784</td> <td> 1694.236</td> <td>    2.020</td> <td> 0.043</td> <td>  102.190</td> <td> 6743.967</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 3.883e+04</td> <td>  321.493</td> <td>  120.776</td> <td> 0.000</td> <td> 3.82e+04</td> <td> 3.95e+04</td>
</tr>
<tr>
  <th>household_per_person</th>          <td> 3.073e+05</td> <td> 5803.288</td> <td>   52.950</td> <td> 0.000</td> <td> 2.96e+05</td> <td> 3.19e+05</td>
</tr>
<tr>
  <th>rooms_per_household</th>           <td> -132.0086</td> <td>  275.124</td> <td>   -0.480</td> <td> 0.631</td> <td> -671.282</td> <td>  407.265</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td>  989.9966</td> <td>   45.395</td> <td>   21.808</td> <td> 0.000</td> <td>  901.017</td> <td> 1078.976</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>2985.068</td> <th>  Durbin-Watson:     </th> <td>   1.981</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th>  <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td>10190.947</td>
</tr>
<tr>
  <th>Skew:</th>           <td> 0.913</td>  <th>  Prob(JB):          </th> <td>    0.00</td> 
</tr>
<tr>
  <th>Kurtosis:</th>       <td> 6.412</td>  <th>  Cond. No.          </th> <td>1.82e+03</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 1.82e+03. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm4</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + ocean_proximity + household_per_person + housing_median_age&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># obtain Cook&#39;s distance </span>
<span class="n">lm4_cooksd</span> <span class="o">=</span> <span class="n">lm4</span><span class="o">.</span><span class="n">get_influence</span><span class="p">()</span><span class="o">.</span><span class="n">cooks_distance</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># get length of df to obtain n</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">train_dataset2</span><span class="p">[</span><span class="s2">&quot;median_income&quot;</span><span class="p">])</span>

<span class="c1"># calculate critical d</span>
<span class="n">critical_d</span> <span class="o">=</span> <span class="mi">4</span><span class="o">/</span><span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Critical Cooks distance:&#39;</span><span class="p">,</span> <span class="n">critical_d</span><span class="p">)</span>

<span class="c1"># identification of potential outliers with leverage</span>
<span class="n">out_d</span> <span class="o">=</span> <span class="n">lm4_cooksd</span> <span class="o">&gt;</span> <span class="n">critical_d</span>

<span class="c1"># output potential outliers with leverage</span>
<span class="nb">print</span><span class="p">(</span><span class="n">train_dataset2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">],</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> 
    <span class="n">lm4_cooksd</span><span class="p">[</span><span class="n">out_d</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Critical Cooks distance: 0.0002448130240528796
Int64Index([ 5300, 17195, 16906,  8846, 18611,  8940,  4642, 15236, 14017,
            18501,
            ...
             8867,   199, 16952,    59,  9810, 10752,  8858,  1601, 15871,
            18041],
           dtype=&#39;int64&#39;, length=1026) 
 [0.00041711 0.00025574 0.00033999 ... 0.00025265 0.0005765  0.00031429]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">train_dataset2b</span><span class="o">=</span><span class="n">train_dataset2</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">train_dataset2</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">out_d</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm4</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="s1">&#39;median_house_value ~ median_income + ocean_proximity + household_per_person + housing_median_age&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2b</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span><span class="o">.</span><span class="n">tables</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td>-6.498e+04</td> <td> 2466.163</td> <td>  -26.348</td> <td> 0.000</td> <td>-6.98e+04</td> <td>-6.01e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.INLAND]</th>     <td>-6.878e+04</td> <td> 1011.419</td> <td>  -68.000</td> <td> 0.000</td> <td>-7.08e+04</td> <td>-6.68e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.ISLAND]</th>     <td>-4.961e-10</td> <td> 8.51e-12</td> <td>  -58.300</td> <td> 0.000</td> <td>-5.13e-10</td> <td>-4.79e-10</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR BAY]</th>   <td>-1.138e+04</td> <td> 1501.266</td> <td>   -7.578</td> <td> 0.000</td> <td>-1.43e+04</td> <td>-8434.585</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR OCEAN]</th> <td> 1833.7382</td> <td> 1354.601</td> <td>    1.354</td> <td> 0.176</td> <td> -821.440</td> <td> 4488.917</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 4.073e+04</td> <td>  249.048</td> <td>  163.560</td> <td> 0.000</td> <td> 4.02e+04</td> <td> 4.12e+04</td>
</tr>
<tr>
  <th>household_per_person</th>          <td> 2.925e+05</td> <td> 5006.509</td> <td>   58.432</td> <td> 0.000</td> <td> 2.83e+05</td> <td> 3.02e+05</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td>  865.5206</td> <td>   36.159</td> <td>   23.937</td> <td> 0.000</td> <td>  794.645</td> <td>  936.397</td>
</tr>
</table></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lm4</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>    <td>median_house_value</td> <th>  R-squared:         </th>  <td>   0.755</td>  
</tr>
<tr>
  <th>Model:</th>                    <td>OLS</td>        <th>  Adj. R-squared:    </th>  <td>   0.755</td>  
</tr>
<tr>
  <th>Method:</th>              <td>Least Squares</td>   <th>  F-statistic:       </th>  <td>   7856.</td>  
</tr>
<tr>
  <th>Date:</th>              <td>Sat, 15 Jan 2022</td>  <th>  Prob (F-statistic):</th>   <td>  0.00</td>   
</tr>
<tr>
  <th>Time:</th>                  <td>13:01:52</td>      <th>  Log-Likelihood:    </th> <td>-1.8778e+05</td>
</tr>
<tr>
  <th>No. Observations:</th>       <td> 15313</td>       <th>  AIC:               </th>  <td>3.756e+05</td> 
</tr>
<tr>
  <th>Df Residuals:</th>           <td> 15306</td>       <th>  BIC:               </th>  <td>3.756e+05</td> 
</tr>
<tr>
  <th>Df Model:</th>               <td>     6</td>       <th>                     </th>      <td> </td>     
</tr>
<tr>
  <th>Covariance Type:</th>       <td>nonrobust</td>     <th>                     </th>      <td> </td>     
</tr>
</table>
<table class="simpletable">
<tr>
                <td></td>                   <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th>                     <td>-6.498e+04</td> <td> 2466.163</td> <td>  -26.348</td> <td> 0.000</td> <td>-6.98e+04</td> <td>-6.01e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.INLAND]</th>     <td>-6.878e+04</td> <td> 1011.419</td> <td>  -68.000</td> <td> 0.000</td> <td>-7.08e+04</td> <td>-6.68e+04</td>
</tr>
<tr>
  <th>ocean_proximity[T.ISLAND]</th>     <td>-4.961e-10</td> <td> 8.51e-12</td> <td>  -58.300</td> <td> 0.000</td> <td>-5.13e-10</td> <td>-4.79e-10</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR BAY]</th>   <td>-1.138e+04</td> <td> 1501.266</td> <td>   -7.578</td> <td> 0.000</td> <td>-1.43e+04</td> <td>-8434.585</td>
</tr>
<tr>
  <th>ocean_proximity[T.NEAR OCEAN]</th> <td> 1833.7382</td> <td> 1354.601</td> <td>    1.354</td> <td> 0.176</td> <td> -821.440</td> <td> 4488.917</td>
</tr>
<tr>
  <th>median_income</th>                 <td> 4.073e+04</td> <td>  249.048</td> <td>  163.560</td> <td> 0.000</td> <td> 4.02e+04</td> <td> 4.12e+04</td>
</tr>
<tr>
  <th>household_per_person</th>          <td> 2.925e+05</td> <td> 5006.509</td> <td>   58.432</td> <td> 0.000</td> <td> 2.83e+05</td> <td> 3.02e+05</td>
</tr>
<tr>
  <th>housing_median_age</th>            <td>  865.5206</td> <td>   36.159</td> <td>   23.937</td> <td> 0.000</td> <td>  794.645</td> <td>  936.397</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td>715.342</td> <th>  Durbin-Watson:     </th> <td>   1.994</td> 
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.000</td>  <th>  Jarque-Bera (JB):  </th> <td> 838.254</td> 
</tr>
<tr>
  <th>Skew:</th>          <td> 0.525</td>  <th>  Prob(JB):          </th> <td>9.45e-183</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 3.458</td>  <th>  Cond. No.          </th> <td>2.48e+19</td> 
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The smallest eigenvalue is 2.42e-32. This might indicate that there are<br/>strong multicollinearity problems or that the design matrix is singular.</div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SSR:&quot;</span><span class="p">,</span> <span class="n">lm4</span><span class="o">.</span><span class="n">ssr</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MSE:&quot;</span><span class="p">,</span> <span class="n">lm4</span><span class="o">.</span><span class="n">mse_resid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;RMSE&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">lm4</span><span class="o">.</span><span class="n">mse_resid</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SSR: 40147229403291.96
MSE: 2622973304.801513
RMSE 51214.97149078103
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add the regression predictions (as &quot;pred&quot;) to our DataFrame</span>
<span class="n">train_dataset2b</span><span class="p">[</span><span class="s1">&#39;y_pred2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lm4</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># MSE</span>
<span class="n">mse</span><span class="p">(</span><span class="n">train_dataset2b</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">],</span> <span class="n">train_dataset2b</span><span class="p">[</span><span class="s1">&#39;y_pred2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2621774270.4428887
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred2</span> <span class="o">=</span> <span class="n">lm4</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r2_score</span><span class="p">(</span><span class="n">y_test1</span><span class="p">,</span> <span class="n">y_pred2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6405490062827732
</pre></div>
</div>
</div>
</div>
</section>
<section id="id2">
<h4>Regression Diagnostics<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot regression line </span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">train_dataset2b</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">train_dataset2b</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">],</span>  <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">train_dataset2b</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">train_dataset2b</span><span class="p">[</span><span class="s1">&#39;y_pred2&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">);</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2b</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">},</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_133_0.png" src="_images/regression_133_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">lmplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;housing_median_age&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2b</span><span class="p">,</span> <span class="n">line_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="s1">&#39;darkred&#39;</span><span class="p">},</span> <span class="n">ci</span><span class="o">=</span><span class="kc">False</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_134_0.png" src="_images/regression_134_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">residplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;y_pred2&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;median_house_value&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">train_dataset2b</span><span class="p">,</span> <span class="n">scatter_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="p">:</span> <span class="mi">80</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_135_0.png" src="_images/regression_135_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regression diagnostics für Variable &quot;median_income&quot;</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_regress_exog</span><span class="p">(</span><span class="n">lm4</span><span class="p">,</span> <span class="s2">&quot;median_income&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_136_0.png" src="_images/regression_136_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regression diagnostics für Variable &quot;housing_median_age&quot;</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_regress_exog</span><span class="p">(</span><span class="n">lm4</span><span class="p">,</span> <span class="s2">&quot;housing_median_age&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_137_0.png" src="_images/regression_137_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regression diagnostics für alle Variablen</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">graphics</span><span class="o">.</span><span class="n">plot_partregress_grid</span><span class="p">(</span><span class="n">lm4</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_138_0.png" src="_images/regression_138_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Inspect correlation</span>
<span class="c1"># Calculate correlation using the default method ( &quot;pearson&quot;)</span>
<span class="n">corr</span> <span class="o">=</span> <span class="n">train_dataset2b</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="c1"># optimize aesthetics: generate mask for removing duplicate / unnecessary info</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
<span class="n">mask</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices_from</span><span class="p">(</span><span class="n">mask</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="c1"># Generate a custom diverging colormap as indicator for correlations:</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">diverging_palette</span><span class="p">(</span><span class="mi">220</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">as_cmap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">square</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">});</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_139_0.png" src="_images/regression_139_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Validation with Test Data?</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="lasso-regression">
<h2>2. Lasso Regression<a class="headerlink" href="#lasso-regression" title="Permalink to this headline">¶</a></h2>
<section id="lasso-regression-mit-scikit-learn">
<h3>2.1 Lasso Regression mit scikit-learn<a class="headerlink" href="#lasso-regression-mit-scikit-learn" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der X und Y Variablen</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]</span>
<span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">,</span> <span class="s1">&#39;household_per_person&#39;</span><span class="p">,</span> <span class="s1">&#39;ocean_proximity&#39;</span><span class="p">,</span> <span class="s1">&#39;housing_median_age&#39;</span><span class="p">]</span>
<span class="n">X2</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="split-data">
<h4>Split Data<a class="headerlink" href="#split-data" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data split</span>
<span class="n">X_train2</span><span class="p">,</span> <span class="n">X_test2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">,</span> <span class="n">y_test2</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make list of numerical features (League_N, Division_W and NewLeague_N are categorcial) </span>
<span class="n">list_numerical</span> <span class="o">=</span> <span class="n">X2</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;ocean_proximity&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">list_numerical</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;median_income&#39;, &#39;household_per_person&#39;, &#39;housing_median_age&#39;], dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
</section>
<section id="standardization">
<h4>Standardization<a class="headerlink" href="#standardization" title="Permalink to this headline">¶</a></h4>
<p>Lasso performs best when all numerical features are centered around 0 and have variance in the same order. If a feature has a variance that is orders of magnitude larger than others, it might dominate the objective function and make the estimator unable to learn from other features correctly as expected.</p>
<p>This means it is important to standardize our features. We do this by subtracting the mean from our observations and then dividing the difference by the standard deviation. This so called standard score  for an observation  is calculated as:</p>
<p>where:</p>
<p>x is an observation in a feature</p>
<p>is the mean of that feature</p>
<p>s is the standard deviation of that feature.</p>
<p>To avoid data leakage, the standardization of numerical features should always be performed after data splitting and only from training data. Furthermore, we obtain all necessary statistics for our features (mean and standard deviation) from training data and also use them on test data. Note that we don’t standardize our dummy variables (which only have values of 0 or 1).</p>
</section>
<section id="lasso-model">
<h4>Lasso - Model<a class="headerlink" href="#lasso-model" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen der Pipeline mit Lasso Modell</span>
<span class="n">lasso_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitten von Pipeline/Modell</span>
<span class="n">lasso_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\olive\Anaconda\lib\site-packages\sklearn\linear_model\_coordinate_descent.py:647: ConvergenceWarning:

Objective did not converge. You might want to increase the number of iterations, check the scale of the features or consider increasing regularisation. Duality gap: 4.359e+12, tolerance: 1.533e+10
</pre></div>
</div>
<div class="output text_html"><style>#sk-09a09441-f741-4764-8118-bee140d0aca3 {color: black;background-color: white;}#sk-09a09441-f741-4764-8118-bee140d0aca3 pre{padding: 0;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-toggleable {background-color: white;}#sk-09a09441-f741-4764-8118-bee140d0aca3 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-09a09441-f741-4764-8118-bee140d0aca3 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-09a09441-f741-4764-8118-bee140d0aca3 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-estimator:hover {background-color: #d4ebff;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-item {z-index: 1;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-parallel-item:only-child::after {width: 0;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-09a09441-f741-4764-8118-bee140d0aca3 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-09a09441-f741-4764-8118-bee140d0aca3" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="87530b7c-a909-4884-8734-997e0338e309" type="checkbox" ><label class="sk-toggleable__label" for="87530b7c-a909-4884-8734-997e0338e309">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640>)])),
                ('lasso', Lasso(alpha=1))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c80865cd-a3bf-485b-b4f2-7b3e8326bf33" type="checkbox" ><label class="sk-toggleable__label" for="c80865cd-a3bf-485b-b4f2-7b3e8326bf33">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="292d862c-50fe-4200-8d35-fc9f29d025f4" type="checkbox" ><label class="sk-toggleable__label" for="292d862c-50fe-4200-8d35-fc9f29d025f4">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="aea35211-bad9-4df2-a8ed-52b7359ca27f" type="checkbox" ><label class="sk-toggleable__label" for="aea35211-bad9-4df2-a8ed-52b7359ca27f">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a76b9dd9-ed2a-43d6-9cb0-a54b1f763d37" type="checkbox" ><label class="sk-toggleable__label" for="a76b9dd9-ed2a-43d6-9cb0-a54b1f763d37">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="79919e5b-5c0f-494f-9c56-67fbae9178c4" type="checkbox" ><label class="sk-toggleable__label" for="79919e5b-5c0f-494f-9c56-67fbae9178c4">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4784b13f-741a-4b4b-b7b3-c9c7cb657b10" type="checkbox" ><label class="sk-toggleable__label" for="4784b13f-741a-4b4b-b7b3-c9c7cb657b10">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="a2a602bb-0669-4b8c-a317-90f293635dce" type="checkbox" ><label class="sk-toggleable__label" for="a2a602bb-0669-4b8c-a317-90f293635dce">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c6dfcddd-9cd0-459f-aa39-c552471a9eee" type="checkbox" ><label class="sk-toggleable__label" for="c6dfcddd-9cd0-459f-aa39-c552471a9eee">Lasso</label><div class="sk-toggleable__content"><pre>Lasso(alpha=1)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#categorical_features = [&#39;ocean_proximity&#39;]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Erstellen einer Liste aller Feature Namen</span>
<span class="n">feature_names</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">list_numerical</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">transformers_</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;onehot&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get_feature_names_out</span><span class="p">()))</span>
<span class="n">feature_names</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;median_income&#39;, &#39;household_per_person&#39;, &#39;housing_median_age&#39;,
       &#39;x0_&lt;1H OCEAN&#39;, &#39;x0_INLAND&#39;, &#39;x0_ISLAND&#39;, &#39;x0_NEAR BAY&#39;,
       &#39;x0_NEAR OCEAN&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso-model-evaluation">
<h4>Lasso - Model Evaluation<a class="headerlink" href="#lasso-model-evaluation" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test2</span><span class="p">,</span> <span class="n">y_test2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set 65.86
R squared test set 65.53
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Training data</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train2</span><span class="p">)</span>
<span class="n">mse_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train2</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mse_train</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="c1"># Test data</span>
<span class="n">pred_test</span> <span class="o">=</span> <span class="n">lasso_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test2</span><span class="p">)</span>
<span class="n">mse_test</span> <span class="o">=</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test2</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;MSE test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">mse_test</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MSE training set 4575965321.24
MSE test set 4647160878.2
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso-k-fold-cross-validation">
<h4>Lasso - k-fold cross validation<a class="headerlink" href="#lasso-k-fold-cross-validation" title="Permalink to this headline">¶</a></h4>
<p>find best value for alpha</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pipeline with model</span>
<span class="n">lassoCV_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lassoCV&#39;</span><span class="p">,</span> <span class="n">LassoCV</span><span class="p">(</span><span class="n">cv</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">10000</span><span class="p">))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit model</span>
<span class="n">lassoCV_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-2877510e-7937-481f-896a-fa5f0c9caa93 {color: black;background-color: white;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 pre{padding: 0;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-toggleable {background-color: white;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-estimator:hover {background-color: #d4ebff;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-item {z-index: 1;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-parallel-item:only-child::after {width: 0;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-2877510e-7937-481f-896a-fa5f0c9caa93 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-2877510e-7937-481f-896a-fa5f0c9caa93" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="6773fddb-618c-4111-ba92-da833db9aa6c" type="checkbox" ><label class="sk-toggleable__label" for="6773fddb-618c-4111-ba92-da833db9aa6c">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640>)])),
                ('lassoCV', LassoCV(cv=5, max_iter=10000, random_state=0))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="58b5cb00-ca82-4b49-9e01-8ff623d3fd1b" type="checkbox" ><label class="sk-toggleable__label" for="58b5cb00-ca82-4b49-9e01-8ff623d3fd1b">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="adc0d8d5-bc38-45a3-a043-dd026f28ea0c" type="checkbox" ><label class="sk-toggleable__label" for="adc0d8d5-bc38-45a3-a043-dd026f28ea0c">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b775cb32-15ae-4b14-a2c9-011b336d185a" type="checkbox" ><label class="sk-toggleable__label" for="b775cb32-15ae-4b14-a2c9-011b336d185a">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="4fa38694-03ce-4978-ab13-319b8d35067b" type="checkbox" ><label class="sk-toggleable__label" for="4fa38694-03ce-4978-ab13-319b8d35067b">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c9221be5-a326-4a6c-9cea-f484887f68a9" type="checkbox" ><label class="sk-toggleable__label" for="c9221be5-a326-4a6c-9cea-f484887f68a9">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="91b9b8e7-2097-45c2-bb89-e35b1560151e" type="checkbox" ><label class="sk-toggleable__label" for="91b9b8e7-2097-45c2-bb89-e35b1560151e">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="f7981cf7-2f06-4dd4-852c-2dad79bac479" type="checkbox" ><label class="sk-toggleable__label" for="f7981cf7-2f06-4dd4-852c-2dad79bac479">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cdefe9c8-e748-4cef-800f-a998ef42df9e" type="checkbox" ><label class="sk-toggleable__label" for="cdefe9c8-e748-4cef-800f-a998ef42df9e">LassoCV</label><div class="sk-toggleable__content"><pre>LassoCV(cv=5, max_iter=10000, random_state=0)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lassoCV_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lassoCV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>79.87760954506325
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get absolute values of coefficients</span>
<span class="n">importance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lassoCV_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lassoCV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>

<span class="n">sns</span><span class="o">.</span><span class="n">barplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">importance</span><span class="p">,</span> 
            <span class="n">y</span><span class="o">=</span><span class="n">feature_names</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_163_0.png" src="_images/regression_163_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SequentialFeatureSelector</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="n">tic_fwd</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>

<span class="n">sfs_forward</span> <span class="o">=</span> <span class="n">SequentialFeatureSelector</span><span class="p">(</span>
    <span class="n">lassoCV_pipe</span><span class="p">,</span> <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> 
    <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>

<span class="n">toc_fwd</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Features selected by forward sequential selection: &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature_names</span><span class="p">[</span><span class="n">sfs_forward</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Done in </span><span class="si">{</span><span class="n">toc_fwd</span> <span class="o">-</span> <span class="n">tic_fwd</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\olive\Anaconda\lib\site-packages\sklearn\base.py:561: FutureWarning:

Arrays of bytes/strings is being converted to decimal numbers if dtype=&#39;numeric&#39;. This behavior is deprecated in 0.24 and will be removed in 1.1 (renaming of 0.26). Please convert your data to numeric values explicitly instead.
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="nn">~\Anaconda\lib\site-packages\sklearn\utils\validation.py</span> in <span class="ni">check_array</span><span class="nt">(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, estimator)</span>
<span class="g g-Whitespace">    </span><span class="mi">778</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">779</span>                 <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">780</span>             <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

<span class="ne">ValueError</span>: could not convert string to float: &#39;&lt;1H OCEAN&#39;

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_15444</span><span class="o">/</span><span class="mf">1359381886.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">tic_fwd</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> 
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">sfs_forward</span> <span class="o">=</span> <span class="n">SequentialFeatureSelector</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">lassoCV_pipe</span><span class="p">,</span> <span class="n">n_features_to_select</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;forward&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>

<span class="nn">~\Anaconda\lib\site-packages\sklearn\feature_selection\_sequential.py</span> in <span class="ni">fit</span><span class="nt">(self, X, y)</span>
<span class="g g-Whitespace">    </span><span class="mi">160</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">161</span><span class="s2">         tags = self._get_tags()</span>
<span class="ne">--&gt; </span><span class="mi">162</span><span class="s2">         X = self._validate_data(</span>
<span class="g g-Whitespace">    </span><span class="mi">163</span><span class="s2">             X,</span>
<span class="g g-Whitespace">    </span><span class="mi">164</span><span class="s2">             accept_sparse=&quot;csc&quot;,</span>

<span class="nn">~\Anaconda\lib\site-packages\sklearn\base.py</span> in <span class="ni">_validate_data</span><span class="nt">(self, X, y, reset, validate_separately, **check_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">559</span><span class="s2">             raise ValueError(&quot;Validation should be done on X, y or both.&quot;)</span>
<span class="g g-Whitespace">    </span><span class="mi">560</span><span class="s2">         elif not no_val_X and no_val_y:</span>
<span class="ne">--&gt; </span><span class="mi">561</span><span class="s2">             X = check_array(X, **check_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">562</span><span class="s2">             out = X</span>
<span class="g g-Whitespace">    </span><span class="mi">563</span><span class="s2">         elif no_val_X and not no_val_y:</span>

<span class="nn">~\Anaconda\lib\site-packages\sklearn\utils\validation.py</span> in <span class="ni">check_array</span><span class="nt">(array, accept_sparse, accept_large_sparse, dtype, order, copy, force_all_finite, ensure_2d, allow_nd, ensure_min_samples, ensure_min_features, estimator)</span>
<span class="g g-Whitespace">    </span><span class="mi">779</span><span class="s2">                 array = array.astype(np.float64)</span>
<span class="g g-Whitespace">    </span><span class="mi">780</span><span class="s2">             except ValueError as e:</span>
<span class="ne">--&gt; </span><span class="mi">781</span><span class="s2">                 raise ValueError(</span>
<span class="g g-Whitespace">    </span><span class="mi">782</span><span class="s2">                     &quot;Unable to convert array of bytes/strings &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">783</span><span class="s2">                     &quot;into decimal numbers with dtype=&#39;numeric&#39;&quot;</span>

<span class="ne">ValueError</span>: Unable to convert array of bytes/strings into decimal numbers with dtype=&#39;numeric&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="lasso-lasso-best">
<h4>Lasso - Lasso Best<a class="headerlink" href="#lasso-lasso-best" title="Permalink to this headline">¶</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create pipeline with model</span>
<span class="n">lassobest_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;lassobest&#39;</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="n">lassoCV_pipe</span><span class="o">.</span><span class="n">named_steps</span><span class="p">[</span><span class="s1">&#39;lassoCV&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">alpha_</span><span class="p">))</span>
                            <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set best alpha</span>

<span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-5f8f0657-481a-401d-9534-1d5393602ec2 {color: black;background-color: white;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 pre{padding: 0;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-toggleable {background-color: white;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-estimator:hover {background-color: #d4ebff;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-item {z-index: 1;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-parallel::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 2em;bottom: 0;left: 50%;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-parallel-item {display: flex;flex-direction: column;position: relative;background-color: white;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-parallel-item:only-child::after {width: 0;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;position: relative;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-label label {font-family: monospace;font-weight: bold;background-color: white;display: inline-block;line-height: 1.2em;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-label-container {position: relative;z-index: 2;text-align: center;}#sk-5f8f0657-481a-401d-9534-1d5393602ec2 div.sk-container {display: inline-block;position: relative;}</style><div id="sk-5f8f0657-481a-401d-9534-1d5393602ec2" class"sk-top-container"><div class="sk-container"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="679d0e03-5837-4bfb-b625-fcbf67e9ef4d" type="checkbox" ><label class="sk-toggleable__label" for="679d0e03-5837-4bfb-b625-fcbf67e9ef4d">Pipeline</label><div class="sk-toggleable__content"><pre>Pipeline(steps=[('preprocessor',
                 ColumnTransformer(transformers=[('num',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(strategy='median')),
                                                                  ('scaler',
                                                                   StandardScaler())]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640>),
                                                 ('cat',
                                                  Pipeline(steps=[('imputer',
                                                                   SimpleImputer(fill_value='missing',
                                                                                 strategy='constant')),
                                                                  ('onehot',
                                                                   OneHotEncoder(handle_unknown='ignore'))]),
                                                  <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640>)])),
                ('lassobest', Lasso(alpha=79.87760954506325))])</pre></div></div></div><div class="sk-serial"><div class="sk-item sk-dashed-wrapped"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="c47a3653-5107-4853-b36f-32d2c5a0045a" type="checkbox" ><label class="sk-toggleable__label" for="c47a3653-5107-4853-b36f-32d2c5a0045a">preprocessor: ColumnTransformer</label><div class="sk-toggleable__content"><pre>ColumnTransformer(transformers=[('num',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(strategy='median')),
                                                 ('scaler', StandardScaler())]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640>),
                                ('cat',
                                 Pipeline(steps=[('imputer',
                                                  SimpleImputer(fill_value='missing',
                                                                strategy='constant')),
                                                 ('onehot',
                                                  OneHotEncoder(handle_unknown='ignore'))]),
                                 <sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640>)])</pre></div></div></div><div class="sk-parallel"><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="cb4e99c3-8699-4a96-add7-d31a48550c80" type="checkbox" ><label class="sk-toggleable__label" for="cb4e99c3-8699-4a96-add7-d31a48550c80">num</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A55640></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="ad09ec85-5429-4161-80c2-d392b41015f2" type="checkbox" ><label class="sk-toggleable__label" for="ad09ec85-5429-4161-80c2-d392b41015f2">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(strategy='median')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="077eede1-bab4-48e3-bf9b-a341a25ed402" type="checkbox" ><label class="sk-toggleable__label" for="077eede1-bab4-48e3-bf9b-a341a25ed402">StandardScaler</label><div class="sk-toggleable__content"><pre>StandardScaler()</pre></div></div></div></div></div></div></div></div><div class="sk-parallel-item"><div class="sk-item"><div class="sk-label-container"><div class="sk-label sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="23bbea37-e7a0-4ad0-9c5f-7bed567f86f8" type="checkbox" ><label class="sk-toggleable__label" for="23bbea37-e7a0-4ad0-9c5f-7bed567f86f8">cat</label><div class="sk-toggleable__content"><pre><sklearn.compose._column_transformer.make_column_selector object at 0x0000024045A51640></pre></div></div></div><div class="sk-serial"><div class="sk-item"><div class="sk-serial"><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="68653f6a-6134-4328-bfe5-5e31a4986c34" type="checkbox" ><label class="sk-toggleable__label" for="68653f6a-6134-4328-bfe5-5e31a4986c34">SimpleImputer</label><div class="sk-toggleable__content"><pre>SimpleImputer(fill_value='missing', strategy='constant')</pre></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="b7a7ac5e-c1cd-42b6-9e87-ebd0a752e263" type="checkbox" ><label class="sk-toggleable__label" for="b7a7ac5e-c1cd-42b6-9e87-ebd0a752e263">OneHotEncoder</label><div class="sk-toggleable__content"><pre>OneHotEncoder(handle_unknown='ignore')</pre></div></div></div></div></div></div></div></div></div></div><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="22036e73-a50e-4804-8990-2391836ee25e" type="checkbox" ><label class="sk-toggleable__label" for="22036e73-a50e-4804-8990-2391836ee25e">Lasso</label><div class="sk-toggleable__content"><pre>Lasso(alpha=79.87760954506325)</pre></div></div></div></div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set lasso best&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set lasso best&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lassobest_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test2</span><span class="p">,</span> <span class="n">y_test2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set lasso best 65.77
R squared test set lasso best 65.52
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set lasso not best&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train2</span><span class="p">,</span> <span class="n">y_train2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set lasso not best&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">lasso_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test2</span><span class="p">,</span> <span class="n">y_test2</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set lasso not best 65.86
R squared test set lasso not best 65.53
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="splines">
<h2>3. Splines<a class="headerlink" href="#splines" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y3</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">]]</span>
<span class="n">X3</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="p">[[</span><span class="s1">&#39;median_income&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data split</span>
<span class="n">X_train3</span><span class="p">,</span> <span class="n">X_test3</span><span class="p">,</span> <span class="n">y_train3</span><span class="p">,</span> <span class="n">y_test3</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">X_train3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>median_income</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17220</th>
      <td>5.8411</td>
    </tr>
    <tr>
      <th>8046</th>
      <td>3.4605</td>
    </tr>
    <tr>
      <th>14809</th>
      <td>4.4777</td>
    </tr>
    <tr>
      <th>19166</th>
      <td>1.6685</td>
    </tr>
    <tr>
      <th>4265</th>
      <td>1.7306</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
    </tr>
    <tr>
      <th>8282</th>
      <td>3.4107</td>
    </tr>
    <tr>
      <th>2305</th>
      <td>4.7804</td>
    </tr>
    <tr>
      <th>17874</th>
      <td>3.4896</td>
    </tr>
    <tr>
      <th>5754</th>
      <td>7.4046</td>
    </tr>
    <tr>
      <th>6574</th>
      <td>3.8203</td>
    </tr>
  </tbody>
</table>
<p>11437 rows × 1 columns</p>
</div></div></div>
</div>
<section id="splines-with-sclearn">
<h3>3.1 Splines with sclearn<a class="headerlink" href="#splines-with-sclearn" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">make_pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">Ridge</span>


<span class="c1"># Create pipeline with model</span>
<span class="n">splines_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;preprocessor&#39;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s1">&#39;splines&#39;</span><span class="p">,</span> <span class="n">make_pipeline</span><span class="p">(</span><span class="n">SplineTransformer</span><span class="p">(</span><span class="n">n_knots</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span> 
                       <span class="n">Ridge</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)))</span>
                        <span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">splines_pipe</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train3</span><span class="p">,</span> <span class="n">y_train3</span><span class="p">)</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_train3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="n">model_results</span><span class="p">(</span><span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;spline&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_15444</span><span class="o">/</span><span class="mf">1717784273.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> 
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">model_results</span><span class="p">(</span><span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;spline&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;model_results&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y3</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 16339 entries, 6517 to 17881
Data columns (total 1 columns):
 #   Column              Non-Null Count  Dtype  
---  ------              --------------  -----  
 0   median_house_value  16339 non-null  float64
dtypes: float64(1)
memory usage: 771.3 KB
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Create observations</span>
<span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_test3</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">X_test3</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1"># Make some predictions</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>

<span class="c1"># plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train3</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train3</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_new</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cubic spline with degree=3&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">Empty</span><span class="g g-Whitespace">                                     </span>Traceback (most recent call last)
<span class="nn">~\Anaconda\lib\site-packages\joblib\parallel.py</span> in <span class="ni">dispatch_one_batch</span><span class="nt">(self, iterator)</span>
<span class="g g-Whitespace">    </span><span class="mi">821</span>             <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">822</span>                 <span class="n">tasks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ready_batches</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">823</span>             <span class="k">except</span> <span class="n">queue</span><span class="o">.</span><span class="n">Empty</span><span class="p">:</span>

<span class="nn">~\Anaconda\lib\queue.py</span> in <span class="ni">get</span><span class="nt">(self, block, timeout)</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span>                 <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_qsize</span><span class="p">():</span>
<span class="ne">--&gt; </span><span class="mi">168</span>                     <span class="k">raise</span> <span class="n">Empty</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>             <span class="k">elif</span> <span class="n">timeout</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

<span class="ne">Empty</span>: 

<span class="n">During</span> <span class="n">handling</span> <span class="n">of</span> <span class="n">the</span> <span class="n">above</span> <span class="n">exception</span><span class="p">,</span> <span class="n">another</span> <span class="n">exception</span> <span class="n">occurred</span><span class="p">:</span>

<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">~</span>\<span class="n">AppData</span>\<span class="n">Local</span>\<span class="n">Temp</span><span class="o">/</span><span class="n">ipykernel_21052</span><span class="o">/</span><span class="mf">4214293034.</span><span class="n">py</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">x_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_test3</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">X_test3</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># Make some predictions</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="n">pred</span> <span class="o">=</span> <span class="n">splines_pipe</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">x_new</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> 
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="c1"># plot</span>

<span class="nn">~\Anaconda\lib\site-packages\sklearn\utils\metaestimators.py</span> in <span class="ni">&lt;lambda&gt;</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span> 
<span class="g g-Whitespace">    </span><span class="mi">112</span>             <span class="c1"># lambda, but not partial, allows help() to work with update_wrapper</span>
<span class="ne">--&gt; </span><span class="mi">113</span>             <span class="n">out</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>  <span class="c1"># noqa</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span>         <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">115</span> 

<span class="nn">~\Anaconda\lib\site-packages\sklearn\pipeline.py</span> in <span class="ni">predict</span><span class="nt">(self, X, **predict_params)</span>
<span class="g g-Whitespace">    </span><span class="mi">467</span>         <span class="n">Xt</span> <span class="o">=</span> <span class="n">X</span>
<span class="g g-Whitespace">    </span><span class="mi">468</span>         <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">transform</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iter</span><span class="p">(</span><span class="n">with_final</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">469</span>             <span class="n">Xt</span> <span class="o">=</span> <span class="n">transform</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">Xt</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">470</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">Xt</span><span class="p">,</span> <span class="o">**</span><span class="n">predict_params</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">471</span> 

<span class="nn">~\Anaconda\lib\site-packages\sklearn\compose\_column_transformer.py</span> in <span class="ni">transform</span><span class="nt">(self, X)</span>
<span class="g g-Whitespace">    </span><span class="mi">746</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_check_n_features</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">747</span> 
<span class="ne">--&gt; </span><span class="mi">748</span>         <span class="n">Xs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fit_transform</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">749</span>             <span class="n">X</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">750</span>             <span class="kc">None</span><span class="p">,</span>

<span class="nn">~\Anaconda\lib\site-packages\sklearn\compose\_column_transformer.py</span> in <span class="ni">_fit_transform</span><span class="nt">(self, X, y, func, fitted, column_as_strings)</span>
<span class="g g-Whitespace">    </span><span class="mi">604</span>         <span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">605</span>         <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">606</span>             <span class="k">return</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">n_jobs</span><span class="p">)(</span>
<span class="g g-Whitespace">    </span><span class="mi">607</span>                 <span class="n">delayed</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span>                     <span class="n">transformer</span><span class="o">=</span><span class="n">clone</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fitted</span> <span class="k">else</span> <span class="n">trans</span><span class="p">,</span>

<span class="nn">~\Anaconda\lib\site-packages\joblib\parallel.py</span> in <span class="ni">__call__</span><span class="nt">(self, iterable)</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span>             <span class="c1"># remaining jobs.</span>
<span class="g g-Whitespace">   </span><span class="mi">1042</span>             <span class="bp">self</span><span class="o">.</span><span class="n">_iterating</span> <span class="o">=</span> <span class="kc">False</span>
<span class="ne">-&gt; </span><span class="mi">1043</span>             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dispatch_one_batch</span><span class="p">(</span><span class="n">iterator</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1044</span>                 <span class="bp">self</span><span class="o">.</span><span class="n">_iterating</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_iterator</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">   </span><span class="mi">1045</span> 

<span class="nn">~\Anaconda\lib\site-packages\joblib\parallel.py</span> in <span class="ni">dispatch_one_batch</span><span class="nt">(self, iterator)</span>
<span class="g g-Whitespace">    </span><span class="mi">831</span>                 <span class="n">big_batch_size</span> <span class="o">=</span> <span class="n">batch_size</span> <span class="o">*</span> <span class="n">n_jobs</span>
<span class="g g-Whitespace">    </span><span class="mi">832</span> 
<span class="ne">--&gt; </span><span class="mi">833</span>                 <span class="n">islice</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">islice</span><span class="p">(</span><span class="n">iterator</span><span class="p">,</span> <span class="n">big_batch_size</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">834</span>                 <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">islice</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">835</span>                     <span class="k">return</span> <span class="kc">False</span>

<span class="nn">~\Anaconda\lib\site-packages\sklearn\compose\_column_transformer.py</span> in <span class="ni">&lt;genexpr&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">    </span><span class="mi">607</span>                 <span class="n">delayed</span><span class="p">(</span><span class="n">func</span><span class="p">)(</span>
<span class="g g-Whitespace">    </span><span class="mi">608</span>                     <span class="n">transformer</span><span class="o">=</span><span class="n">clone</span><span class="p">(</span><span class="n">trans</span><span class="p">)</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">fitted</span> <span class="k">else</span> <span class="n">trans</span><span class="p">,</span>
<span class="ne">--&gt; </span><span class="mi">609</span>                     <span class="n">X</span><span class="o">=</span><span class="n">_safe_indexing</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
<span class="g g-Whitespace">    </span><span class="mi">610</span>                     <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">611</span>                     <span class="n">weight</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span>

<span class="nn">~\Anaconda\lib\site-packages\sklearn\utils\__init__.py</span> in <span class="ni">_safe_indexing</span><span class="nt">(X, indices, axis)</span>
<span class="g g-Whitespace">    </span><span class="mi">368</span> 
<span class="g g-Whitespace">    </span><span class="mi">369</span>     <span class="k">if</span> <span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">indices_dtype</span> <span class="o">==</span> <span class="s2">&quot;str&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="s2">&quot;loc&quot;</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">370</span>         <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">371</span>             <span class="s2">&quot;Specifying the columns using strings is only supported for &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">372</span>             <span class="s2">&quot;pandas DataFrames&quot;</span>

<span class="ne">ValueError</span>: Specifying the columns using strings is only supported for pandas DataFrames
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared training set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">splines_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train3</span><span class="p">,</span> <span class="n">y_train3</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;R squared test set&#39;</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">splines_pipe</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test3</span><span class="p">,</span> <span class="n">y_test3</span><span class="p">)</span><span class="o">*</span><span class="mi">100</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R squared training set 48.87
R squared test set 49.51
</pre></div>
</div>
</div>
</div>
</section>
<section id="splines-with-patsy">
<h3>3.2 Splines with Patsy<a class="headerlink" href="#splines-with-patsy" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generating cubic spline with 3 knots at 1, 4 and 7</span>
<span class="n">transformed_x</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">(</span>
            <span class="s2">&quot;bs(train, knots=(1,4,7), degree=3, include_intercept=False)&quot;</span><span class="p">,</span> 
                <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train3</span><span class="p">},</span><span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fitting generalised linear model on transformed dataset</span>
<span class="n">spline2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="p">(</span><span class="n">y_train3</span><span class="p">,</span> <span class="n">transformed_x</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Training data</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">spline2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;bs(train, knots=(1,4,7), include_intercept=False)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train3</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train3</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Test data</span>
<span class="n">pred_test</span> <span class="o">=</span> <span class="n">spline2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;bs(test, knots=(1,4,7), include_intercept=False)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">X_test3</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_test</span> <span class="o">=</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test3</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Save model results</span>
<span class="n">model_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Cubic spline (cs)&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;rmse_train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_train</span><span class="p">],</span> 
    <span class="s2">&quot;rmse_test&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_test</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">model_results</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>rmse_train</th>
      <th>rmse_test</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Cubic spline (cs)</td>
      <td>82639.192957</td>
      <td>82585.353147</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create observations</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_test3</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">X_test3</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1"># Make some predictions</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">spline2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;bs(xp, knots=(1,4,7), include_intercept=False)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;xp&quot;</span><span class="p">:</span> <span class="n">xp</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>

<span class="c1"># plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train3</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train3</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Cubic spline with degree=3 (3 knots)&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_184_0.png" src="_images/regression_184_0.png" />
</div>
</div>
</section>
<section id="natural-spline-with-patsy-statsmodels">
<h3>3.3 Natural Spline with Patsy &amp; Statsmodels<a class="headerlink" href="#natural-spline-with-patsy-statsmodels" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transformed_x3</span> <span class="o">=</span> <span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(train,df = 3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train3</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">)</span>

<span class="n">spline3</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">GLM</span><span class="p">(</span><span class="n">y_train3</span><span class="p">,</span> <span class="n">transformed_x3</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Training data</span>
<span class="n">pred_train</span> <span class="o">=</span> <span class="n">spline3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(train, df=3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="n">X_train3</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_train</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_train3</span><span class="p">,</span> <span class="n">pred_train</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Test data</span>
<span class="n">pred_test</span> <span class="o">=</span> <span class="n">spline3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(test, df=3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;test&quot;</span><span class="p">:</span> <span class="n">X_test3</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">rmse_test</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">y_test3</span><span class="p">,</span> <span class="n">pred_test</span><span class="p">,</span> <span class="n">squared</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Save model results</span>
<span class="n">model_results_ns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;Natural spline (ns)&quot;</span><span class="p">,</span>  
    <span class="s2">&quot;rmse_train&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_train</span><span class="p">],</span> 
    <span class="s2">&quot;rmse_test&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rmse_test</span><span class="p">]</span>
    <span class="p">})</span>

<span class="n">model_results_ns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>rmse_train</th>
      <th>rmse_test</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Natural spline (ns)</td>
      <td>83542.83</td>
      <td>83554.449619</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make predictions</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">spline3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">dmatrix</span><span class="p">(</span><span class="s2">&quot;cr(xp, df=3)&quot;</span><span class="p">,</span> <span class="p">{</span><span class="s2">&quot;xp&quot;</span><span class="p">:</span> <span class="n">xp</span><span class="p">},</span> <span class="n">return_type</span><span class="o">=</span><span class="s1">&#39;dataframe&#39;</span><span class="p">))</span>
<span class="n">xp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">X_test3</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span><span class="n">X_test3</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1"># plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">X_train3</span><span class="p">[</span><span class="s1">&#39;median_income&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train3</span><span class="p">[</span><span class="s1">&#39;median_house_value&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xp</span><span class="p">,</span> <span class="n">pred</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Natural spline with df=3&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/regression_188_0.png" src="_images/regression_188_0.png" />
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="Variablen.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Variablen</p>
            </div>
        </a>
    </div>

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Oliver Schabe<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
    
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>


    
  </body>
</html>